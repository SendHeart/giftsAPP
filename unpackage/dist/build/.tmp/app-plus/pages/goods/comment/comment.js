(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/comment/comment"],{4578:function(e,t,o){"use strict";(function(e){o("ee7a"),o("921b");a(o("66fd"));var t=a(o("e763"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},"7a18":function(e,t,o){"use strict";var a=o("88c2"),n=o.n(a);n.a},"88c2":function(e,t,o){},b10b:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c},n=[];o.d(t,"a",function(){return a}),o.d(t,"b",function(){return n})},b594:function(e,t,o){"use strict";o.r(t);var a=o("fc62"),n=o.n(a);for(var s in a)"default"!==s&&function(e){o.d(t,e,function(){return a[e]})}(s);t["default"]=n.a},e763:function(e,t,o){"use strict";o.r(t);var a=o("b10b"),n=o("b594");for(var s in n)"default"!==s&&function(e){o.d(t,e,function(){return n[e]})}(s);o("7a18");var i=o("2877"),r=Object(i["a"])(n["default"],a["a"],a["b"],!1,null,null,null);t["default"]=r.exports},fc62:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o("3936");var a=getApp().globalData.weburl,n=getApp().globalData.shop_type,s=getApp().globalData.uploadurl,i={data:function(){return{shop_type:n,uploadurl:s,user:null,userInfo:{},username:null,indicatorDots:!1,vertical:!1,autoplay:!0,page:1,pagesize:10,all_rows:0,interval:3e4,duration:12e3,goodsname:"",goodsinfo:[],goodsprice:0,goodssale:0,goodsid:0,sku_id:0,commodityAttr:[],attrValueList:[],hideviewgoodsinfo:!0,dkheight:300,scrollTop:0,scrollTop_init:350,comment:"",comm_list:[],img_arr:[],new_img_arr:[],upimg_url:[],formdata:"",star:[],goodstag:"",goods_img:"",goods_id:"",goods_skuid:"",order_skuid:"",comm_type:"",comment_level:"",content:"",new_img_url:""}},components:{},props:{},onLoad:function(t){var o=this,a=t.goods_id?t.goods_id:0,n=t.goods_skuid?t.goods_skuid:0,s=t.order_skuid?t.order_skuid:0,i=t.comm_type?t.comm_type:0;o.setData({goods_id:a,goods_skuid:n,order_skuid:s,comm_type:i}),console.log(e("comment onload comm_type:",i," goods_id:",a,"goods_skuid:",n," order_skuid:".order_skuid," at pages\\goods\\comment\\comment.vue:124")),o.get_goods_list()},methods:{showGoods:function(e){var t=e.currentTarget.dataset.objectId,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=e.currentTarget.dataset.goodsId,s=(e.currentTarget.dataset.goodsName,e.currentTarget.dataset.goodsPrice),i=e.currentTarget.dataset.goodsInfo,r=e.currentTarget.dataset.sale;wx.navigateTo({url:"../../details/details?sku_id="+t+"&id="+n+"&goods_info="+i+"&goods_price="+s+"&sale="+r+"&token="+a+"&username="+o})},get_goods_list:function(){var t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=t.page,i=t.goods_id,r=t.goods_skuid;wx.request({url:a+"/api/client/get_goods_list",method:"POST",data:{username:o,access_token:n,goods_id:i},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(i){var c=i.data.result;i.data.info;console.log(e("获取单个产品信息:",c," at pages\\goods\\comment\\comment.vue:167")),c?(t.setData({goodsid:c[0]["id"],goodsname:c[0]["name"],goodsinfo:c[0]["act_info"],goodstag:c[0]["goods_tag"],goodsprice:c[0]["sell_price"],goodssale:c[0]["sale"],goods_img:c[0]["image"]}),wx.request({url:a+"/api/client/get_goodssku_list",method:"POST",data:{username:o,access_token:n,goods_id:t.goodsid,sku_id:r,page:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(e("商品SKU:",o.data.result," at pages\\goods\\comment\\comment.vue:196"));var a=o.data.result.spec_select_list,n=o.data.result.sku_list;if(n){for(var s=0;s<n.length;s++)n[s].attrValueStatus?n[s].attrValueStatus=!0:n[s].attrValueStatus=!1;if(t.setData({commodityAttr:n}),a){for(s=0;s<a.length;s++)a[s].attrValueStatus?a[s].attrValueStatus=!0:a[s].attrValueStatus=!1;t.setData({attrValueList:a})}}}})):(wx.showToast({title:"服务已暂停",icon:"loading",duration:3e3}),setTimeout(function(){wx.navigateBack()},1500))}})},get_order_comment:function(){var t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("m_id")?wx.getStorageSync("m_id"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",i=(t.page,t.pagesize,t.goods_id),r=t.good_skuid,c=t.order_skuid,d=t.shop_type,g=t.img_arr;i>0&&wx.request({url:a+"/api/client/get_order_comment",method:"POST",data:{username:o,access_token:s,goods_id:i,good_skuid:r,order_skuid:c,m_id:n,shop_type:d},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){var a=o.data.result,n=(o.data.info,o.data.all_rows?o.data.all_rows:1);console.log(e("获取订单评论信息 :"+o.data,"goods_id:",i," at pages\\goods\\comment\\comment.vue:274")),a&&("undefined"!=a[0]["img1"]&&""!=a[0]["img1"]&&(g[0]=a[0]["img1"]),"undefined"!=a[0]["img2"]&&""!=a[0]["img2"]&&(g[1]=a[0]["img2"]),"undefined"!=a[0]["img3"]&&""!=a[0]["img3"]&&(g[2]=a[0]["img3"]),t.setData({comm_list:t.comm_list.concat(a),all_rows:n,img_arr:g,comment_level:a[0]["level"],content:a[0]["desc"]}),console.log(e("comm_list:",a,"img list:",g," at pages\\goods\\comment\\comment.vue:287")))}})},comment_star:function(e){var t=this,o=e.currentTarget.dataset.starId,a=t.comment_level;o==a?a-=1:a=o,t.setData({comment_level:a})},formSubmit:function(e){e.target.id;adds=e.detail.value,adds.program_id=getApp().globalData.jtappid,adds.openid=getApp().globalData._openid,adds.zx_info_id=this.zx_info_id,this.upload()},upload:function(){for(var t=this,o=t.goods_id,a=t.new_img_arr,n=[],i=0;i<a.length;i++){var r=a.length;wx.uploadFile({url:s,filePath:a[i],name:"wechat_upimg",formData:{latitude:encodeURI(0),longitude:encodeURI(0),restaurant_id:encodeURI(0),city:encodeURI("杭州"),prov:encodeURI("浙江"),name:encodeURI(o)},success:function(o){var a=JSON.parse(o.data.trim());"y"==a["status"]&&(n.push(a["result"]["img_url"]),t.setData({new_img_url:n}),r--,console.log(e("图片上传完成:",t.new_img_url," count:",r," at pages\\goods\\comment\\comment.vue:349")),0==r&&t.send_comment())}})}wx.showToast({title:"已提交！",duration:2e3});var c=t.content;c||t.setData({content:"图片:"})},upimg:function(){var t=this,o=t.new_img_arr,a=t.img_arr;a.length+o.length<3?wx.chooseImage({sizeType:["original","compressed"],success:function(a){t.setData({new_img_arr:o.concat(a.tempFilePaths)}),console.log(e("本次上传图片:",t.new_img_arr," at pages\\goods\\comment\\comment.vue:383"))}}):wx.showToast({title:"最多上传三张图片",icon:"loading",duration:3e3})},cancel_upimg:function(t){var o=this,a=t.currentTarget.dataset.id,n=[],s=o.img_arr,i=0;console.log(e("cancel_upimg:",s.length,"id:",a," at pages\\goods\\comment\\comment.vue:400"));for(var r=0;r<s.length;r++)r!=a&&(n[i++]=s[r]);o.setData({img_arr:n})},cancel_new_upimg:function(t){var o=this,a=t.currentTarget.dataset.id,n=[],s=(o.img_arr,o.new_img_arr),i=0;console.log(e("cancel_upimg:",s.length,"id:",a," at pages\\goods\\comment\\comment.vue:419"));for(var r=0;r<s.length;r++)r!=a&&(n[i++]=s[r]);o.setData({new_img_arr:n})},bindTextAreaBlur:function(e){var t=this;t.content=e.detail.value},sendCommentBtnTap:function(){var e=this,t=e.new_img_arr,o=e.content?e.content:"";""==o?wx.showToast({title:"评论内容不能为空",icon:"none",duration:1500}):t.length>0?e.upload():e.send_comment()},send_comment:function(){var t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=(wx.getStorageSync("m_id")&&wx.getStorageSync("m_id"),t.goods_id),i=t.goods_skuid,r=t.order_skuid,c=t.upimg_url;c=c.concat(t.img_arr),c=c.concat(t.new_img_url);var d=c[0]?c[0]:"",g=c[1]?c[1]:"",u=c[2]?c[2]:"",m=t.content?t.content:"",l=t.comment_level?t.comment_level:0,_=t.shop_type,p=t.comm_type;console.log(e("提交评论:",c,m," at pages\\goods\\comment\\comment.vue:473")),wx.request({url:a+"/api/client/order_comment",method:"POST",data:{username:o,access_token:n,goods_id:s,goods_skuid:i,order_skuid:r,comment_img1:d,comment_img2:g,comment_img3:u,content:m,product_comment_level:l,shop_type:_,comm_type:p},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){wx.showToast({title:"点评完成",icon:"success",duration:1e3}),console.log(e("点评完成",t," at pages\\goods\\comment\\comment.vue:501")),wx.navigateBack()}})},setData:function(e){var t,o,a=this,n=[];Object.keys(e).forEach(function(s){n=s.split("."),t=e[s],o=a.$data,n.forEach(function(e,s){s+1==n.length?a.$set(o,e,t):o[e]||a.$set(o,e,{}),o=o[e]})})}}};t.default=i}).call(this,o("0de9")["default"])}},[["4578","common/runtime","common/vendor"]]]);