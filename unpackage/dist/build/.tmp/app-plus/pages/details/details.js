(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/details/details"],{1629:function(e,a,t){"use strict";t.r(a);var i=t("5e37"),r=t.n(i);for(var o in i)"default"!==o&&function(e){t.d(a,e,function(){return i[e]})}(o);a["default"]=r.a},2997:function(e,a,t){"use strict";t.r(a);var i=t("e6ca"),r=t("1629");for(var o in r)"default"!==o&&function(e){t.d(a,e,function(){return r[e]})}(o);t("b639");var d=t("2877"),s=Object(d["a"])(r["default"],i["a"],i["b"],!1,null,null,null);a["default"]=s.exports},"3ae5":function(e,a,t){},"5b76":function(e,a,t){"use strict";(function(e){t("ee7a"),t("921b");i(t("66fd"));var a=i(t("2997"));function i(e){return e&&e.__esModule?e:{default:e}}e(a.default)}).call(this,t("6e42")["createPage"])},"5e37":function(e,a,t){"use strict";(function(e,i){function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o=t("3936"),d=t("13aa"),s=function(){return Promise.all([t.e("common/vendor"),t.e("components/uParse/src/wxParse")]).then(t.bind(null,"dcb8"))},_=function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"dcc0"))},n=function(){return t.e("components/jsfun-record/jsfun-record").then(t.bind(null,"c42a"))},c=getApp().globalData.weburl,l=getApp().globalData.shop_type,g=(getApp().globalData.from_page,wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):""),u=getApp().globalData.appid,m=getApp().globalData.secret,h=getApp().globalData.uploadurl,p=e.createInnerAudioContext(),v=null,f=[{id:"gray",title:"灰色",value:"#f2f2f2"},{id:"red",title:"红色",value:"#e34c55"},{id:"white",title:"白色",value:"#fff"},{id:"black",title:"黑色",value:"#333"},{id:"blue",title:"蓝色",value:"#6495ED"},{id:"yellow",title:"黄色",value:"#FFFF00"}],y={data:function(){return{title_name:"详情",title_logo:"/static/images/footer-icon-05.png",share_title:"这个礼物真不错，来看看吧，要是你能送我就更好了~",card_blessing:"",card_content:"",share_desc:"送心礼物，开启礼物社交时代！",share_avatarUrl:c+"/uploads/avatar.png",share_goods_avatarUrl:c+"/uploads/avatar.png",nickname:g.nickName,avatarUrl:g.avatarUrl,user:null,userInfo:{},username:null,indicatorDots:!0,vertical:!1,autoplay:!1,page:1,interval:3e3,duration:300,circular:!0,goodsname:"",goodsinfo:[],goodsprice:0,goodssale:0,goodsid:0,goodsshape:0,goodsdiscount:100,discountinfo:"9折优惠券",sku_gov_price:0,sku_earnest_price:0,sku_sell_price:0,sku_id:0,commodityAttr:[],attrValueList:[],firstIndex:0,cur_img_id:0,image:"",image_pic:[],hideviewgoodsinfo:!0,hideviewgoodspara:!0,dkheight:300,scrollTop:0,scrollTop_init:10,toView:"red",hideviewgoodsinfoflag:!0,hideviewgoodsparaflag:!0,modalHidden:!0,dkcontent:"",selectValueInfo:"",wishflag:0,goodsinfoshowflag:0,shop_type:l,comm_list:[],image_save_count:0,image_save_times:0,is_buymyself:0,buynum:1,notehidden:!0,cardregisterhidden:!0,card_image_height:"750",card_image_w_h:"5/7",has_cardpayed:0,openRecordingdis:"block",shutRecordingdis:"none",recordingTimeqwe:0,goodsmodel_count:0,setInter:"",cardnamehidden:!0,cardcelehidden:!0,cardlovehidden:!0,card_color:f,current_card_color:"#333",card_color_index:0,card_register_img:c+"/uploads/card_register_share.png",card_register_title:"",card_register_content:"",register_start_date:o.getDateStr(new Date,0),register_end_date:o.getDateStr(new Date,3),register_start_time:o.getDateStr(new Date,0,1),register_end_time:o.getDateStr(new Date,3,1),action_start_date:o.getDateStr(new Date,3),action_end_date:o.getDateStr(new Date,6),action_start_time:o.getDateStr(new Date,3,1),action_end_time:o.getDateStr(new Date,6,1),card_register_lim:0,card_register_fee:0,card_register_addr:"",card_register_ownername:"",card_register_ownerwechat:"",card_register_right_str:"",card_register_right_picker:["参与者可看","管理者可看","公开"],card_register_right_index:0,card_register_reqid_picker:["0无需证件","1身份证","2微信号","3QQ号","4邮箱","5学号","6工号"],card_register_reqid_index:0,card_name_modal_title:"编辑内容",card_name_logo_image:"/images/img_upload_field.png",card_register_topic_image:c+"/uploads/card_default_topic.png",card_cele_topic_image:c+"/uploads/card_default_cele.png",default_image:"/images/img_upload_field.png",has_shlogo:!1,has_registerdue:!1,has_actionrdue:!1,is_logo:"",new_img_arr:"",card_register_adv:"",card_love_logo:"",card_cele_logo:"",content:"",cur_img_share_id:"",is_card_name_name:"",is_card_name_title:"",is_card_name_phone:"",is_card_name_tel:"",is_card_name_email:"",is_card_name_website:"",is_card_name_publicwechat:"",is_card_name_addr:"",is_card_name_company:"",is_card_name_logo_image:"",is_card_name_qrcode:"",is_card_register_title:"",is_card_register_content:"",is_card_register_adv:"",is_card_register_logo:"",is_card_register_ownername:"",is_card_register_ownerwechat:"",is_card_register_addr:"",is_card_register_lim:"",is_card_register_fee:"",is_register_start_date:"",is_register_start_time:"",is_register_end_date:"",is_register_end_time:"",is_action_start_date:"",is_action_start_time:"",is_action_end_date:"",is_action_end_time:"",is_card_love_title:"",is_card_love_content:"",is_card_love_phone:"",is_card_love_related:"",is_card_love_addr:"",is_card_love_logo:"",is_card_love_qrcode:"",is_card_cele_title:"",is_card_cele_content:"",is_card_cele_logo:"",is_card_cele_qrcode:"",card_cele_title:"",card_cele_content:"",card_love_title:"",card_love_phone:"",card_love_related:"",card_love_addr:"",card_love_content:"",card_name_name:"",card_name_title:"",card_name_phone:"",card_name_tel:"",card_name_email:"",card_name_website:"",card_name_publicwechat:"",card_name_addr:"",card_name_company:"",card_name_note:"",inputShowed:!1,inputShowed2:!1,inputShowed3:!1,inputShowed4:!1,inputShowed5:!1,inputShowed6:!1,modalName:"",new_rec_url:"",is_apple:"",keyword:"",is_satisfy:"",rule_selected_info:"",has_actiondue:"",image_video:"",goodsorg:"",goodstag:"",card_type:"",refer_mid:"",marketprice:"",m_id:"",share_goods_qrcode:"",goodscoverimg:"",share_goods_wx_headimg:"",evalrate:"",card_image_w_rate:"",image_share:"",all_rows:"",sku_delivery_price:"",add_cart_title:"",carts:"",winHeight:1100,winWidth:380,secondIndex:"",showVideo:!1,videoContext:null,video_type:"video",video_height:"630rpx",video_index:0,video_width:"",video_oldIndex:0,video_play_time:0,video_muted:!0,video_autoplay:!0}},components:{uParse:s,uniPopup:_,jsfunRecord:n},onLoad:function(e){var a=this,t=e.is_back?e.is_back:0;1==t&&(e=wx.getStorageSync("details_options"));var o=wx.getStorageSync("m_id")?wx.getStorageSync("m_id"):0,d=wx.getStorageSync("phonemodel")?wx.getStorageSync("phonemodel"):"Andriod",s=wx.getStorageSync("username")?wx.getStorageSync("username"):"";s=e.username?e.username:s;var _=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=e.keyword?e.keyword:"",l=e.is_satisfy?e.is_satisfy:0,g=(e.has_cardpayed&&e.has_cardpayed,e.rule_selected_info?e.rule_selected_info:""),h=e.goods_org?e.goods_org:1,p=e.goods_shape?e.goods_shape:0,v=e.goods_tag?e.goods_tag:"",f=e.card_type?e.card_type:0,y="",w="",x="",S=0,D=0,b=0,T=0,k="",I="",C="",V="",A="",q="",O="",j="",E="",P="",F="",R="",N="",L="",U="",J="",H="",M="",B="",G="",W="",$="",Q="",z="",K=a.has_shlogo,X=a.has_registerdue,Y=a.has_actiondue,Z=a.page,ee=decodeURIComponent(e.scene),ae=e.name,te=e.id,ie=e.goodsid?e.goodsid:0;te=te||ie;var re=e.mid?e.mid:0,oe=e.goods_info?e.goods_info:"",de=e.goods_price,se=e.goods_marketprice,_e=e.sale,ne=e.image,ce=e.activity_image,le=ce||ne,ge=a.shop_type,ue="wishshare",me=[],he=[],pe=a.card_image_height?a.card_image_height:"750",ve=a.card_image_w_rate?a.card_image_w_rate:1,fe=wx.getStorageSync("card_register_info"),ye=wx.getStorageSync("card_name_info"),we=wx.getStorageSync("card_cele_info"),xe=wx.getStorageSync("card_love_info");if(wx.setStorageSync("details_options",e),fe){var Se=JSON.parse(fe);w=Se["card_register_content"],y=Se["card_register_title"],x=Se["card_register_addr"],S=Se["card_register_lim"],D=Se["card_register_fee"],b=Se["card_register_right_index"],T=Se["card_register_reqid_index"],k=Se["card_register_ownername"],I=Se["card_register_ownerwechat"],C=Se["card_register_adv"]?Se["card_register_adv"]:a.card_register_topic_image,K=Se["has_shlogo"]?Se["has_shlogo"]:K,X=Se["has_registerdue"]?Se["has_registerdue"]:X,Y=Se["has_actiondue"]?Se["has_actiondue"]:Y}if(ye){var De=JSON.parse(ye);A=De["card_name_name"],q=De["card_name_title"],O=De["card_name_phone"],j=De["card_name_tel"],E=De["card_name_email"],P=De["card_name_website"],F=De["card_name_publicwechat"],R=De["card_name_addr"],N=De["card_name_company"],L=De["card_name_note"],U=De["card_name_logo_image"],K=De["has_shlogo"]?De["has_shlogo"]:K}if(we){var be=JSON.parse(we);J=be["card_cele_title"],H=be["card_cele_content"],M=be["card_cele_logo"],K=be["has_shlogo"]?be["has_shlogo"]:K}if(xe){var Te=JSON.parse(xe);B=Te["card_love_title"],Q=Te["card_love_phone"],z=Te["card_love_addr"],$=Te["card_love_related"],G=Te["card_love_content"],W=Te["card_love_logo"],K=Te["has_shlogo"]?Te["has_shlogo"]:K}if(console.log(i("detail options:",e,"share_goods_id:",ie,"card_type:",f," goodsshape:",p," at pages\\details\\details.vue:994")),a.setData({is_apple:d.indexOf("iPhone")>=0?1:0,image_save_count:0,keyword:n,is_satisfy:l,rule_selected_info:g,card_register_content:w||"",card_register_title:y||"",card_register_addr:x||"",card_register_lim:S||0,card_register_fee:D||0,card_register_right_index:b||0,card_register_reqid_index:T||0,card_register_ownername:k||"",card_register_ownerwechat:I||"",card_register_adv:C||"",has_registerdue:X,has_actiondue:Y||!1,card_content:V,card_image_height:pe,card_name_name:A||"",card_name_title:q||"",card_name_phone:O||"",card_name_tel:j||"",card_name_email:E||"",card_name_website:P||"",card_name_publicwechat:F||"",card_name_addr:R||"",card_name_company:N||"",card_name_note:L||"",card_name_logo_image:U||"",card_cele_title:J||"",card_cele_content:H||"",card_cele_logo:M||"",card_love_title:B||"",card_love_phone:Q||"",card_love_related:$||"",card_love_addr:z||"",card_love_content:G||"",card_love_logo:W||"",has_shlogo:K||!1}),ee&&ee.indexOf("goodsid=")>=0){var ke=new RegExp(/(?=goodsid=).*?(?=\&)/),Ie=new RegExp(/\&mid=(.*)/),Ce=ee.match(ke)[0];te=Ce?Ce.substring(8,Ce.length):te;var Ve=ee.match(Ie)?ee.match(Ie)[0]:0;re=Ve?Ve.substring(5,Ve.length):re}if(ne){ne.indexOf("%3A%2F%2F")>=0&&(ne=decodeURIComponent(ne),le=ce||ne,ae=decodeURIComponent(ae),oe=decodeURIComponent(oe));var Ae={};ne.indexOf(".mp4")>=0&&(Ae={id:0,video_url:ne,url:ce,ext:"mp4",content:"",flag:!0,check:!1,like:"10w",comment:"1045",avater:"",initialTime:0,at:"",duration:841,short:!0,objectFit:"fill"},me.push(Ae),a.image_video=me);var qe={id:0,goods_id:te,url:ce||ne,video_url:"",ext:"png",content:"",flag:!1,check:!1,like:"10w",comment:"1045",avater:"",initialTime:0,at:"",duration:841,short:!0,objectFit:"fill"};qe["url"]=qe["url"].replace("/n11/","/n12/"),qe["url"]=qe["url"].replace("/n1/","/n12/"),he.push(qe),me.length>0&&(he=me.concat(he)),a.image_pic=he}oe="undefined"==oe?"":oe;var Oe=c+"/api/WXPay/getQRCode?username="+s+"&appid="+u+"&secret="+m+"&shop_type="+ge+"&qr_type="+ue+"&share_goods_id="+te+"&m_id="+o;a.setData({goodsname:ae||"",goodsinfo:oe||"",goodsorg:h,goodsshape:p,goodstag:v,card_type:f,goodsid:te||0,refer_mid:re,goodsprice:de||0,marketprice:se||"",goodssale:_e||0,m_id:o,share_goods_qrcode:Oe}),a.image_save(Oe,"goods_qrcode_cache_"+te),te>0?(le&&a.image_save(le,"goods_image_cache_"+te),wx.request({url:c+"/api/client/get_goods_list",method:"POST",data:{username:e.username?e.username:s,access_token:_,goods_id:te,shop_type:ge},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){var t=e.data.result;e.data.info;if(console.log(i("获取单个产品信息 res.data:",e.data," goods info:",t," at pages\\details\\details.vue:1149")),t){var o;5==t[0]["shape"]?V=a.card_blessing:4==t[0]["shape"]&&(w=a.card_register_content,y=a.card_register_title);t[0]["goods_tag"];var d=t[0]["card_type"]?t[0]["card_type"]:0;1==d||4==d||5==t[0]["shape"]?(ve="5/7",pe=parseFloat(7*a.winWidth*2/5)):2==d?(ve="9/5",pe=parseFloat(5*a.winWidth*2/9)):pe="750",a.goodsshape=t[0]["shape"],a.setData((o={goodsname:t[0]["name"],goodsinfo:t[0]["act_info"],goodstag:t[0]["goods_tag"],goodsprice:t[0]["sell_price"],marketprice:t[0]["market_price"],goodssale:t[0]["sale"],goodsorg:t[0]["goods_org"]},r(o,"goodstag",t[0]["goods_tag"]),r(o,"card_type",d),r(o,"goodscoverimg",t[0]["activity_image"]),r(o,"share_title",t[0]["3D_image"]?t[0]["3D_image"]:a.share_title),r(o,"share_goods_wx_headimg",t[0]["share_goods_wx_headimg"]?t[0]["share_goods_wx_headimg"]:a.share_avatarUrl),r(o,"goodsdiscount",t[0]["discount"]),r(o,"discountinfo",t[0]["discount_info"]),r(o,"evalrate",parseInt(t[0]["evalrate"])),r(o,"card_content",V),r(o,"card_register_content",w),r(o,"card_register_title",y),r(o,"card_image_height",pe),r(o,"card_image_w_rate",ve),o)),a.image_save(a.share_goods_wx_headimg,"wx_headimg_cache"),setTimeout(function(){a.setData({cardnamehidden:2!=d,cardregisterhidden:1!=d,cardlovehidden:4!=d,cardcelehidden:10!=d})},800)}else wx.showToast({title:"商品已下架",icon:"loading",duration:3e3}),setTimeout(function(){wx.navigateBack()},1500)}}),wx.request({url:c+"/api/client/get_goodsdesc_list",method:"POST",data:{username:s,access_token:_,goods_id:te,refer_mid:re,page:Z,shop_type:ge,keyword:n,is_satisfy:l,rule_selected_info:g},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){for(var t=e.data.result,r=ne?1:0,o=r;o<t.image.length;o++)t.image[o]["content"]="",t.image[o]["flag"]=0==o,t.image[o]["check"]=!1,t.image[o]["like"]="10w",t.image[o]["comment"]="1045",t.image[o]["avater"]="",t.image[o]["initialTime"]=0,t.image[o]["at"]="",t.image[o]["duration"]=841,t.image[o]["objectFit"]="fill",t.image[o]["short"]=!0,"mp4"==t.image[o]["ext"]?(t.image[o]["video_url"]=t.image[o]["url"],t.image[o]["url"]=le,me.push(t.image[o])):(t.image[o]["url"].indexOf("http")<0&&(t.image[o]["url"]=c+"/"+t.image[o]["url"]),t.image[o]["url"]=t.image[o]["url"].replace("http:","https:"),t.image[o]["video_url"]="",he.push(t.image[o]));me.length>0&&(he=me.concat(he)),he[0]["template_config"]=t.image[0]["template_config"],a.goodsPicsInfo=e.data.result,a.image_pic=he,a.image_video=me,a.image_share=t.share_image,0!=t.image[0]["template_id"]&&a.swiperchange_cardname(0),le||a.image_save(he[0]["url"],"goods_image_cache_"+te),console.log(i("get_goodsdesc_list image_video:",a.image_video," image_pic:",he," at pages\\details\\details.vue:1303")),a.showGoodsinfo()}}),wx.request({url:c+"/api/client/get_goodssku_list",method:"POST",data:{username:s,access_token:_,goods_id:te,shop_type:ge,page:Z},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(i("商品goods_sku:",e.data.result," info:"+e.data.info," at pages\\details\\details.vue:1323"));var t=e.data.result.spec_select_list?e.data.result.spec_select_list:"",r=e.data.result.sku_list?e.data.result.sku_list:"{}";if(r){for(var o=0;o<r.length;o++)r[o].attrValueStatus?r[o].attrValueStatus=!0:r[o].attrValueStatus=!1;if(a.setData({commodityAttr:r}),t){for(o=0;o<t.length;o++)if(t[o].attrValueStatus||(t[o].attrValueStatus=!0),2==t[o].type)for(var d=0;d<t[o].value.length;d++)t[o].value[d].indexOf("http")<0&&(t[o].value[d]=c+"/"+t[o].value[d]);a.setData({attrValueList:t})}}}}),wx.request({url:c+"/api/client/get_order_comment",method:"POST",data:{username:s,access_token:_,goods_id:te,query_type:1,shop_type:ge},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){var t=e.data.result,r=(e.data.info,e.data.all_rows?e.data.all_rows:1);t&&(a.setData({comm_list:a.comm_list.concat(t),all_rows:r}),console.log(i("获取订单评论信息:",t," all rows:",r," at pages\\details\\details.vue:1386")))}}),5==a.goodsshape||a.goodsshape):console.log(i("单个产品名称为空",te," at pages\\details\\details.vue:1222"))},onShow:function(){var e=this;wx.getSystemInfo({success:function(a){if("ios"==a.platform)a.SDKVersion;var t=a.windowHeight,r=a.windowWidth;console.log(i("detail getSystemInfo:",a," at pages\\details\\details.vue:1429")),e.setData({dkheight:t-.05*t-100,winHeight:t,winWidth:r}),e.video_height="630rpx",e.video_width="".concat(r,"px"),wx.setStorageSync("systeminfo",a.system),wx.setStorageSync("phonemodel",a.model)}})},onReady:function(){plus.screen.lockOrientation("portrait-primary")},onHide:function(){var e=!0,a=!1,t=void 0;try{for(var i,r=this.image_pic[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.flag=!1}}catch(d){a=!0,t=d}finally{try{e||null==r.return||r.return()}finally{if(a)throw t}}},onShareAppMessage:function(){var e=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",t=e.goodsid,i=e.image_pic[0]["url"],r=e.share_title,o=e.share_desc,d=e.m_id>0?e.m_id:0;e.goodsid;return{title:r,desc:o,imageUrl:i,path:"/pages/details/details?id="+t+"&image="+i+"&refername="+a}},mounted:function(){},methods:{bindPickerChange_card_color:function(e){var a=this,t=a.card_color,r=e.detail.value;console.log(i("picker发送选择改变，携带值为",e.detail.value,t[r]["value"]," at pages\\details\\details.vue:1493")),a.setData({current_card_color:t[r]["value"],card_color_index:r})},formSubmit:function(e){var a=this,t=e.currentTarget.dataset.name;console.log(i("formSubmit() form name:",t," at pages\\details\\details.vue:1505")),"buyGift"==t?a.buyGift():"buyMyself"==t?a.buyMyself():"mycardregister"==t?a.upimg():"wishcart"==t?(a.setData({is_buymyself:0}),a.wishCart()):"mycommTapTag"==t?(a.setData({is_buymyself:0}),a.mycommTapTag()):"myblessing"==t?a.myblessing():"card_register"==t&&a.card_register()},submintFromId:function(e){var a=this,t=(e=e,a.shop_type),i=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:c+"/api/client/save_member_formid",method:"POST",data:{username:i,access_token:r,formId:e,shop_type:t},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){}})},upimg:function(e){var a=this,t=e.currentTarget.dataset.logo?e.currentTarget.dataset.logo:0;a.setData({is_logo:t}),wx.chooseImage({sizeType:["original","compressed"],success:function(e){a.setData({new_img_arr:e.tempFilePaths}),console.log(i("本次上传图片:",a.new_img_arr,e.tempFilePaths," at pages\\details\\details.vue:1568")),a.upload()}})},cancel_upimg:function(e){var a=this,t=e.currentTarget.dataset.logo?e.currentTarget.dataset.logo:0;console.log(i("cancel_upimg:",t," at pages\\details\\details.vue:1576")),1==t?a.setData({card_name_logo_image:""}):2==t?a.setData({card_register_adv:""}):4==t?a.setData({card_love_logo:""}):10==t&&a.setData({card_cele_logo:""})},upload:function(){var e=this,a=e.goodsid,t=e.new_img_arr[0],r="xcx_goods_cardregister",o=e.image_pic,d=e.is_logo;t&&wx.uploadFile({url:h,filePath:t,name:"wechat_upimg",formData:{latitude:encodeURI(0),longitude:encodeURI(0),type:encodeURI(r),city:encodeURI("杭州"),prov:encodeURI("浙江"),name:encodeURI(a)},success:function(t){var r=JSON.parse(t.data.trim());if("y"==r["status"])if(1==d)e.image_save(r["result"]["img_url"],"card_name_logo_image"),e.setData({card_name_logo_image:r["result"]["img_url"]});else if(2==d)e.setData({card_register_adv:r["result"]["img_url"]});else if(4==d)e.setData({card_love_logo:r["result"]["img_url"]});else if(10==d)e.setData({card_cele_logo:r["result"]["img_url"]});else{var s=[];e.image_save(r["result"]["img_url"],"myregistercard_image");wx.getStorageSync("myregistercard_image"),s={id:a,goods_id:a,url:r["result"]["img_url"]};o.push(s),setTimeout(function(){e.setData({image_pic:o})},3e3),console.log(i("图片上传完成:",s,o," at pages\\details\\details.vue:1656"))}else wx.showToast({title:"图片加载失败，请再试一次",icon:none,duration:2e3})}}),wx.showToast({title:"已提交！",duration:2e3});var s=e.content;s||e.setData({content:"图片:"})},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):(getApp().globalData.from_page="/pages/details/details",getApp().globalData.hall_gotop=1,wx.switchTab({url:"/pages/hall/hall"}))},commTapTag:function(){var e=this;wx.navigateTo({url:"../goods/commentlist/commentlist?goods_id="+e.goodsid})},mycommTapTag:function(){var e=this,a=e.commodityAttr[0]["id"],t=e.goodsid;wx.navigateTo({url:"../goods/comment/comment?goods_id="+t+"&goods_skuid="+a+"&comm_type=1"})},returnTapTag:function(){wx.switchTab({url:"/pages/hall/hall"})},timeupdate:function(e){var a=e.detail.duration;this.video_play_time>=a&&(this.video_play_time=0),this.video_play_time=e.detail.currentTime},videoPlay:function(){var e=this.cur_img_id?this.cur_img_id:0;0!=this.image_video.length&&(this.image_pic[e].flag=!this.image_pic[e].flag,this.image_pic[e].flag?this.videoContext.play():(this.videoContext.pause(),this.showVideo=!1),console.log(i("click videoPlay cur_img_id: ",e,this.image_pic[e].flag," at pages\\details\\details.vue:1735")))},pauseVideo:function(){console.log(i("pause Video video_play_time:",this.video_play_time,this.cur_img_id," at pages\\details\\details.vue:1739")),"undefined"!=typeof this.image_pic[this.cur_img_id].initialTime&&(this.image_pic[this.cur_img_id].initialTime=this.video_play_time)},videoEnd:function(){console.log(i("End Video video_play_time:",this.video_play_time,this.cur_img_id," at pages\\details\\details.vue:1746")),this.showVideo=!1,v.close()},videoVoice:function(){console.log(i("Open Voice of Video video_play_time:",this.video_play_time,this.cur_img_id," at pages\\details\\details.vue:1755")),this.video_muted=!this.video_muted,this.image_pic[this.cur_img_id].initialTime=this.video_play_time,this.videoContext=e.createVideoContext("myVideo",this),this.videoContext.play(),v.close()},swiperchangevideo:function(e){var a=this;a.video_oldIndex=a.video_index;var t=e.detail.current,i=!0,r=!1,o=void 0;try{for(var d,s=a.image_video[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var _=d.value;_.flag=!1}}catch(n){r=!0,o=n}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}a.image_video[t].flag=!a.image_video[t].flag,a.video_index=t},swiperchange:function(e){var a=this,t=e.detail.current;console.log(i("detail swiperchange:",e.detail.current,"cur_img_id:",t," image pic:",a.image_pic[t]," at pages\\details\\details.vue:1853"));var r=!0,o=!1,d=void 0;try{for(var s,_=a.image_pic[Symbol.iterator]();!(r=(s=_.next()).done);r=!0){var n=s.value;n.flag=!1}}catch(c){o=!0,d=c}finally{try{r||null==_.return||_.return()}finally{if(o)throw d}}a.image_pic[t].flag=!a.image_pic[t].flag,a.cur_img_id=t,""==a.image_pic[t].video_url&&(a.showVideo=!1),a.swiperchange_cardname(t)},swiperchange_share:function(e){var a=this,t=e.detail.current;a.setData({cur_img_share_id:t})},swiperchange_cardname:function(e){var a=this,t=a.image_pic,r=t[e]?t[e]["template_config"]:"",o=a.card_type,d=!1,s=!1,_=!1,n=!1,c=!1,l=!1,g=!1,u=!1,m=!1,h=!1,p=!1,v=!1,f=!1,y=!1,w=!1,x=!1,S=!1,D=!1,b=!1,T=!1,k=!1,I=!1,C=!1,V=!1,A=!1,q=!1,O=!1,j=!1,E=!1,P=!1,F=!1,R=!1,N=!1,L=!1,U=!1,J=!1,H=!1,M=!1,B=!1;if(console.log(i("detail swiperchange_cardname card_type:",o,"template_config:",r," at pages\\details\\details.vue:1916")),r&&2==o){for(var G=0;G<r.length;G++)"card_name"==r[G]["typeId"]?v=!0:"card_title"==r[G]["typeId"]?f=!0:"card_phone"==r[G]["typeId"]?y=!0:"card_tel"==r[G]["typeId"]?w=!0:"card_email"==r[G]["typeId"]?x=!0:"card_weburl"==r[G]["typeId"]?S=!0:"card_publicwechat"==r[G]["typeId"]?D=!0:"card_addr"==r[G]["typeId"]?b=!0:"card_companyname"==r[G]["typeId"]?T=!0:"card_logo"==r[G]["typeId"]?k=!0:"card_qrcode"==r[G]["typeId"]&&(I=!0);a.setData({is_card_name_name:v,is_card_name_title:f,is_card_name_phone:y,is_card_name_tel:w,is_card_name_email:x,is_card_name_website:S,is_card_name_publicwechat:D,is_card_name_addr:b,is_card_name_company:T,is_card_name_logo_image:k,is_card_name_qrcode:I})}else if(r&&1==o){for(G=0;G<r.length;G++)"card_register_title"==r[G]["typeId"]?C=!0:"card_register_content"==r[G]["typeId"]?V=!0:"card_register_adv"==r[G]["typeId"]?A=!0:"card_register_logo"==r[G]["typeId"]?q=!0:"card_register_ownername"==r[G]["typeId"]?O=!0:"card_register_ownerwechat"==r[G]["typeId"]?j=!0:"card_register_addr"==r[G]["typeId"]?E=!0:"card_register_lim"==r[G]["typeId"]?P=!0:"card_register_fee"==r[G]["typeId"]?F=!0:"register_start_date"==r[G]["typeId"]?R=!0:"register_start_time"==r[G]["typeId"]?N=!0:"register_end_date"==r[G]["typeId"]?L=!0:"register_end_time"==r[G]["typeId"]?U=!0:"action_start_date"==r[G]["typeId"]?J=!0:"action_start_time"==r[G]["typeId"]?H=!0:"action_end_date"==r[G]["typeId"]?M=!0:"action_end_time"==r[G]["typeId"]&&(B=!0);a.setData({is_card_register_title:C,is_card_register_content:V,is_card_register_adv:A,is_card_register_logo:q,is_card_register_ownername:O,is_card_register_ownerwechat:j,is_card_register_addr:E,is_card_register_lim:P,is_card_register_fee:F,is_register_start_date:R,is_register_start_time:N,is_register_end_date:L,is_register_end_time:U,is_action_start_date:J,is_action_start_time:H,is_action_end_date:M,is_action_end_time:B}),console.log(i("detail swiperchange_card name is_card_register_title:",C," is_card_register_logo:",q," at pages\\details\\details.vue:2018"))}else if(r&&4==o){for(G=0;G<r.length;G++)"card_love_title"==r[G]["typeId"]?c=!0:"card_love_content"==r[G]["typeId"]?m=!0:"card_love_phone"==r[G]["typeId"]?g=!0:"card_love_related"==r[G]["typeId"]?l=!0:"card_love_addr"==r[G]["typeId"]?u=!0:"card_love_logo"==r[G]["typeId"]?h=!0:"card_love_qrcode"==r[G]["typeId"]&&(p=!0);a.is_card_love_logo=h,a.setData({is_card_love_title:c,is_card_love_content:m,is_card_love_phone:g,is_card_love_related:l,is_card_love_addr:u,is_card_love_qrcode:p}),console.log(i("detail swiperchange_card name is_card_love_title:",a.is_card_love_title," is_card_love_logo:",a.is_card_love_logo," at pages\\details\\details.vue:2050"))}else if(r&&10==o){for(G=0;G<r.length;G++)"card_cele_title"==r[G]["typeId"]?d=!0:"card_cele_content"==r[G]["typeId"]?s=!0:"card_cele_logo"==r[G]["typeId"]?_=!0:"card_cele_qrcode"==r[G]["typeId"]&&(n=!0);a.setData({is_card_cele_title:d,is_card_cele_content:s,is_card_cele_logo:_,is_card_cele_qrcode:n}),console.log(i("detail swiperchange_cardname is_card_cele_content:",s," at pages\\details\\details.vue:2071"))}},card_cele_titleTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_cele_title:t})},card_cele_contentTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_cele_content:t})},card_love_titleTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_love_title:t})},card_love_phoneTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_love_phone:t})},card_love_relatedTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_love_related:t})},card_love_addrTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_love_addr:t})},card_love_contentTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_love_content:t})},card_name_nameTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.card_name_name=t},card_name_titleTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_title:t})},card_name_phoneTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_phone:t})},card_name_telTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_tel:t})},card_name_emailTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_email:t})},card_name_websiteTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_website:t})},card_name_publicwechatTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_publicwechat:t})},card_name_addrTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_addr:t})},card_name_companyTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_company:t})},cardnameNoteTextAreaBlur:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_name_note:t}),a.confirmcardinput()},cardRegisterTextAreaBlur:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_register_content:t})},cardregistertitleTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_register_title:t})},cardregisterLimTapTag:function(e){var a=this,t=e.detail.value;t.replace("不限",""),a.setData({card_register_lim:t}),console.log(i("card_register_lim:",a.card_register_lim," at pages\\details\\details.vue:2213"))},cardregisterFeeTapTag:function(e){var a=this;a.setData({card_register_fee:e.detail.value})},cardregisterAddrTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_register_addr:t})},cardregisterOwnerNameTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_register_ownername:t})},cardregisterOwnerWechatTapTag:function(e){var a=this,t=o.filterEmoji(e.detail.value);a.setData({card_register_ownerwechat:t})},shareConfirmCardCele:function(){var e=this;e.setData({cardcelehidden:!e.cardcelehidden}),e.confirmcardinput()},shareCandelCardCele:function(){var e=this;e.setData({cardcelehidden:!e.cardcelehidden})},confirmcardinput:function(){var e=this,a=e.card_type,t=e.is_buymyself;if(1==a){var o,d=[(o={card_color:e.current_card_color,card_register_title:e.card_register_title,card_register_content:e.card_register_content,card_register_adv:e.card_register_adv,image:e.card_register_img,register_start_date:e.register_start_date,register_end_date:e.register_end_date},r(o,"register_end_date",e.register_end_date),r(o,"register_start_time",e.register_start_time),r(o,"register_end_time",e.register_end_time),r(o,"action_start_date",e.action_start_date),r(o,"action_end_date",e.action_end_date),r(o,"action_start_time",e.action_start_time),r(o,"action_end_time",e.action_end_time),r(o,"card_register_lim",e.card_register_lim),r(o,"card_register_fee",e.card_register_fee),r(o,"card_register_addr",e.card_register_addr),r(o,"card_register_ownername",e.card_register_ownername),r(o,"card_register_ownerwechat",e.card_register_ownerwechat),r(o,"card_register_right_index",e.card_register_right_index),r(o,"card_register_reqid_index",e.card_register_reqid_index),r(o,"has_shlogo",e.has_shlogo),r(o,"has_registerdue",e.has_registerdue),r(o,"has_actiondue",e.has_actiondue),o)];wx.setStorageSync("card_register_info",JSON.stringify(d[0])),console.log(i("card_register_info:",wx.getStorageSync("card_register_info")," at pages\\details\\details.vue:2291"))}else if(2==a){var s=[{card_name_name:e.card_name_name,card_name_title:e.card_name_title,card_name_phone:e.card_name_phone,card_name_tel:e.card_name_tel,card_name_email:e.card_name_email,card_name_website:e.card_name_website,card_name_publicwechat:e.card_name_publicwechat,card_name_addr:e.card_name_addr,card_name_company:e.card_name_company,card_name_logo_image:e.card_name_logo_image,card_name_note:e.card_name_note,has_shlogo:e.has_shlogo}];wx.setStorageSync("card_name_info",JSON.stringify(s[0])),console.log(i("card_name_info:",wx.getStorageSync("card_name_info")," at pages\\details\\details.vue:2308"))}else if(4==a){var _=[{card_love_title:e.card_love_title,card_love_phone:e.card_love_phone,card_love_related:e.card_love_related,card_love_addr:e.card_love_addr,card_love_content:e.card_love_content,card_love_logo:e.card_love_logo,has_shlogo:e.has_shlogo}];wx.setStorageSync("card_love_info",JSON.stringify(_[0])),console.log(i("card_love_info:",wx.getStorageSync("card_love_info")," at pages\\details\\details.vue:2320"))}else if(10==a){var n=[{card_cele_title:e.card_cele_title,card_cele_content:e.card_cele_content,card_cele_logo:e.card_cele_logo,has_shlogo:e.has_shlogo}];wx.setStorageSync("card_cele_info",JSON.stringify(n[0])),console.log(i("card_cele_info:",wx.getStorageSync("card_cele_info")," at pages\\details\\details.vue:2329"))}e.setData({inputShowed:!1,goodsmodel_count:0}),1==t&&e.goodsmodel()},bindChangeStartDate:function(e){var a=this,t=e.detail.value;a.setData({register_start_date:t}),console.log(i("register_start_date:"+a.register_start_date," at pages\\details\\details.vue:2347"))},bindChangeStartTime:function(e){var a=this,t=e.detail.value;a.setData({register_start_time:t}),console.log(i("register_start_time:"+a.register_start_time," at pages\\details\\details.vue:2355"))},bindChangeEndDate:function(e){var a=this,t=e.detail.value,r=a.register_end_time+":00",d=a.register_start_date+" "+a.register_start_time+":00",s=t+" "+r,_=o.calDateDiff(d,s);_>0?a.setData({register_end_date:t}):wx.showToast({title:"结束时间小于开始时间",icon:"none",duration:1500}),console.log(i("register_end_date:",a.register_end_date,d,s," at pages\\details\\details.vue:2377"))},bindChangeEndTime:function(e){var a=this,t=e.detail.value,r=a.register_end_date,d=a.register_start_date+" "+a.register_start_time+":00",s=r+" "+t+":00",_=o.calDateDiff(d,s);_>0?a.setData({register_end_time:t}):wx.showToast({title:"结束时间小于开始时间",icon:"none",duration:1500}),console.log(i("register_end_time:"+a.register_end_time,d,s," at pages\\details\\details.vue:2399"))},bindChangeActStartDate:function(e){var a=this,t=e.detail.value;a.setData({action_start_date:t}),console.log(i("action_start_date:"+a.action_start_date," at pages\\details\\details.vue:2407"))},bindChangeActStartTime:function(e){var a=this,t=e.detail.value;a.setData({action_start_time:t}),console.log(i("action_start_time:"+a.action_start_time," at pages\\details\\details.vue:2415"))},bindChangeActEndDate:function(e){var a=this,t=e.detail.value,r=a.action_end_time+":00",d=a.action_start_date+" "+a.action_start_time+":00",s=t+" "+r,_=o.calDateDiff(d,s);_>0?a.setData({action_end_date:t}):wx.showToast({title:"结束时间小于开始时间",icon:"none",duration:1500}),console.log(i("action_end_date:"+a.action_end_date,d,s," at pages\\details\\details.vue:2437"))},bindChangeActEndTime:function(e){var a=this,t=e.detail.value,r=a.action_end_date,d=a.action_start_date+" "+a.action_start_time+":00",s=r+" "+t+":00",_=o.calDateDiff(d,s);_>0?a.setData({action_end_time:t}):wx.showToast({title:"结束时间小于开始时间",icon:"none",duration:1500}),console.log(i("action_end_time:"+a.action_end_time,d,s," at pages\\details\\details.vue:2459"))},bindChangeRegisterRight:function(e){var a=this,t=e.detail.value;a.setData({card_register_right_index:t}),console.log(i("card_register_right:"+a.card_register_right_index," at pages\\details\\details.vue:2467"))},bindChangeRegisterReqid:function(e){var a=this,t=e.detail.value;a.setData({card_register_reqid_index:t}),console.log(i("card_register_reqid_index:"+a.card_register_reqid_index," at pages\\details\\details.vue:2475"))},sharegoodsTapTag:function(){var e=this,a=e.goodsid,t=e.goodsorg,r=e.goodsshape?e.goodsshape:1,o=e.goodsprice,d=e.goodsname;d=d.replace(/\&/g," ");var s=e.cur_img_id,_=e.share_goods_wx_headimg?e.share_goods_wx_headimg:e.share_avatarUrl,n=e.qr_type?e.qr_type:"wishshare",c="";c=5==r||4==r?e.card_content:e.share_title;var l=e.share_desc,g=(e.share_avatarUrl,wx.getStorageSync("wx_headimg_cache"),wx.getStorageSync("goods_image_cache_"+a),e.share_goods_qrcode),u=e.card_type;if(0==e.cur_img_id)var m=e.image_pic[s]["url"];else{s-=e.image_video.length;m=e.image_pic[s]["url"]}5!=r&&4!=r&&(console.log(i("商品分享 share_goods_id:",a," share_goods_qrcode:",g," at pages\\details\\details.vue:2515")),wx.navigateTo({url:"/pages/wish/wishshare/wishshare?share_goods_id="+a+"&share_goods_shape="+r+"&share_goods_org="+t+"&share_goods_name="+d+"&share_goods_price="+o+"&share_goods_image="+m+"&share_goods_wx_headimg="+_+"&share_goods_title="+c+"&share_goods_desc="+l+"&share_goods_image2="+e.image_pic[s]["url"]+"&qr_type="+n+"&card_type="+u}))},image_save:function(a,t){var r=this;console.log(i("imge save image url:",a,"image_cache_name:",t," at pages\\details\\details.vue:2555")),e.downloadFile({url:a,success:function(a){console.log(i("downloadFile success, res is",a," at pages\\details\\details.vue:2559"));var o=a.tempFilePath;e.saveFile({tempFilePath:o,success:function(a){e.setStorageSync(t,a.savedFilePath),r.image_save_count=r.image_save_count+1},fail:function(e){}})},fail:function(e){console.log(i("downloadFile fail, err is:",e," at pages\\details\\details.vue:2587"))}})},has_auth:function(){wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]||wx.navigateTo({url:"/pages/login/login?frompage=/pages/details/details"})}})},bindplay:function(a){this.showVideo=!0,this.image_pic[this.cur_img_id].flag=!0,this.videoContext=e.createVideoContext("myVideo",this),this.videoContext.seek(1)},createView:function(){v=new plus.nativeObj.View("video_cover_view",{top:"0px",left:"0px",height:"50px",width:"50px"},[{tag:"img",id:"img",src:"/static/play.png",position:{top:"0px",left:"0px",width:"100%",height:"100%"}},{tag:"rect",id:"rect",color:"#FF0000",position:{top:"0px",left:"0px",width:"100%",height:"1px"}},{tag:"font",id:"font",text:"视频播放",textStyles:{size:"18px"}}]),plus.webview.currentWebview().append(v),v.show()},myblessing:function(){var e=this;e.setData({notehidden:!e.notehidden})},cardEditTapTag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=this,t=a.card_type;1==t?a.setData({cardregisterhidden:!a.cardregisterhidden,is_buymyself:e||0,card_name_modal_title:"编辑内容"}):2==t?a.setData({cardnamehidden:!a.cardnamehidden,is_buymyself:e||0}):4==t?a.setData({cardlovehidden:!a.cardlovehidden,is_buymyself:e||0}):10==t&&a.setData({cardcelehidden:!a.cardcelehidden,is_buymyself:e||0})},shareConfirmCardLove:function(){var e=this;e.setData({cardlovehidden:!e.cardlovehidden}),e.confirmcardinput()},shareCandelCardLove:function(){var e=this;e.setData({cardlovehidden:!e.cardlovehidden})},shareConfirmCardName:function(){var e=this;e.setData({cardnamehidden:!e.cardnamehidden}),e.confirmcardinput()},shareCandelCardName:function(){var e=this;e.setData({cardnamehidden:!e.cardnamehidden})},shareConfirmCardRegister:function(){var e=this;e.setData({cardregisterhidden:!e.cardregisterhidden}),e.confirmcardinput()},shareCandelCardRegister:function(){var e=this;e.setData({cardregisterhidden:!e.cardregisterhidden})},card_register:function(){var e=this;e.setData({cardregisterhidden:!e.cardregisterhidden})},save_recorder:function(e){var a=this,t=a.goods_id;a.current_voice=e,wx.uploadFile({url:h,filePath:e,name:"wechat_upimg",formData:{latitude:encodeURI(0),longitude:encodeURI(0),restaurant_id:encodeURI(0),city:encodeURI("杭州"),prov:encodeURI("浙江"),name:encodeURI(t)},success:function(t){var r=JSON.parse(t.data.trim()),o="";"y"==r["status"]?(o=r["result"]["img_url"],a.setData({new_rec_url:o}),wx.setStorageSync("cardvoice",o),wx.setStorageSync("cardvoicetime",a.recordingTimeqwe),console.log(i("录音上传完成",e,o,a.recordingTimeqwe," at pages\\details\\details.vue:2768"))):(wx.showToast({title:"录音上传返回失败",icon:"none",duration:1e3}),console.log(i("录音上传返回失败",e,o," at pages\\details\\details.vue:2775")))}})},play_rec:function(){var e=this,a=e.new_rec_url;e.current_voice?(p.src=e.current_voice,p.play()):a?wx.downloadFile({url:a,success:function(e){200===e.statusCode&&(p.src=e.tempFilePath,p.play(),console.log(i("录音播放完成",e.tempFilePath," at pages\\details\\details.vue:2795")))}}):wx.showToast({title:"暂无录音",icon:"none",duration:1e3})},imgYu:function(a){var t=a.currentTarget.dataset.src,i=[],r=this.image_pic,o=this.card_type;if(0==o){for(var d=0;d<r.length;d++)i.push(r[d]["url"]);e.previewImage({current:t,urls:i})}else this.cardEditTapTag()},bindMinus:function(e){var a=this,t=a.buynum;t--,a.setData({buynum:t>0?t:1})},bindPlus:function(e){var a=this,t=a.buynum;t++;this.setData({buynum:t<=1?1:t})},goodsmodel:function(e){var a=this,t=e.modalHidden;a.modalName="bottomModal";var r=e.goodsmodel_count,o=e.goodsname?e.goodsname:"",d=e.commodityAttr?e.commodityAttr:a.options.commodityAttr,s=e.attrValueList?e.attrValueList:a.attrValueList,_=e.is_buymyself?e.is_buymyself:0,n=e.goodsshape?e.goodsshape:0,c=e.card_type?e.card_type:0,l=(e.card_register_title&&e.card_register_title,e.card_register_content,e.card_register_addr,d[0]?d[0].id:0),g=d[0]?d[0].sell_price:0,u=d[0]?d[0].delivery_price:0;d.length>0?(console.log(i("detail goodsmodel is_buymyself:",_,"goodsshape:",n," card_type:",c," at pages\\details\\details.vue:2870")),s.length>0?(a.modalHidden=!t,a.sku_id=l,a.sku_sell_price=g,a.sku_delivery_price=u,a.add_cart_title="商品名称",a.wishflag=0,console.log(i("挑选 sku_id:"+d[0].id,"modalHidden:",t," at pages\\details\\details.vue:2878"))):(console.log(i("送礼 sku_id:"+d[0].id,"attrValueList:",s," at pages\\details\\details.vue:2880")),a.modalHidden=!t,a.sku_id=l,a.sku_sell_price=g,a.sku_delivery_price=u,a.add_cart_title=o,a.wishflag=0,c>0&&(e["sku_id"]=l,e["add_cart_title"]=o,e["wishflag"]=0,a.addCart(e)))):setTimeout(function(){r+=1,r<15?(wx.showToast({title:"加载中...",icon:"loading",duration:1e3}),e.goodsmodel_count=r,e.commodityAttr=e.commodityAttr?e.commodityAttr:a.options.commodityAttr,e.attrValueList=e.attrValueList?e.attrValueList:a.attrValueList,a.goodsmodel_count=r,0==_?a.buyGift():a.buyMyself()):(a.goodsmodel_count=0,wx.showToast({title:"系统繁忙!",icon:"loading",duration:1500}),a.goBack())},500)},wishCart:function(){var e=this,a=e.attrValueList,t=e.commodityAttr;a.length>0?e.setData({modalHidden:!e.modalHidden,sku_id:t[0]?t[0].id:0,add_cart_title:"商品名称",wishflag:1}):(e.setData({sku_id:t[0]?t[0].id:0,wishflag:1}),e.addCart())},buyMyself:function(){var e=this;e.goodsshape,e.refer_mid,e.card_type;console.log(i("buyMyself card_type:",e.card_type,"goodsshape:",e.goodsshape," at pages\\details\\details.vue:2951")),e.is_buymyself=1,e.goodsmodel_count=0;var a={};a["goodsname"]=e.goodsname,a["commodityAttr"]=e.commodityAttr,a["attrValueList"]=e.attrValueList,a["goodsmodel_count"]=e.goodsmodel_count,a["goodsshape"]=e.goodsshape,a["modalHidden"]=e.modalHidden,a["is_buymyself"]=e.is_buymyself,a["card_type"]=e.card_type,a["card_register_title"]=e.card_register_title,a["card_register_content"]=e.card_register_content,a["card_register_addr"]=e.card_register_addr,e.goodsmodel(a)},buyGift:function(){var e=this;e.is_buymyself=0,e.goodsmodel_count=0,console.log(i("buyGift card_type:",e.card_type,"goodsshape:",e.goodsshape," at pages\\details\\details.vue:2982"));var a={};a["goodsname"]=e.goodsname,a["commodityAttr"]=e.commodityAttr,a["attrValueList"]=e.attrValueList,a["goodsmodel_count"]=e.goodsmodel_count,a["goodsshape"]=e.goodsshape,a["modalHidden"]=e.modalHidden,a["is_buymyself"]=e.is_buymyself,a["card_type"]=e.card_type,a["card_register_title"]=e.card_register_title,a["card_register_content"]=e.card_register_content,a["card_register_addr"]=e.card_register_addr,a["card_register_addr"]=e.card_register_addr,e.goodsmodel(a)},modalBindconfirm:function(){this.setData({modalHidden:!this.modalHidden}),this.addCart()},modalBindcancel:function(){this.setData({modalHidden:!this.modalHidden})},addCart:function(){var e=this,a=e.is_buymyself,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",i=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=e.keyword,o=e.is_satisfy,d=e.rule_selected_info;t?e.sku_id?e.insertCart(e.sku_id,e.buynum,t,i,e.shop_type,e.wishflag,a,r,o,d):wx.showToast({title:"该产品无货",icon:"loading",duration:1500}):wx.navigateTo({url:"../login/login?goods_id="+e.goodsid})},insertCart:function(e,a,t,r,o,d,s,_,n,l){var g=this,u=g.order_shape;wx.request({url:c+"/api/client/add_cart",method:"POST",data:{username:t,access_token:r,sku_id:e,num:a,wishflag:d,shop_type:o,keyword:_,is_satisfy:n,rule_selected_info:l},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(i("details insertCart res data:",e.data," wishflag：",d," at pages\\details\\details.vue:3064"));var a=1==d?"已加入心愿单":"已加入礼物包";a=1==s?"自购礼品":a,a=g.card_type>0?"加载中":a,a=5==u||4==u?"处理中":a,wx.showToast({title:a,icon:"loading",duration:2e3}),getApp().globalData.from_page="/pages/details/details",1==d?wx.switchTab({url:"/pages/wish/wish"}):1==s?g.queryCart():(console.log(i("details insertCart wishflag:",d," at pages\\details\\details.vue:3089")),getApp().globalData.hall_gotop=1,wx.switchTab({url:"/pages/hall/hall"}))}})},queryCart:function(){var e=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",t=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r="gift",o="送你一份礼物，希望你喜欢!",d=(e.order_image,e.buynum),s=e.sku_sell_price,_=(parseFloat(s),e.sku_id),n=e.is_buymyself,g=e.cur_img_id,u=e.image_pic[g]["url"],m=e.image_pic[g]["template_config"],h=e.new_rec_url?e.new_rec_url:"",p=e.recordingTimeqwe?e.recordingTimeqwe:0,v=e.goodsshape,f=(e.current_card_color,e.card_type);5!=v&&4!=v||(o=e.card_content,0!=g&&(g-=e.image_video.length,u=e.image_pic[g]["url"])),wx.request({url:c+"/api/client/query_cart",method:"POST",data:{username:a,access_token:t,shop_type:l,sku_id:_},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(s){var l=[];if(s.data.result){var g=s.data.result.list,y=0;for(var w in g){g[w]["sku_list"][0]["image"]=u;for(var x=0;x<g[w]["sku_list"].length;x++)g[w]["sku_list"][x]["image"].indexOf("http")<0&&(g[w]["sku_list"][x]["image"]=c+"/"+g[w]["sku_list"][x]["image"]),g[w]["sku_list"][x]["selected"]=!0,g[w]["sku_list"][x]["shop_id"]=w,g[w]["sku_list"][x]["objectId"]=g[w]["sku_list"][x]["id"],l[y]=g[w]["sku_list"][x],y++}e.setData({carts:l,all_rows:l.length,is_buymyself:0});var S=parseFloat(e.sku_sell_price)*d;if(5!=v&&4!=v)wx.navigateTo({url:"../order/checkout/checkout?cartIds="+_+"&amount="+S+"&carts="+JSON.stringify(l)+"&is_buymyself="+n+"&order_type="+r+"&order_shape="+v+"&order_image="+u+"&username="+a+"&token="+t});else if(5==v){var D=wx.getStorageSync("card_cele_info");console.log(i("detail checkout 贺卡请柬互动卡  order_image:",u," carts:",l," at pages\\details\\details.vue:3192")),wx.navigateTo({url:"../order/checkout/checkout?cartIds="+_+"&amount="+S+"&carts="+JSON.stringify(l)+"&is_buymyself="+n+"&order_type="+r+"&order_shape="+v+"&order_voice="+h+"&order_voicetiime="+p+"&order_note="+o+"&order_image="+u+"&card_cele_info="+D+"&card_template="+JSON.stringify(m)+"&username="+a+"&token="+t})}else if(4==v)if(1==f){var b=wx.getStorageSync("card_register_info");console.log(i("detail checkout 互动卡 register card order_image:",u," card_register_info:",b," share_goods_template:",m," at pages\\details\\details.vue:3200")),wx.navigateTo({url:"../order/checkout/checkout?cartIds="+_+"&amount="+S+"&carts="+JSON.stringify(l)+"&is_buymyself="+n+"&order_type="+r+"&order_shape="+v+"&order_voice="+h+"&order_voicetiime="+p+"&order_note="+o+"&order_color="+m[0]["color"]+"&order_image="+u+"&card_register_info="+b+"&card_template="+JSON.stringify(m)+"&username="+a+"&token="+t})}else if(2==f){var T=wx.getStorageSync("card_name_info");console.log(i("detail checkout 互动卡 name card  order_image:",u," card_name_info:",T," share_goods_template:",m," at pages\\details\\details.vue:3207")),wx.navigateTo({url:"../order/checkout/checkout?cartIds="+_+"&amount="+S+"&carts="+JSON.stringify(l)+"&is_buymyself="+n+"&order_type="+r+"&order_shape="+v+"&order_voice="+h+"&order_voicetiime="+p+"&order_note="+o+"&order_color="+m[0]["color"]+"&order_image="+u+"&card_name_info="+T+"&card_template="+JSON.stringify(m)+"&username="+a+"&token="+t})}else if(4==f){var k=wx.getStorageSync("card_love_info");console.log(i("detail checkout 互动卡 love card  order_image:",u," card_love_info:",k," share_goods_template:",m," at pages\\details\\details.vue:3215")),wx.navigateTo({url:"../order/checkout/checkout?cartIds="+_+"&amount="+S+"&carts="+JSON.stringify(l)+"&is_buymyself="+n+"&order_type="+r+"&order_shape="+v+"&order_voice="+h+"&order_voicetiime="+p+"&order_note="+o+"&order_color="+m[0]["color"]+"&order_image="+u+"&card_love_info="+k+"&card_template="+JSON.stringify(m)+"&username="+a+"&token="+t})}}else wx.showToast({title:"未挑选商品"+s.data.info,icon:"none",duration:1500})}})},showGoodsinfo:function(){var e=this;e.setData({hideviewgoodsinfo:!1}),e.setData({hideviewgoodsinfoflag:!e.hideviewgoodsinfoflag,goodsinfoshowflag:1,scrollTop:e.scrollTop_init,dkcontent:e.goodsPicsInfo.desc["desc"]})},showGoodspara:function(){var e=this;e.setData({hideviewgoodspara:!e.hideviewgoodspara}),e.hideviewgoodsparaflag&&e.goodsPicsInfo.desc&&d.wxParse("dkcontent2","html",e.goodsPicsInfo.desc["desc2"],e,1),e.setData({hideviewgoodsparaflag:!1})},getAttrIndex:function(e,a){for(var t=0;t<a.length;t++)if(e==a[t].name)break;return t<a.length?t:-1},isValueExist:function(e,a){for(var t=0;t<a.length;t++)if(a[t]==e)break;return t<a.length},selectAttrValue:function(e){var a=this,t=a.attrValueList,i=e.currentTarget.dataset.index,r=(a.firstIndex,e.currentTarget.dataset.valueindex),o=e.currentTarget.dataset.key,d=e.currentTarget.dataset.value,s=e.currentTarget.dataset.status,_=e.currentTarget.dataset.selectedvalue;this.setData({firstIndex:i,secondIndex:r}),(s||r==a.secondIndex)&&(2==t[i].type&&(d=t[i].note[r]),_==d?a.disSelectValue(i,o,d):a.selectValue(i,o,d)),a.setData({sku_id:"",sku_gov_price:"",sku_earnest_price:"",sku_sell_price:"",sku_delivery_price:""});for(var n="",c=0;c<t.length;c++)t[c].selectedValue&&(n=n+t[c].selectedValue+";");for(c=0;c<a.commodityAttr.length;c++)n.indexOf(a.commodityAttr[c].sku_key)>=0&&a.setData({sku_id:a.commodityAttr[c].id,sku_gov_price:a.commodityAttr[c].gov_price,sku_earnest_price:a.commodityAttr[c].earnest_price,sku_sell_price:a.commodityAttr[c].sell_price,sku_delivery_price:a.commodityAttr[c].delivery_price})},selectValue:function(e,a,t){var i=this,r=i.attrValueList;r[e].selectedValue=t,i.setData({attrValueList:r})},disSelectValue:function(e,a,t){var i=this,r=i.attrValueList;r[e].selectedValue="",this.setData({sku_id:"",sku_gov_price:"",sku_earnest_price:"",attrValueList:r})},shlogoChange:function(e){var a=this,t=e.detail.value;console.log(i("shlogoChange：",e.detail.value," at pages\\details\\details.vue:3380")),a.setData({has_shlogo:t}),a.confirmcardinput()},registerDueChange:function(e){var a=this,t=e.detail.value;console.log(i("registerDueChange",e.detail.value," at pages\\details\\details.vue:3389")),a.setData({has_registerdue:t}),a.confirmcardinput()},actionDueChange:function(e){var a=this,t=e.detail.value;console.log(i("actionDueChange",e.detail.value," at pages\\details\\details.vue:3398")),a.setData({has_actiondue:t}),a.confirmcardinput()},setData:function(e){var a,t,i=this,r=[];Object.keys(e).forEach(function(o){r=o.split("."),a=e[o],t=i.$data,r.forEach(function(e,o){o+1==r.length?i.$set(t,e,a):t[e]||i.$set(t,e,{}),t=t[e]})})}}};a.default=y}).call(this,t("6e42")["default"],t("0de9")["default"])},b639:function(e,a,t){"use strict";var i=t("3ae5"),r=t.n(i);r.a},e6ca:function(e,a,t){"use strict";var i=function(){var e=this,a=e.$createElement;e._self._c},r=[];t.d(a,"a",function(){return i}),t.d(a,"b",function(){return r})}},[["5b76","common/runtime","common/vendor"]]]);