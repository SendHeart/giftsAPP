(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/address/add/add"],{"59e5":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");n(a("66fd"));var t=n(a("cd39"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},7158:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},s=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s})},b1d8:function(e,t,a){"use strict";a.r(t);var n=a("f2e3"),s=a.n(n);for(var d in n)"default"!==d&&function(e){a.d(t,e,function(){return n[e]})}(d);t["default"]=s.a},cd39:function(e,t,a){"use strict";a.r(t);var n=a("7158"),s=a("b1d8");for(var d in s)"default"!==d&&function(e){a.d(t,e,function(){return s[e]})}(d);a("f870");var o=a("2877"),r=Object(o["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports},d0c6:function(e,t,a){},f2e3:function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o(a("a34a")),d=o(a("80dc"));function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t,a,n,s,d,o){try{var r=e[d](o),i=r.value}catch(c){return void a(c)}r.done?t(i):Promise.resolve(i).then(n,s)}function i(e){return function(){var t=this,a=arguments;return new Promise(function(n,s){var d=e.apply(t,a);function o(e){r(d,n,s,o,i,"next",e)}function i(e){r(d,n,s,o,i,"throw",e)}o(void 0)})}}var c=getApp().globalData.weburl,u=(a("ef60"),getApp().globalData.mapkey),l=a("3936"),g=(new Date).getTime(),p=getApp().globalData.shop_type,m=getApp().globalData.uploadurl,f=(l=a("717f"),l.formatLocation,{data:function(){return{current:0,username:null,token:null,addressId:null,province:[],city:[],region:[],town:[],provinceId:[],cityId:[],regionId:[],townId:[],provinceObjects:[],cityObjects:[],regionObjects:[],townObjects:[],areaSelectedStr:"请选择省市区",full_name:"",maskVisual:"hidden",provinceName:"请选择",shop_type:p,uploadurl:m,img_arr:[],new_img_arr:[],upimg_url:[],formdata:"",currenttime:g?parseInt(g/1e3):0,qqmapkey:u,endtime:"",activity_name:"",detail:"",mobile:"",new_img_url:"",address:"",animationData:"",regionName:"",townName:"",provinceIndex:"",cityIndex:"",regionIndex:"",townIndex:"",cityName:"",latitude:"",longitude:"",is_activity:0,is_buymyself:0,title:"getLocation",hasLocation:!1,location:{},type:""}},components:{},props:{},onLoad:function(e){var t=this,a=e.is_buymyself?e.is_buymyself:0,n=e.is_activity?e.is_activity:0,s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",d=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";s||wx.navigateTo({url:"../login/login?is_permission=1"}),t.is_buymyself=a,t.is_activity=n,t.setData({username:s,token:d}),t.getLocation(),wx.request({url:c+"/api/client/get_area_list",method:"POST",data:{parent_id:0},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){for(var a=e.data.result,n=[],s=0;s<a.length;s++)n[s]=a[s]["area_name"];t.setData({province:n,provinceObjects:a})}}),1==n?t.loadAddress_activity(e):t.loadAddress_member(e),t.cascadePopup()},methods:{getLocation:function(){var e=i(s.default.mark(function e(){var t;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.checkPermission();case 2:if(t=e.sent,1===t){e.next=5;break}return e.abrupt("return");case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getSetting:function(){return new Promise(function(t,a){e.getSetting({success:function(e){void 0!==e.authSetting["scope.userLocation"]?e.authSetting["scope.userLocation"]?t(1):t(2):t(0)}})})},openSetting:function(){var t=this;this.hideConfirm(),e.openSetting({success:function(e){e.authSetting&&e.authSetting["scope.userLocation"]&&t.doGetLocation()},fail:function(e){}})},checkPermission:function(){var t=i(s.default.mark(function t(){var a;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!d.default.isIOS){t.next=6;break}return t.next=3,d.default.requestIOS("location");case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,d.default.requestAndroid("android.permission.ACCESS_FINE_LOCATION");case 8:t.t0=t.sent;case 9:return a=t.t0,null===a||1===a?a=1:2===a?e.showModal({content:"系统定位已关闭",confirmText:"设置",success:function(e){e.confirm&&d.default.gotoiOSSetting()}}):a.code?e.showModal({content:a.message}):e.showModal({content:"需要定位权限",confirmText:"设置",success:function(e){e.confirm&&d.default.gotoAppSetting()}}),t.abrupt("return",a);case 12:case"end":return t.stop()}},t,this)}));function a(){return t.apply(this,arguments)}return a}(),clear:function(){this.hasLocation=!1},formSubmit:function(e){var t=this,a=this.username,n=this.token,s=t.areaSelectedStr,d=e.detail.value.detail,o=e.detail.value.activity_name,r=e.detail.value.mobile,i=e.detail.value.full_name,c=e.detail.value.waitting,u=t.currenttime+60*c*60,l=t.is_activity?t.is_activity:0;t.is_buymyself&&t.is_buymyself;"请选择省市区"!=s&&""!=s?""!=d?""!=o||1!=l?/^1[34578]\d{9}$/.test(r)?(t.setData({username:a,token:n,endtime:u,activity_name:o,detail:d,mobile:r,full_name:i}),1==l?t.upload():t.update_member_address()):wx.showToast({title:"请填写正确手机号码"}):wx.showToast({title:"请填写备注"}):wx.showToast({title:"请填写详情地址"}):wx.showToast({title:"请输入区域"})},upload:function(){for(var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=e.goods_id,d=e.new_img_arr,o=[],r=e.provinceObjects[e.provinceIndex],i=e.cityObjects[e.cityIndex],u=e.regionObjects[e.regionIndex],l=e.townObjects[e.townIndex],g=e.addressId,p=e.endtime,f=(e.activity_image,e.activity_name),v=e.detail,_=e.areaSelectedStr+e.detail,h=e.mobile,w=(e.latitude,e.longitude,0);w<d.length;w++){var y=d.length;wx.uploadFile({url:m,filePath:d[w],name:"wechat_upimg",formData:{latitude:encodeURI(0),longitude:encodeURI(0),restaurant_id:encodeURI(0),city:encodeURI("杭州"),prov:encodeURI("浙江"),name:encodeURI(s)},success:function(s){var d=JSON.parse(s.data.trim());"y"==d["status"]&&(o.push(d["result"]["img_url"]),e.setData({new_img_url:o}),y--,console.log(n("图片上传完成:",e.new_img_url," count:",y," at pages\\address\\add\\add.vue:428")),0==y&&wx.request({url:c+"/api/client/update_activity_address",method:"POST",data:{username:t,access_token:a,id:g,activity_name:f,prov:r?r.area_id:"",city:i?i.area_id:"",area:u?u.area_id:"",town:l?l.area_id:"",address:_,address_name:v,tel:h,image:o[0]?o[0]:"",image2:o[1]?o[1]:"",image3:o[2]?o[2]:"",endtime:p,latitude:e.latitude,longitude:e.longitude},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\address\\add\\add.vue:458")),console.log(n(e.data.info," at pages\\address\\add\\add.vue:459")),(e.data.status="y")?(wx.showToast({title:"保存成功",duration:1e3}),setTimeout(function(){wx.navigateBack()},500)):wx.showToast({title:"保存失败",content:e.data.info,duration:2e3})},function:function(e){console.log(n(e," at pages\\address\\add\\add.vue:481"))}}))}})}},update_member_address:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=e.provinceObjects[e.provinceIndex],d=e.cityObjects[e.cityIndex],o=e.regionObjects[e.regionIndex],r=e.townObjects[e.townIndex],i=e.addressId?e.addressId:0,u=e.shop_type,l=e.detail,g=e.areaSelectedStr+e.detail,p=e.mobile,m=e.full_name;wx.request({url:c+"/api/client/update_member_address",method:"POST",data:{username:t,access_token:a,shop_type:u,id:i,prov:s?s.area_id:"",city:d?d.area_id:"",area:o?o.area_id:"",town:r?r.area_id:"",address:g,address_name:l,tel:p,full_name:m},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\address\\add\\add.vue:528")),console.log(n(e.data.info," at pages\\address\\add\\add.vue:529")),wx.showToast({title:"保存成功",duration:500}),setTimeout(function(){wx.navigateBack()},500)},function:function(e){console.log(n(e," at pages\\address\\add\\add.vue:541"))}})},upimg:function(){var e=this,t=e.new_img_arr,a=e.img_arr;console.log(n("upimg img_arr:",a," at pages\\address\\add\\add.vue:552")),a.length+t.length<3?wx.chooseImage({sizeType:["original","compressed"],success:function(a){e.setData({new_img_arr:t.concat(a.tempFilePaths)}),console.log(n("本次上传图片:",e.new_img_arr," at pages\\address\\add\\add.vue:562"))}}):wx.showToast({title:"最多上传三张图片",icon:"loading",duration:3e3})},cancel_upimg:function(e){var t=this,a=e.currentTarget.dataset.id,s=[],d=t.img_arr,o=0;console.log(n("cancel_upimg:",d.length,"id:",a," at pages\\address\\add\\add.vue:579"));for(var r=0;r<d.length;r++)r!=a&&(s[o++]=d[r]);t.setData({img_arr:s})},cancel_new_upimg:function(e){var t=this,a=e.currentTarget.dataset.id,s=[],d=(t.img_arr,t.new_img_arr),o=0;console.log(n("cancel_upimg:",d.length,"id:",a," at pages\\address\\add\\add.vue:598"));for(var r=0;r<d.length;r++)r!=a&&(s[o++]=d[r]);t.setData({new_img_arr:s})},loadAddress_activity:function(e){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",d=t.shop_type,o=e.objectId,r=t.img_arr;console.log(n("loadAddress addressId:",o," at pages\\address\\add\\add.vue:617")),void 0!=o&&(t.setData({addressId:o}),wx.request({url:c+"/api/client/get_activity_address",method:"POST",data:{username:e.username?e.username:a,access_token:s,shop_type:d,address_id:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n("loadAddress:",e.data.result," at pages\\address\\add\\add.vue:637"));for(var a=e.data.result,s=[],d=0;d<a.length;d++)s[d]=a[d]["address"],"undefined"!=a["img"]&&""!=a["img"]&&(r[0]=a["img"]),"undefined"!=a["img2"]&&""!=a["img2"]&&(r[1]=a["img2"]),"undefined"!=a["img3"]&&""!=a["img3"]&&(r[2]=a["img3"]);t.setData({address:a[0],img_arr:r,areaSelectedStr:a[0]["prov_str"]+a[0]["city_str"]+a[0]["area_str"]+a[0]["town_str"]}),console.log(n(t.img_arr," at pages\\address\\add\\add.vue:653"))}}))},loadAddress_member:function(e){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",d=t.shop_type,o=e.objectId;console.log(n("loadAddress addressId:",o," at pages\\address\\add\\add.vue:665")),void 0!=o&&(t.setData({addressId:o}),wx.request({url:c+"/api/client/get_member_address",method:"POST",data:{username:e.username?e.username:a,access_token:s,shop_type:d,address_id:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n("loadAddress:",e.data.result," at pages\\address\\add\\add.vue:685"));for(var a=e.data.result,s=[],d=0;d<a.length;d++)s[d]=a[d]["address"];t.setData({address:a[0],areaSelectedStr:a[0]["prov_str"]+a[0]["city_str"]+a[0]["area_str"]+a[0]["town_str"]}),console.log(n("load member address:",t.address," at pages\\address\\add\\add.vue:697"))}}))},setDefault:function(){var e=this;console.log(n(e.provinceObjects," at pages\\address\\add\\add.vue:705"))},cascadePopup:function(){var e=wx.createAnimation({duration:500,timingFunction:"ease-in-out"});this.animation=e,e.translateY(-285).step(),this.setData({animationData:this.animation.export(),maskVisual:"show"})},cascadeDismiss:function(){this.animation.translateY(285).step(),this.setData({animationData:this.animation.export(),maskVisual:"hidden"})},provinceTapped:function(e){var t=e.currentTarget.dataset.index;console.log(n("provinceTapped"," at pages\\address\\add\\add.vue:731")),console.log(n(""," at pages\\address\\add\\add.vue:732")),this.setData({provinceName:this.province[t],regionName:"",townName:"",provinceIndex:t,cityIndex:-1,regionIndex:-1,townIndex:-1,region:[],town:[]});var a=this,s=this.provinceObjects[t]["area_id"];wx.request({url:c+"/api/client/get_area_list",method:"POST",data:{parent_id:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\address\\add\\add.vue:758"));for(var t=e.data.result,s=[],d=0;d<t.length;d++)s[d]=t[d]["area_name"];a.setData({cityName:"请选择",city:s,cityObjects:t}),a.setData({current:1})}})},cityTapped:function(e){var t=e.currentTarget.dataset.index;this.setData({cityIndex:t,regionIndex:-1,townIndex:-1,cityName:this.city[t],regionName:"",townName:"",town:[]});var a=this,s=this.cityObjects[t]["area_id"];wx.request({url:c+"/api/client/get_area_list",method:"POST",data:{parent_id:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\address\\add\\add.vue:806"));for(var t=e.data.result,s=[],d=0;d<t.length;d++)s[d]=t[d]["area_name"];a.setData({regionName:"请选择",region:s,regionObjects:t}),a.setData({current:2})}})},regionTapped:function(e){var t=e.currentTarget.dataset.index;this.setData({regionIndex:t,townIndex:-1,regionName:this.region[t],townName:""});var a=this,s=this.regionObjects[t]["area_id"];wx.request({url:c+"/api/client/get_area_list",method:"POST",data:{parent_id:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\address\\add\\add.vue:851"));var t=e.data.result;if(0==t.length){var s=a.provinceName+a.cityName+a.regionName;return a.setData({areaSelectedStr:s}),void a.cascadeDismiss()}for(var d=[],o=0;o<t.length;o++)d[o]=t[o]["area_name"];a.setData({townName:"请选择",town:d,townObjects:t}),a.setData({current:3}),console.log(n(a.townObjects," at pages\\address\\add\\add.vue:878"))}})},townTapped:function(e){var t=e.currentTarget.dataset.index;this.setData({townIndex:t,townName:this.town[t]});var a=this.provinceName+this.cityName+this.regionName+this.townName;this.setData({areaSelectedStr:a}),this.cascadeDismiss()},currentChanged:function(e){var t=e.detail.current;this.setData({current:t})},changeCurrent:function(e){var t=e.currentTarget.dataset.current;this.setData({current:t})},fetchPOI:function(){var t=this;e.getLocation({type:"gcj02",success:function(e){console.log(n("当前位置的经度："+e.longitude," at pages\\address\\add\\add.vue:916")),console.log(n("当前位置的纬度："+e.latitude," at pages\\address\\add\\add.vue:917")),t.longitude=e.longitude,t.latitude=e.latitude;var a=new plus.maps.Point(e.longitude,e.latitude);plus.maps.Map.reverseGeocode(a,{},function(e){var a=e.address;e.coord,e.coordType;console.log(n(a,"address"," at pages\\address\\add\\add.vue:928"));var s=/.+?(省|市|自治区|自治州|县|区)/g;console.log(n(a.match(s)," at pages\\address\\add\\add.vue:931")),t.addressList=a.match(s).toString().split(","),console.log(n(t.addressList[0]," at pages\\address\\add\\add.vue:933")),console.log(n(t.addressList[1]," at pages\\address\\add\\add.vue:934")),console.log(n(t.addressList[2]," at pages\\address\\add\\add.vue:935")),t.areaSelectedStr=a},function(e){console.log(n(e," at pages\\address\\add\\add.vue:940"))})},fail:function(e){console.log(n("fail:",e," at pages\\address\\add\\add.vue:945"))}})},setData:function(e){var t,a,n=this,s=[];Object.keys(e).forEach(function(d){s=d.split("."),t=e[d],a=n.$data,s.forEach(function(e,d){d+1==s.length?n.$set(a,e,t):a[e]||n.$set(a,e,{}),a=a[e]})})}}});t.default=f}).call(this,a("6e42")["default"],a("0de9")["default"])},f870:function(e,t,a){"use strict";var n=a("d0c6"),s=a.n(n);s.a}},[["59e5","common/runtime","common/vendor"]]]);