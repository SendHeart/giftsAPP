(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wish/wish"],{"0450":function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a("3936");var s=function(){return a.e("components/uni-icons/uni-icons").then(a.bind(null,"f9e2"))},i=function(){return a.e("components/uni-nav-bar/uni-nav-bar").then(a.bind(null,"daa9"))},o=getApp().globalData.weburl,r=getApp().globalData.shop_type,g=(getApp().globalData.from_page,wx.getStorageSync("username")&&wx.getStorageSync("username"),wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("openid")&&wx.getStorageSync("openid"),wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):""),l=getApp().globalData.miniprogram_id,c=[{id:"gift_logo",title:"送礼logo",value:"",img:"/uploads/gift_logo.png"},{id:"wishlist_logo",title:"心愿单logo",value:"",img:"/uploads/wishlist.png"},{id:"trans_gift_logo",title:"转送礼logo",value:"",img:"/uploads/gift_logo.png"},{id:"hall_banner",title:"首页banner",value:"",img:"/uploads/songxin_banner.png"},{id:"wish_banner",title:"心愿单banner",value:"",img:"/uploads/wish_banner.png"},{id:"wechat_gb",title:"背景",value:"",img:"/uploads/wechat_share.png"}],u=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[],h={data:function(){return{title_name:"心愿单",title_logo:"/static/images/footer-icon-05.png",this_page:"/pages/wish/wish",miniprogram_id:l,all_rows:0,venuesItems:[],search_goodsname:null,userInfo:g,dkheight:200,keyword:"",page:1,pagesize:20,page_num:0,indicatorDots:!0,vertical:!1,autoplay:!0,interval:3e3,duration:1e3,loadingHidden:!0,hidden:!0,scrollTop:0,scrollHeight:0,toView:0,showmorehidden:!0,rshowmorehidden:!0,shareflag:!0,nickname:g.nickname,avatarUrl:g.avatarUrl,wish_id:"",wish_nickname:null,wish_headimg:null,navList2:u,painting:{},shareImage:"",showSharePic:!0,shop_type:r,wish_banner:"",navList2_init:c,carts:"",minusStatuses:""}},components:{uniIcons:s,uniNavBar:i},props:{},onLoad:function(t){var a=this,s=(wx.getStorageSync("username")&&wx.getStorageSync("username"),t.wish_id?t.wish_id:""),i=t.from_page;e.getSystemInfo({success:function(e){var t=e.windowHeight;a.setData({dkheight:t-.05*t-20})}}),getApp().globalData.wish_id=s,a.setData({wish_id:s}),console.log(n("onLoad",a.wish_id," from_page:",i," at pages\\wish\\wish.vue:183")),a.get_project_gift_para()},onShow:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=getApp().globalData.wish_id,s=getCurrentPages();s.length>1&&e.setData({title_logo:"/static/images/back.png"}),e.setData({wish_id:a}),t?e.query_wish_cart():wx.navigateTo({url:"/pages/login/login?frompage=/pages/wish/wish"}),console.log(n("onShow",getApp().globalData.wish_id," at pages\\wish\\wish.vue:219"))},onShareAppMessage:function(e){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):"",i=s.nickname+"的心愿单,快打开看看吧~",o=t.navList2[1]["img"],r={title:i,desc:"我的心愿单",path:"/pages/wish/wish?wish_id="+a,imageUrl:o,success:function(e){console.log(n(e," at pages\\wish\\wish.vue:236")),e.errMsg},fail:function(e){console.log(n(e," at pages\\wish\\wish.vue:243")),"shareAppMessage:fail cancel"==e.errMsg||e.errMsg},complete:function(){}};return"button"===e.from&&(console.log(n("心愿单分享:"," at pages\\wish\\wish.vue:259")),console.log(n(r," at pages\\wish\\wish.vue:260"))),r},onPullDownRefresh:function(){wx.stopPullDownRefresh()},methods:{formSubmit:function(e){var t=this,a=e.detail.formId,s=e.currentTarget.dataset.name;console.log(n("formSubmit() formID：",a," form name:",s," at pages\\wish\\wish.vue:275")),"addWish"==s?t.addWishTapTag():"goBack"==s&&t.goBack(),a&&t.submintFromId(a)},submintFromId:function(e){var t=this,a=(e=e,t.shop_type),s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",i=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:o+"/api/client/save_member_formid",method:"POST",data:{username:s,access_token:i,formId:e,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n("submintFromId() update success: ",e.data," at pages\\wish\\wish.vue:306"))}})},shareToWXminiProgram:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):"",i=s.nickname+"的心愿单,快打开看看吧~",o=(a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",this.miniprogram_id),r=t.navList2[1]["img"];e.share({provider:"weixin",type:5,title:i,imageUrl:r,miniProgram:{id:o,path:"/pages/wish/wish?wish_id="+a,type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(n(e," at pages\\wish\\wish.vue:330"))},fail:function(t){console.log(n(t," at pages\\wish\\wish.vue:339")),e.showModal({title:"分享失败",content:"error:"+JSON.stringify(t)})}})},goBack:function(){var e=this,t=e.from_page,a=getCurrentPages();a.length>1?wx.navigateBack({changed:!0}):t?wx.navigateTo({url:t}):wx.switchTab({url:"../hall/hall"})},swiperchange:function(e){},login:function(){wx.navigateTo({url:"../login/login"})},shareTapTag:function(){var e=this,t=!1;e.setData({shareflag:t}),console.log(n("share wish:",t," at pages\\wish\\wish.vue:389"))},addWishTapTag:function(e){wx.navigateTo({url:"../list/list"})},searchTapTag:function(e){var t=this;console.log(n("搜索关键字："+t.search_goodsname," at pages\\wish\\wish.vue:399")),t.query_wish_cart()},sendGoodsTapTag:function(e){var t=this,a=wx.getStorageSync("username"),n=parseInt(e.currentTarget.dataset.index),s=t.carts[n]["id"];s?t.insertCart(s,a,0):wx.showToast({title:"该礼物无货",icon:"loading",duration:1500})},insertCart:function(e,t,a){var s=this,i=s.shop_type,r=1==a?"确认要加入心愿单吗":"确认要购买送出吗";wx.showModal({title:"提示",content:r,success:function(s){if(s.confirm){wx.request({url:o+"/api/client/add_cart",method:"POST",data:{username:t,access_token:"1",sku_id:e,wishflag:a,shop_type:i},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\wish\\wish.vue:445"));var t=1==a?"加入心愿单完成":"加入购物车完成";wx.showToast({title:t,duration:1500}),1==a?wx.navigateTo({url:"../wish/wish"}):wx.switchTab({url:"../hall/hall"})}})}}})},deleteTapTag:function(e){var t=this,a=t.shop_type,s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",i=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=parseInt(e.currentTarget.dataset.index),g=t.carts,l=t.carts[r]["id"],c=e.currentTarget.dataset.objectId;console.log(n(c," at pages\\wish\\wish.vue:477")),wx.request({url:o+"/api/client/delete_cart",method:"POST",data:{username:s,access_token:i,sku_id:l,wishflag:1,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n(e.data.result," at pages\\wish\\wish.vue:493"));for(var a=[],s=0,i=0;i<g.length;i++)i!=r&&(a[s++]=g[i]);if(0==a.length)var o=0,l=!0;else o=a.length,l=!1;t.setData({carts:a,all_rows:o,showmorehidden:l})}})},onGotUserInfo:function(e){console.log(n(e.detail.errMsg," at pages\\wish\\wish.vue:534")),console.log(n(e.detail.userInfo," at pages\\wish\\wish.vue:535")),console.log(n(e.detail.rawData," at pages\\wish\\wish.vue:536"))},get_project_gift_para:function(){var e=this,t=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[{}],a=e.shop_type;console.log(n("wish get_project_gift_para navList2:",u,u.length," at pages\\wish\\wish.vue:542")),0==u.length?wx.request({url:o+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:a,query_type:"APP"},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){console.log(n("get_project_gift_para:",a.data.result," at pages\\wish\\wish.vue:560")),t=a.data.result,t&&e.setData({navList2:t,wish_banner:t[4]["img"]})}}):e.setData({navList2:t,wish_banner:t[4]["img"]}),setTimeout(function(){e.setData({loadingHidden:!0})},1500)},scroll:function(e){var t=this;t.setData({scrollTop:e.detail.scrollTop})},query_wish_cart:function(){var e=this,t=e.shop_type,a=[],s=e.page,i=e.pagesize,r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",g=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",l=getApp().globalData.wish_id;console.log(n("query_wish_cart:",l," at pages\\wish\\wish.vue:609")),wx.request({url:o+"/api/client/query_cart",method:"POST",data:{username:l||r,access_token:g,page:s,pagesize:i,wishflag:1,shop_type:t},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(s){var i=[];if(console.log(n("share wish id:",l," result:",s.data," at pages\\wish\\wish.vue:627")),s.data.result){var r=s.data.result.list,c=e.showmorehidden,u=0;for(var h in r)for(var p=0;p<r[h]["sku_list"].length;p++)r[h]["sku_list"][p]["image"].indexOf("http")<0&&(r[h]["sku_list"][p]["image"]=o+"/"+r[h]["sku_list"][p]["image"]),r[h]["sku_list"][p]["short_name"]=r[h]["sku_list"][p]["name"].substr(0,10)+"...",r[h]["sku_list"][p]["selected"]="",r[h]["sku_list"][p]["shop_id"]=h,r[h]["sku_list"][p]["objectId"]=r[h]["sku_list"][p]["id"],u>1&&(r[h]["sku_list"][p]["hidden"]=1),i[u]=r[h]["sku_list"][p],a[u]=r[h]["sku_list"][p]["num"]<=1?"disabled":"normal",u++;var w=e.page_num,d=e.pagesize;w=i.length/d+.5,e.setData({carts:i,minusStatuses:a,showmorehidden:c,all_rows:i.length,page_num:w.toFixed(0)}),l?wx.request({url:o+"/api/client/get_name",method:"POST",data:{username:l,shop_type:t,access_token:g},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){var a=t.data.result;e.setData({wish_nickname:a["wx_nickname"],wish_headimg:a["wx_headimg"],wish_id:""}),getApp().globalData.wish_id="",e.shareTapTag()}}):e.setData({shareflag:!0})}}})},ShareWechat:function(){wx.navigateTo({url:"../wish/wishshare/wishshare"})},setData:function(e){var t,a,n=this,s=[];Object.keys(e).forEach(function(i){s=i.split("."),t=e[i],a=n.$data,s.forEach(function(e,i){i+1==s.length?n.$set(a,e,t):a[e]||n.$set(a,e,{}),a=a[e]})})}}};t.default=h}).call(this,a("6e42")["default"],a("0de9")["default"])},"445d":function(e,t,a){"use strict";var n=a("842f"),s=a.n(n);s.a},"6bfe":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");n(a("66fd"));var t=n(a("9569"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},"842f":function(e,t,a){},"84da":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},s=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s})},9323:function(e,t,a){"use strict";a.r(t);var n=a("0450"),s=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);t["default"]=s.a},9569:function(e,t,a){"use strict";a.r(t);var n=a("84da"),s=a("9323");for(var i in s)"default"!==i&&function(e){a.d(t,e,function(){return s[e]})}(i);a("445d");var o=a("2877"),r=Object(o["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports}},[["6bfe","common/runtime","common/vendor"]]]);