(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wish/wishshare/wishshare"],{"037f":function(e,t,a){"use strict";var i=a("1429"),r=a.n(i);r.a},1429:function(e,t,a){},"5dec":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");i(a("66fd"));var t=i(a("8130"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},"65a0":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){t.stopPropagation(),5!=e.share_order_shape&&e.share_order_shape})},r=[];a.d(t,"a",function(){return i}),a.d(t,"b",function(){return r})},8130:function(e,t,a){"use strict";a.r(t);var i=a("65a0"),r=a("d98d");for(var s in r)"default"!==s&&function(e){a.d(t,e,function(){return r[e]})}(s);a("037f");var o=a("2877"),n=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,null,null);t["default"]=n.exports},badd:function(e,t,a){"use strict";(function(e,i){function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},i=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),i.forEach(function(t){s(e,t,a[t])})}return e}function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a("3936"),n=function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"dcc0"))},h=getApp().globalData.weburl,d=getApp().globalData.shop_type,_=getApp().globalData.miniprogram_id,c=e.getStorageSync("username")?e.getStorageSync("username"):"",g=(e.getStorageSync("token")&&e.getStorageSync("token"),e.getStorageSync("openid")&&e.getStorageSync("openid"),e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):""),l=getApp().globalData.appid,p=getApp().globalData.secret,w=getApp().globalData.uploadurl,u=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[],m=e.getStorageSync("userauth")?e.getStorageSync("userauth"):{},f=wx.getRecorderManager(),v=wx.createInnerAudioContext(),y={duration:18e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50},x={data:function(){return{postersData:{},posterImg:{},title_name:"分享",title_logo:"/static/images/footer-icon-05.png",share_goods_bg:h+"/uploads/share_goods_bg.png",activity_share_image:h+"/uploads/activity_share.jpg",activity_avatarUrl:h+"/uploads/avatar.png",share_goods_avatarUrl:g.avatarUrl?g.avatarUrl:"/static/images/my.png",nickname:g.nickname,avatarUrl:g.avatarUrl,miniprogram_id:_,painting:{},paintingData:{views:[]},imageList:[],tempFileList:[],isPainting:!1,ctx:null,cache:{},shareImage:"",shop_type:d,wechat_share:"",start_time:o.getDateStr(new Date,0),overtime_status:0,notehidden:!0,hidden_share:!0,width:100,height:100,windowHeight:900,windowWidth:500,background:"#f2f2f2",recordingTimeqwe:"",navList2:"",shutRecordingdis:"",openRecordingdis:"",new_rec_url:"",order_voice:"",voice_url:"",card_register_info:"",card_name_info:"",card_love_info:"",card_cele_info:"",card_template:"",card_color:"",card_type:"",dkheight:"",m_id:"",task:"",task_image:"",msg_id:"",activity_id:"",activity_image:"",activity_name:"",activity_headimg:"",share_art_id:"",share_art_cat_id:"",share_art_title:"",share_art_image:"",share_art_wx_headimg:"",share_goods_id:"",share_goods_price:"",share_goods_name:"",share_goods_org:"",share_goods_shape:"",share_goods_image:"",share_goods_image2:"",share_goods_wx_headimg:"",share_goods_title:"",share_goods_desc:"",share_goods_qrcode_cache:"",share_order_shape:"",share_order_id:"",share_order_note:"",share_order_bg:"",share_order_image:"",share_order_wx_headimg:"",loadingHidden:!1,send_status:0,isSaveImageToPhotosAlbum:!1,userauth:m,userauth_shoper:0}},components:{uniPopup:n},props:{},onLoad:function(t){var a=this;console.log(i("options:",t," at pages\\wish\\wishshare\\wishshare.vue:236"));var r=t.is_back?t.is_back:0;1==r&&(t=wx.getStorageSync("wishshare_options"));var s=t.share_order_id?t.share_order_id:0,o=t.share_order_shape?t.share_order_shape:1,n=t.card_type?t.card_type:0,_=e.getStorageSync("userauth")?e.getStorageSync("userauth"):"",c=e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"";if(a.userauth_shoper=_.shoper,a.avatarUrl=c.avatarUrl,a.share_goods_avatarUrl=c.avatarUrl?c.avatarUrl:"/static/images/my.png",wx.setStorageSync("wishshare_options",t),a.get_project_gift_para(),console.log(i(" wishshare onload() 订单 share_order_id:",s," share_order_shape:",o," options:",t," at pages\\wish\\wishshare\\wishshare.vue:249")),s>0&&(5==parseInt(o)||4==parseInt(o))){var g=wx.getStorageSync("username")?wx.getStorageSync("username"):"",l=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",p=wx.getStorageSync("openid")?wx.getStorageSync("openid"):"";wx.request({url:h+"/api/client/query_order",method:"POST",data:{username:g||p,access_token:l,order_id:s,shop_type:d},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){var t=e.data.result;console.log(i(" wishshare onload() 订单查询:",t," at pages\\wish\\wishshare\\wishshare.vue:269"));for(var r=0;r<t.length;r++){t[r]["logo"].indexOf("http")<0&&(t[r]["logo"]=h+"/"+t[r]["logo"]),t[r]["logo"]=t[r]["logo"].replace("http:","https:");for(var s=0;s<t[r]["order_sku"].length;s++)t[r]["order_sku"][s]["sku_image"].indexOf("http")<0&&(t[r]["order_sku"][s]["sku_image"]=h+t[r]["order_sku"][s]["sku_image"]),t[r]["order_sku"][s]["sku_image"]=t[r]["order_sku"][s]["sku_image"].replace("http:","https:")}if((5==t[0]["shape"]||4==t[0]["shape"])&&t[0]["m_desc"]){var o=JSON.parse(t[0]["m_desc"]),d=o["voice"];d&&wx.downloadFile({url:d,success:function(e){200===e.statusCode&&(console.log(i("录音文件下载完成",e.tempFilePath," at pages\\wish\\wishshare\\wishshare.vue:298")),a.setData({order_voice:e.tempFilePath,voice_url:d}))}}),a.setData({card_register_info:o["card_register_info"]?o["card_register_info"]:"",card_name_info:o["card_name_info"]?o["card_name_info"]:"",card_love_info:o["card_love_info"]?o["card_love_info"]:"",card_cele_info:o["card_cele_info"]?o["card_cele_info"]:"",card_template:o["card_template"]?o["card_template"]:"",card_color:o["color"]?o["color"]:"#333",card_type:o["card_template"]?o["card_template"][0]["type"]:n}),wx.setNavigationBarTitle({title:"互动分享"})}console.log(i("card card_template:",a.card_template," card_love_info:",a.card_love_info," at pages\\wish\\wishshare\\wishshare.vue:323"))}})}wx.getSystemInfo({success:function(e){console.log(i("wishshare getSystemInfo:",e," at pages\\wish\\wishshare\\wishshare.vue:330")),a.setData({windowHeight:e.windowHeight?e.windowHeight:a.windowHeight,windowWidth:e.windowWidth?e.windowWidth:a.windowWidth,dkheight:e.windowHeight-10})}}),setTimeout(function(){a.reloadData()},1e3)},onShow:function(){},onShareAppMessage:function(e){var t=this,a=t.m_id,r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=(wx.getStorageSync("token")&&wx.getStorageSync("token"),t.nickname),o=t.msg_id,n=t.task,h=t.start_time,d=t.activity_id?t.activity_id:0,_=t.activity_image?t.activity_image:t.activity_share_image,c=t.activity_name?t.activity_name:"我的位置",g="收到"+s+"的送礼分享~",l=t.task_image?t.task_image:t.wechat_share,p="送心礼物分享",w=t.share_goods_id?t.share_goods_id:0,u=t.share_goods_image2?t.share_goods_image2:"",m=(t.share_goods_wx_headimg?t.share_goods_wx_headimg:t.share_goods_avatarUrl,t.share_goods_shape?t.share_goods_shape:"1"),f=(t.share_goods_org&&t.share_goods_org,"");f=5==m?"平安是福":4==m?"一起来吧":"这个礼物真不错，来看看吧，要是你能送我就更好了~";var v=t.share_goods_title?t.share_goods_title:f,y=t.share_goods_desc?t.share_goods_desc:"送礼就是送心~",x=t.share_art_id,S=t.share_art_cat_id,b=t.share_art_image,I=t.share_art_title,k=t.share_order_id,T=(t.share_order_image,t.share_order_shape),P=t.share_order_note;console.log(i("开始分享送礼任务",e," at pages\\wish\\wishshare\\wishshare.vue:388"));var W={title:g,desc:p,path:"/pages/hall/hall?task="+n+"&msg_id="+o+"&refername="+r+"&sharetime="+h,imageUrl:d>0?_:l,success:function(e){console.log(i(e," at pages\\wish\\wishshare\\wishshare.vue:398")),"shareAppMessage:ok"==e.errMsg&&t.setData({send_status:1})},fail:function(e){console.log(i(e," at pages\\wish\\wishshare\\wishshare.vue:408")),"shareAppMessage:fail cancel"==e.errMsg||e.errMsg},complete:function(){}};return"button"===e.from&&(d>0&&(W["desc"]="我的位置",W["title"]=s+":"+v?v:c+"~",W["imageUrl"]=_,W["path"]="/pages/member/mylocation/mylocation?username="+r+"&activity_id="+d),w>0&&(W["desc"]=y,W["title"]=v,W["imageUrl"]=u,W["path"]="/pages/details/details?id="+w+"&image="+u+"&mid="+a),x>0&&(W["title"]=I,W["imageUrl"]=b,W["path"]="/pages/my/index?art_id="+x+"&art_cat_id="+S+"&mid="+a),4==T&&(t.card_register_info?W["title"]=t.card_register_info["card_register_title"]?t.card_register_info["card_register_title"]:"":t.card_name_info?W["title"]=t.card_name_info["card_name_name"]?t.card_name_info["card_name_name"]+"的名片":"":t.card_cele_info?W["title"]=t.card_cele_info["card_cele_title"]?t.card_cele_info["card_cele_title"]+"的祝福":"祝福":t.card_love_info&&(W["title"]=t.card_love_info["card_love_title"]?t.card_love_info["card_love_title"]+"的爱心":"爱心"),W["imageUrl"]=t.shareImage,W["path"]="/pages/order/receive/receive?receive=1&order_id="+k+"&order_shape="+T+"&mid="+a),5==T&&(W["title"]=P,W["imageUrl"]=t.shareImage,W["path"]="/pages/order/receive/receive?receive=1&order_id="+k+"&order_shape="+T+"&mid="+a),console.log(i("送心分享",W," at pages\\wish\\wishshare\\wishshare.vue:462"))),W},onReady:function(){e.removeStorageSync("CACHE_KEYS");var t=this;this.cache=e.getStorageSync("CACHE_KEYS")||{},this.ctx=e.createCanvasContext("canvasdrawer",t),this.ctx.setFillStyle("white")},methods:{shareAction:function(){var t=this;this.isSaveImageToPhotosAlbum||this.eventSave();var a=["微信朋友圈","微信小程序","APP推送"];e.showActionSheet({itemList:a,success:function(e){switch(console.log(i(e.tapIndex," at pages\\wish\\wishshare\\wishshare.vue:486")),e.tapIndex){case 0:t.shareToWXSenceTimeline();break;case 1:t.shareToWXminiProgram();break;case 2:t.shareToAppPush();break;default:break}}})},shareToWXSenceTimeline:function(){var t=this.shareImage;t&&e.share({provider:"weixin",type:2,scene:"WXSenceTimeline",imageUrl:t,success:function(e){console.log(i(e," at pages\\wish\\wishshare\\wishshare.vue:519"))},fail:function(t){console.log(i(t," at pages\\wish\\wishshare\\wishshare.vue:528"));var a=t.errMsg;"客户端未安装"==a.share.fail?e.showModal({title:"分享失败",content:"微信客户端未安装"}):e.showModal({title:"分享失败",content:a.share.fail})}})},shareToWXminiProgram:function(){var t=this.share_goods_name?this.share_goods_name:"送心礼物分享",a=this.share_goods_image?this.share_goods_image:"",r=this.share_goods_id?this.share_goods_id:0,s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=this.miniprogram_id,n=this.shareImage;a=a||n,"iOS"===plus.os.name?e.share({provider:"weixin",type:5,scene:"WXSceneSession",title:t,imageUrl:"https://sendheart.dreamer-inc.com/uploads/gift_logo4.png",miniProgram:{id:o,path:"pages/details/details?id="+r+"&refername="+s,type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(i(e," at pages\\wish\\wishshare\\wishshare.vue:576"))},fail:function(t){console.log(i(t," at pages\\wish\\wishshare\\wishshare.vue:585")),e.showModal({title:"分享失败",content:"error:"+JSON.stringify(t)})}}):e.share({provider:"weixin",type:5,scene:"WXSceneSession",title:t,imageUrl:a+"?x-oss-process=image/resize,w_200",miniProgram:{id:o,path:"pages/details/details?id="+r+"&refername="+s,type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(i(e," at pages\\wish\\wishshare\\wishshare.vue:606"))},fail:function(t){console.log(i(t," at pages\\wish\\wishshare\\wishshare.vue:615")),e.showModal({title:"分享失败",content:"error:"+JSON.stringify(t)})}})},shareToAppPush:function(){var t=this.share_goods_name?this.share_goods_name:"送心礼物分享",a=(this.share_goods_price&&this.share_goods_price,this.share_goods_id?this.share_goods_id:0),r=(this.share_goods_org&&this.share_goods_org,this.share_goods_shape&&this.share_goods_shape,this.share_goods_image&&this.share_goods_image,e.getStorageSync("username")?e.getStorageSync("username"):""),s=e.getStorageSync("token")?e.getStorageSync("token"):"1",o=this.share_goods_title,n="/pages/details/details?id="+a;e.request({url:h+"/api/app_client/app_push",method:"POST",data:{username:r,access_token:s,title:t,cid:"",content:o,payload:n,shop_type:d},header:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8",Accept:"application/json"},success:function(t){console.log(i("shareToAppPush() : ",t.data," at pages\\wish\\wishshare\\wishshare.vue:665")),"y"==t.data.status?e.showToast({title:"APP推送完成"+o,icon:"none",duration:1e3}):e.showToast({title:t.data.info?t.data.info:"APP推送失败",icon:"success",duration:1e3})}})},recordingTimer:function(){var e=this;e.setInter=setInterval(function(){var t=e.recordingTimeqwe+1;e.setData({recordingTimeqwe:t})},1e3)},formSubmit:function(e){var t=this,a=e.detail.formId,r=e.currentTarget.dataset.name;console.log(i("formSubmit() formID：",a," form name:",r," at pages\\wish\\wishshare\\wishshare.vue:698")),"eventSave"==r?t.eventSave():"onShare"==r&&t.shareAction(),a&&t.submintFromId(a)},submintFromId:function(e){var t=this,a=(e=e,t.shop_type),r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:h+"/api/client/save_member_formid",method:"POST",data:{username:r,access_token:s,formId:e,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(i("submintFromId() update success: ",e.data," at pages\\wish\\wishshare\\wishshare.vue:729"))}})},goBack:function(){var e=this,t=getCurrentPages();t.length>1&&5!=e.share_order_shape&&4!=e.share_order_shape?wx.navigateBack({changed:!0}):5==e.share_order_shape||4==e.share_order_shape?wx.switchTab({url:"../../index/index"}):wx.switchTab({url:"../../hall/hall"})},get_project_gift_para:function(){var e=this,t=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[{}],a=e.shop_type;console.log(i("wishshare get_project_gift_para navList2:",u," at pages\\wish\\wishshare\\wishshare.vue:755")),0==u.length?wx.request({url:h+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(i("get_project_gift_para:",t.data.result," at pages\\wish\\wishshare\\wishshare.vue:772"));var a=t.data.result;a&&e.setData({navList2:a,wechat_share:a[5]["img"]})}}):e.setData({navList2:t,wechat_share:t[5]["img"]})},startRecode:function(){var e=this;wx.getSetting({success:function(e){var t=e.authSetting,a=Object.keys(t).length;console.log(i("authMap info 长度:"+a,t," at pages\\wish\\wishshare\\wishshare.vue:805")),t.hasOwnProperty("scope.record")&&(e.authSetting["scope.record"]||wx.showModal({title:"用户未授权",content:"请授权录音权限",showCancel:!1,success:function(e){e.confirm&&(console.log(i("用户点击确定授权录音权限"," at pages\\wish\\wishshare\\wishshare.vue:815")),wx.openSetting({success:function(e){console.log(i("openSetting success",e.authSetting," at pages\\wish\\wishshare\\wishshare.vue:818"))}}))}}))}}),e.setData({shutRecordingdis:"block",openRecordingdis:"none"}),wx.showLoading({title:"录音中"}),e.recordingTimer(),f.start(y),f.onStart(function(){console.log(i("开始录音"," at pages\\wish\\wishshare\\wishshare.vue:841"))}),f.onError(function(e){console.log(i("错误回调:",e," at pages\\wish\\wishshare\\wishshare.vue:845"))})},endRecode:function(){var e=this;e.share_goods_id;f.stop(),f.onStop(function(t){console.log(i("停止录音",t.tempFilePath," at pages\\wish\\wishshare\\wishshare.vue:854")),e.setData({shutRecordingdis:"none",openRecordingdis:"block"}),e.current_voice=t.tempFilePath,wx.hideLoading(),clearInterval(e.setInter),v.src=t.tempFilePath,v.autoplay=!0,e.save_recorder(t.tempFilePath)})},save_recorder:function(e){var t=this,a=t.share_goods_id;wx.uploadFile({url:w,filePath:e,name:"wechat_upimg",formData:{latitude:encodeURI(0),longitude:encodeURI(0),restaurant_id:encodeURI(0),city:encodeURI("杭州"),prov:encodeURI("浙江"),name:encodeURI(a)},success:function(a){var r=JSON.parse(a.data.trim()),s="";"y"==r["status"]?(s=r["result"]["img_url"],t.setData({new_rec_url:s}),console.log(i("录音上传完成",e,s," at pages\\wish\\wishshare\\wishshare.vue:903")),t.update_order_note()):(wx.showToast({title:"录音上传返回失败",icon:"none",duration:1e3}),console.log(i("录音上传返回失败",e,s," at pages\\wish\\wishshare\\wishshare.vue:911")))}})},play_rec:function(){var e=this,t=(e.share_goods_id,e.order_voice),a=e.voice_url;e.current_voice?(v.src=e.current_voice,v.play()):t?(v.src=t,v.play()):a?wx.downloadFile({url:new_rec_url,success:function(e){200===e.statusCode&&(v.src=e.tempFilePath,v.play(),console.log(i("录音播放完成",e.tempFilePath," at pages\\wish\\wishshare\\wishshare.vue:936")))}}):wx.showToast({title:"暂无录音",icon:"none",duration:1e3})},update_order_note:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=e.share_order_id,s=e.share_order_note,o=e.share_order_shape,n=e.new_rec_url?e.new_rec_url:e.voice_url,_=e.recordingTimeqwe?e.recordingTimeqwe:e.cardvoicetime;wx.request({url:h+"/api/client/update_order_note",method:"POST",data:{username:t,access_token:a,shop_type:d,order_id:r,rcv_note:s,order_shape:o,order_voice:n,order_voicetime:_},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(i("wishshare 修改订单信息完成:",e.data.result," at pages\\wish\\wishshare\\wishshare.vue:975"));e.data.result;"n"==e.data.status&&wx.showToast({title:e.data.info,icon:"none",duration:2e3})}})},reloadData:function(){var t=this,a=wx.getStorageSync("wishshare_options"),r=wx.getStorageSync("m_id")?wx.getStorageSync("m_id"):0,s=a.task?a.task:0,o=a.image?a.image:"",n=a.msg_id?a.msg_id:"",_=a.activity_id?a.activity_id:0,g=a.activity_name?a.activity_name:0,w=a.activity_image?a.activity_image:"",u=a.activity_headimg?a.activity_headimg:t.activity_avatarUrl,m=a.share_activity_title?a.share_activity_title:"这个地方真不错~",f=a.share_goods_id?a.share_goods_id:0,v=a.share_goods_name?a.share_goods_name:"",y=a.share_goods_org?a.share_goods_org:"1",x=e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"",S=a.share_goods_shape?a.share_goods_shape:"1",b=a.qr_type?a.qr_type:"wishshare",I=a.share_goods_price?a.share_goods_price:0,k=a.share_goods_image?a.share_goods_image:"",T=a.share_goods_image2?a.share_goods_image2:"",P=h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+d+"&qr_type="+b+"&share_goods_id="+f+"&m_id="+r,W=a.share_goods_wx_headimg?a.share_goods_wx_headimg:t.share_goods_avatarUrl,D="";t.image_save(W,"share_goods_wx_headimg"),t.image_save(k,"share_goods_image"),D=5==S?"平安是福":4==S?"一起来吧":"这个礼物真不错，来看看吧，要是你能送我就更好了~";var A=a.share_goods_title?a.share_goods_title:D,L=a.share_goods_desc?a.share_goods_desc:"送礼就是送心~",H=a.share_art_id?a.share_art_id:0,F=a.share_art_cat_id?a.share_art_cat_id:0,M=a.share_art_title?a.share_art_title:"",R=a.share_art_image?a.share_art_image:"",U=a.share_art_wx_headimg?a.share_art_wx_headimg:"",z=a.share_order_id?a.share_order_id:0,q=a.share_order_note?a.share_order_note:"",O=a.share_order_shape?a.share_order_shape:"1",C=a.share_order_bg?a.share_order_bg:"",j=a.share_order_image?a.share_order_image:"",N=a.share_order_wx_headimg?a.share_order_wx_headimg:t.avatarUrl;if(console.log(i("wishshare reloadData options:",a,"share_order_wx_headimg:",N," avatarUrl:",t.avatarUrl,"share_goods_id:",f,""," at pages\\wish\\wishshare\\wishshare.vue:1035")),N&&N.indexOf("https://wx.qlogo.cn")>=0&&(N=N.replace("https://wx.qlogo.cn",h+"/qlogo")),t.setData({m_id:r,task:s,task_image:o,msg_id:n,activity_id:_,activity_image:w,activity_name:g,activity_headimg:u,share_art_id:H,share_art_cat_id:F,share_art_title:M,share_art_image:R,share_art_wx_headimg:U,share_goods_id:f,share_goods_price:I,share_goods_name:v,share_goods_org:y,share_goods_shape:S,share_goods_image:k,share_goods_image2:T,share_goods_wx_headimg:W,share_goods_title:_>0?m:A,share_goods_desc:L,share_goods_qrcode_cache:P,share_order_shape:O,share_order_id:z,share_order_note:q,share_order_bg:C,share_order_image:j,share_order_wx_headimg:N,nickname:x.nickname}),g){var E=g.length;E>13?wx.setNavigationBarTitle({title:g.substring(0,10)+"..."}):wx.setNavigationBarTitle({title:g})}setTimeout(function(){t.share_image_creat()},300)},bindTextAreaBlur:function(e){var t=this,a=t.share_order_shape;5==a||4==a?t.share_order_note=e.detail.value:t.share_goods_title=e.detail.value},sharegoods:function(){var e=this,t=e.share_order_shape+0;4!=t&&e.setData({notehidden:!e.notehidden})},share_image_creat:function(){var e=this,t=e.share_order_shape+0,a=e.activity_id+0,r=e.share_goods_id+0;wx.showToast({title:5==t||4==t?"加载中":"开始生成海报",icon:"loading",duration:1500}),console.log(i("share_image_creat share_goods_id:",r," share_order_shape:",t," at pages\\wish\\wishshare\\wishshare.vue:1127")),r>0||a>0||t>0?(e.eventDraw(),e.setData({loadingHidden:!1})):setTimeout(function(){e.setData({loadingHidden:!0}),e.share_image_creat()},1200)},shareConfirm:function(){var e=this;e.setData({notehidden:!e.notehidden,hidden_share:!e.hidden_share}),e.share_image_creat(),e.get_project_gift_para()},shareCandel:function(){var e=this;e.setData({notehidden:!e.notehidden})},image_save:function(t,a){console.log(i("imge save image url:",t,"image_cache_name:",a," at pages\\wish\\wishshare\\wishshare.vue:1162")),e.downloadFile({url:t,success:function(e){console.log(i("downloadFile success, res is",e," at pages\\wish\\wishshare\\wishshare.vue:1166"));var t=e.tempFilePath;return t},fail:function(e){console.log(i("downloadFile fail, err is:",e," at pages\\wish\\wishshare\\wishshare.vue:1183"))}})},eventDraw:function(){var t=this,a=t.m_id,r=t.wechat_share?t.wechat_share:t.task_image,s=t.shop_type,o="wishshare",n=t.task,d=t.msg_id,_=t.activity_id?t.activity_id:0,g=t.activity_image?t.activity_image:t.activity_share_image,w=t.activity_name,u=(t.share_activity_title,t.share_goods_id?t.share_goods_id:0),m=t.share_goods_bg,f=t.share_goods_name?t.share_goods_name:"",v=t.share_goods_price?t.share_goods_price:0,y=t.share_goods_image?t.share_goods_image:"",x=t.share_goods_qrcode_cache?t.share_goods_qrcode_cache:h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+s+"&qr_type="+o+"&share_goods_id="+u+"&m_id="+a,S="undefined"!=t.share_goods_wx_headimg&&t.share_goods_wx_headimg?t.share_goods_wx_headimg:t.share_goods_avatarUrl,b=t.share_goods_title,I=(t.share_goods_desc,t.nickname?t.nickname:"朋友"),k=t.share_art_id?t.share_art_id:0,T=t.share_art_cat_id?t.share_art_cat_id:0,P=t.share_art_title?t.share_art_title:"",W=t.share_art_image?t.share_art_image:"",D=t.share_art_wx_headimg?t.share_art_wx_headimg:t.avatarUrl,A=h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+s+"&qr_type="+o+"&share_art_id="+k+"&share_art_cat_id="+T+"&m_id="+a,L=t.share_order_id?t.share_order_id:0,H=t.share_order_note?t.share_order_note:b,F=t.share_order_shape,M=t.share_order_bg,R=t.card_register_info,U=t.card_name_info,z=t.card_love_info,q=t.card_cele_info,O=t.card_template,C=t.card_type?t.card_type:0,j=(t.share_order_wx_headimg,h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+s+"&qr_type="+o+"&share_order_id="+L+"&share_order_shape="+F+"&m_id="+a);if(console.log(i("wishshare eventDraw share_order_shape:",F," card_name_info:",U," share_goods_id:",u," at pages\\wish\\wishshare\\wishshare.vue:1238")),_>0)console.log(i("activity_id:",_," at pages\\wish\\wishshare\\wishshare.vue:1241")),t.setData({painting:{width:500,height:700,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:[{type:"image",url:t.activity_headimg,top:8,left:10,width:50,height:50,radius:25},{type:"text",content:I+"在"+w,fontSize:16,color:"#999",textAlign:"left",top:20,left:70,bolder:!0},{type:"image",url:g,top:70,left:0,width:700,height:400},{type:"text",content:"长按识别二维码查看具体位置",fontSize:18,color:"#333",textAlign:"left",top:480,left:125},{type:"image",url:h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+s+"&qr_type="+o+"&activity_id="+_,top:520,left:180,width:125,height:125}]}});else if(u)console.log(i("share_goods_id:",u," at pages\\wish\\wishshare\\wishshare.vue:1297")),t.setData({painting:{width:360,height:600,clear:!0,background:"#fff",views:[{type:"image",url:m,top:10,left:0,width:360,height:600},{type:"image",url:S,top:30,left:20,width:32,height:32,radius:16},{type:"text",content:"来自"+I+"的分享",fontSize:18,color:"#333",textAlign:"left",top:40,left:60,bolder:!1},{type:"image",url:y,top:80,left:60,width:240,height:v>0?234:240},{type:"text",content:f,fontSize:14,color:"#333",textAlign:"left",top:v>0?320:350,left:56,bolder:!0,lineHeight:25,MaxLineNumber:2,breakWord:!0,width:240},{type:"text",content:v>0?"￥"+v:"",fontSize:16,color:"#444444",textAlign:"left",top:v>0?370:400,left:56,lineHeight:25},{type:"text",content:"Ta说:",fontSize:16,color:"#444",textAlign:"left",top:400,left:56,lineHeight:20,MaxLineNumber:2,breakWord:!0,bolder:!0},{type:"text",content:H,fontSize:13,color:"#666",textAlign:"left",top:430,left:56,lineHeight:25,MaxLineNumber:2,breakWord:!0,width:254},{type:"rect",top:480,left:56,background:"#eeeeee",width:280,height:1},{type:"text",content:"长按识别二维码查看详情",fontSize:16,color:"#333",textAlign:"left",top:490,left:56,breakWord:!1,bolder:!0},{type:"text",content:"送心礼物，开启礼物社交时代!",fontSize:13,color:"#999",textAlign:"left",top:520,left:56,breakWord:!1},{type:"image",url:x,top:485,left:260,width:60,height:60}]}});else if(4==F&&R&&0==u){console.log(i("share_order_shape:",F," at pages\\wish\\wishshare\\wishshare.vue:1426"));for(var N=370,E=500,X=[{type:"image",url:M,top:5,left:5,width:N,height:E}],J=0;J<O.length;J++){var B={};B["top"]=O[J]["y"]*E,B["left"]=O[J]["x"]*N,B["width"]=O[J]["width"]*N,B["height"]=O[J]["height"]*E,B["lineHeight"]=O[J]["height"]*E,1==O[J]["viewType"]?("card_register_adv"==O[J]["typeId"]&&(B["type"]="image",B["url"]=R["card_register_adv"]?R["card_register_adv"]:"",B["roundedRect"]=10),"card_register_logo"==O[J]["typeId"]&&R["has_shlogo"]&&(B["type"]="image",B["url"]=j||"",B["width"]=70,B["height"]=70,B["radius"]=35)):(B["type"]="text",B["fontSize"]=O[J]["styleSheet"]["fontSize"],B["fontSize"]=parseInt(B["fontSize"])+1,B["color"]=O[J]["color"]?O[J]["color"]:"#333",B["textAlign"]="left",B["breakWord"]=!1,"card_register_title"==O[J]["typeId"]?(B["content"]=R["card_register_title"]?R["card_register_title"].trim():"",B["left"]=B["left"]):"card_register_content"==O[J]["typeId"]?(B["MaxLineNumber"]=6,B["breakWord"]=!0,B["lineHeight"]=32,B["content"]=R["card_register_content"]?R["card_register_content"]:""):"card_register_ownername"==O[J]["typeId"]?B["content"]=R["card_register_ownername"]?"发起人:"+R["card_register_ownername"]:"":"card_register_ownerwechat"==O[J]["typeId"]?B["content"]=R["card_register_ownerwechat"]?"微信:"+R["card_register_ownerwechat"]:"":"card_register_addr"==O[J]["typeId"]?(B["MaxLineNumber"]=2,B["breakWord"]=!0,B["lineHeight"]=25,B["content"]=R["card_register_addr"]?"地址:"+R["card_register_addr"]:""):"card_register_lim"==O[J]["typeId"]?B["content"]=R["card_register_lim"]>0?"人数:"+R["card_register_lim"]:"人数:不限制":"card_register_fee"==O[J]["typeId"]?B["content"]=R["card_register_fee"]>0?"费用:￥"+R["card_register_fee"]:"费用:免费":"register_start_date"==O[J]["typeId"]&&R["has_registerdue"]?B["content"]=R["register_start_date"]?"注册："+R["register_start_date"]+" ":"":"register_start_time"==O[J]["typeId"]&&R["has_registerdue"]?B["content"]=R["register_start_time"]?R["register_start_time"]:"":"register_end_date"==O[J]["typeId"]&&R["has_registerdue"]?B["content"]=R["register_end_date"]?R["register_end_date"]:"":"register_end_time"==O[J]["typeId"]&&R["has_registerdue"]?B["content"]=R["register_end_time"]?R["register_end_time"]:"":"action_start_date"==O[J]["typeId"]&&R["has_actiondue"]?B["content"]=R["action_start_date"]?"活动："+R["action_start_date"]+" ":"":"action_start_time"==O[J]["typeId"]&&R["has_actiondue"]?B["content"]=R["action_start_time"]?R["action_start_time"]:"":"action_end_date"==O[J]["typeId"]&&R["has_actiondue"]?B["content"]=R["action_end_date"]?R["action_end_date"]:"":"action_end_time"==O[J]["typeId"]&&R["has_actiondue"]&&(B["content"]=R["action_end_time"]?R["action_end_time"]:"")),X=X.concat(B)}t.setData({painting:{width:N,height:E,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:X}})}else if(4==F&&U&&0==u){for(N=370,E=200,X=[{type:"image",url:M,top:5,left:5,width:N-10,height:E-10}],J=0;J<O.length;J++){B={};B["top"]=O[J]["y"]*E,B["left"]=O[J]["x"]*N,B["width"]=O[J]["width"]*N,B["height"]=O[J]["height"]*E,B["lineHeight"]=O[J]["height"]*E,1==O[J]["viewType"]?("card_logo"==O[J]["typeId"]&&U["card_name_logo_image"]&&(B["type"]="image",B["url"]=U["card_name_logo_image"]?U["card_name_logo_image"]:"",B["width"]=60,B["height"]=60),"card_qrcode"==O[J]["typeId"]&&U["has_shlogo"]&&(B["type"]="image",B["url"]=j||"",B["width"]=40,B["height"]=40,B["radius"]=20)):(B["type"]="text",B["fontSize"]=O[J]["styleSheet"]["fontSize"],B["fontSize"]=parseInt(B["fontSize"])+0,B["color"]=O[J]["color"]?O[J]["color"]:"#333",B["textAlign"]="left",B["breakWord"]=!1,"card_name"==O[J]["typeId"]?(B["content"]=U["card_name_name"]?U["card_name_name"].trim():"",B["left"]=B["left"]):"card_title"==O[J]["typeId"]?B["content"]=U["card_name_title"]?U["card_name_title"]:"":"card_phone"==O[J]["typeId"]?B["content"]=U["card_name_phone"]?U["card_name_phone"]:"":"card_tel"==O[J]["typeId"]?B["content"]=U["card_name_tel"]?U["card_name_tel"]:"":"card_email"==O[J]["typeId"]?B["content"]=U["card_name_email"]?U["card_name_email"]:"":"card_weburl"==O[J]["typeId"]?B["content"]=U["card_name_website"]?U["card_name_website"]:"":"card_publicwechat"==O[J]["typeId"]?B["content"]=U["card_name_publicwechat"]?U["card_name_publicwechat"]:"":"card_companyname"==O[J]["typeId"]?B["content"]=U["card_name_company"]?U["card_name_company"]:"":"card_addr"==O[J]["typeId"]&&(B["MaxLineNumber"]=2,B["breakWord"]=!0,B["lineHeight"]=25,B["content"]=U["card_name_addr"]?U["card_name_addr"]:"")),X=X.concat(B)}t.setData({painting:{width:N,height:E,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:X}}),console.log(i("名片 share_order_shape views:",X," at pages\\wish\\wishshare\\wishshare.vue:1627"))}else if(4==F&&z&&0==u){N=500,E=700;console.log(i("share_order_shape:",F," card_template:",O,"share_order_bg:",M," at pages\\wish\\wishshare\\wishshare.vue:1632"));for(X=[{type:"image",url:M,top:5,left:5,width:N,height:E}],J=0;J<O.length;J++){B={};B["top"]=O[J]["y"]*E,B["left"]=O[J]["x"]*N,B["width"]=O[J]["width"]*N,B["height"]=O[J]["height"]*E,B["lineHeight"]=O[J]["height"]*E,1==O[J]["viewType"]?("card_love_logo"==O[J]["typeId"]&&z["card_love_logo"]&&(B["type"]="image",B["url"]=z["card_love_logo"]?z["card_love_logo"]:""),"card_love_qrcode"==O[J]["typeId"]&&z["has_shlogo"]&&(B["type"]="image",B["url"]=j||"",B["width"]=70,B["height"]=70,B["radius"]=35)):(B["type"]="text",B["fontSize"]=O[J]["styleSheet"]["fontSize"],B["fontSize"]=parseInt(B["fontSize"])+8,B["color"]=O[J]["color"]?O[J]["color"]:"#333",B["textAlign"]="left",B["breakWord"]=!1,"card_love_title"==O[J]["typeId"]?(B["content"]=z["card_love_title"]?z["card_love_title"].trim():"",B["left"]=B["left"],console.log(i("share_order_shape length:"," at pages\\wish\\wishshare\\wishshare.vue:1676"))):"card_love_related"==O[J]["typeId"]?B["content"]=z["card_love_related"]?z["card_love_related"]:"":"card_love_phone"==O[J]["typeId"]?B["content"]=z["card_love_phone"]?"电话:"+z["card_love_phone"]:"":"card_love_addr"==O[J]["typeId"]?(B["MaxLineNumber"]=2,B["breakWord"]=!0,B["lineHeight"]=25,B["content"]=z["card_love_addr"]?"地址:"+z["card_love_addr"]:""):"card_love_content"==O[J]["typeId"]&&(B["MaxLineNumber"]=6,B["breakWord"]=!0,B["lineHeight"]=30,B["content"]=z["card_love_content"]?z["card_love_content"]:"")),X=X.concat(B)}t.setData({painting:{width:N,height:E,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:X}})}else if(5!=F&&10!=C||0!=u)k>0?(console.log(i("share_art_id:",k," at pages\\wish\\wishshare\\wishshare.vue:1791")),t.setData({painting:{width:520,height:680,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:[{type:"image",url:D,top:45,left:30,width:50,height:50,borderRadius:25},{type:"text",content:"来自"+I+"的分享",fontSize:18,color:"#333",textAlign:"left",top:60,left:90,bolder:!1},{type:"image",url:W,top:120,left:85,width:350,height:350},{type:"text",content:P,fontSize:20,color:"#999",textAlign:"left",top:500,left:85,bolder:!0,lineHeight:25,MaxLineNumber:2,breakWord:!0,width:350},{type:"rect",top:540,left:85,background:"#eeeeee",width:350,height:1},{type:"text",content:"长按识别二维码查看详情",fontSize:18,color:"#333",textAlign:"left",top:590,left:85,breakWord:!1,bolder:!0},{type:"image",url:A,top:550,left:330,width:90,height:90}]}})):(console.log(i("其他 else"," at pages\\wish\\wishshare\\wishshare.vue:1865")),t.setData({painting:{width:375,height:667,windowHeight:t.windowHeight,windowWidth:t.windowWidth,background:"white",clear:!0,views:[{type:"image",url:m,top:0,left:10,width:375,height:667},{type:"image",url:r,top:10,left:10,width:365,height:657},{type:"image",url:h+"/api/WXPay/getQRCode?username="+c+"&appid="+l+"&secret="+p+"&shop_type="+s+"&qr_type="+o+"&task="+n+"&msg_id="+d,top:480,left:130,width:110,height:125},{type:"text",content:"长按识别二维码，进入送心小程序",fontSize:12,color:"#FFF",textAlign:"left",top:620,left:95,lineHeight:30,MaxLineNumber:2,breakWord:!0}]}}));else{console.log(i("share_order_shape:",F," card_template:",O," at pages\\wish\\wishshare\\wishshare.vue:1710"));for(N=500,E=700,X=[{type:"image",url:M,top:5,left:5,width:N,height:E}],J=0;J<O.length;J++){B={};B["top"]=O[J]["y"]*E,B["left"]=O[J]["x"]*N,B["width"]=O[J]["width"]*N,B["height"]=O[J]["height"]*E,B["lineHeight"]=O[J]["height"]*E,1==O[J]["viewType"]?("card_cele_logo"==O[J]["typeId"]&&(B["type"]="image",B["url"]=q["card_cele_logo"]?q["card_cele_logo"]:"",B["roundedRect"]=10),"card_cele_qrcode"==O[J]["typeId"]&&q["has_shlogo"]&&(B["type"]="image",B["url"]=j||"",B["width"]=80,B["height"]=80,B["radius"]=40)):(B["type"]="text",B["textAlign"]="left",B["fontSize"]=O[J]["styleSheet"]["fontSize"],B["fontSize"]=parseInt(B["fontSize"])+8,B["color"]=O[J]["color"]?O[J]["color"]:"#333",B["breakWord"]=!1,"card_cele_title"==O[J]["typeId"]?(B["textAlign"]="right",B["content"]=q["card_cele_title"]?q["card_cele_title"].trim():""):"card_cele_content"==O[J]["typeId"]&&(B["MaxLineNumber"]=6,B["breakWord"]=!0,B["lineHeight"]=25,B["content"]=q["card_cele_content"]?q["card_cele_content"]:""),console.log(i("share_order_shape card cele card_template:",O[J]," at pages\\wish\\wishshare\\wishshare.vue:1773"))),X=X.concat(B)}t.setData({painting:{width:N,height:E,windowHeight:t.windowHeight,windowWidth:t.windowWidth,clear:!0,background:"white",views:X}})}if(console.log(i("二维码 paint:",t.painting," at pages\\wish\\wishshare\\wishshare.vue:1933")),t.setData({loadingHidden:!1}),t.paintingData=t.painting,!t.isPainting&&t.paintingData.width&&t.paintingData.height){t.isPainting=!0,t.reset();try{t.readyPigment()}catch(Q){console.log(i("err:",Q," at pages\\wish\\wishshare\\wishshare.vue:1953")),e.showModal({title:"系统错误",content:JSON.stringify(Q.TypeError)})}}},eventSave:function(){wx.saveImageToPhotosAlbum({filePath:this.shareImage,success:function(e){wx.showToast({title:"图片已保存到相册，赶紧晒一下吧~",icon:"none",duration:1500}),this.isSaveImageToPhotosAlbum=!0}})},readyPigment:function(){var e=this,t=this.paintingData,a=t.width,s=t.height,o=t.views;t.background,t.radius;this.width=a,this.height=s;for(var n=0;n<o.length;n++)if(console.log(i("canvasdrawer onload views.length:",o.length," i:",n," at pages\\wish\\wishshare\\wishshare.vue:2031")),"image"===o[n].type){var h=o[n],d={};d=r({},h),console.log(i("canvasdrawer onload image drawData:",d," i:",n," at pages\\wish\\wishshare\\wishshare.vue:2040")),this.drawImage(d)}else"text"===o[n].type?this.drawText(o[n]):"rect"===o[n].type?this.drawRect(o[n]):"round"===o[n].type&&this.drawRound(o[n]);this.ctx.draw(!0,function(){e.toTempFilePath()})},toTempFilePath:function(){var t=this;setTimeout(function(){e.canvasToTempFilePath({canvasId:"canvasdrawer",success:function(e){t.shareImage=e.tempFilePath,t.isPainting=!1},fail:function(e){console.error(i("toTempFilePath error:"+JSON.stringify(e)," at pages\\wish\\wishshare\\wishshare.vue:2083"))}},this)},2e3)},getImageList:function(e){for(var t=[],a=0;a<e.length;a++)"image"===e[a].type&&t.push(e[a].url);this.imageList=t,this.downLoadImages(0)},downLoadImages:function(e){var t=this,a=this.imageList,r=this.tempFileList;e<a.length?this.getImageInfo(a[e]).then(function(a){r.push(a),console.log(i("图片临时文件imgInfo:",a," at pages\\wish\\wishshare\\wishshare.vue:2107")),t.tempFileList=r,t.downLoadImages(e+1)}):(console.log(i("图片临时文件tempFileList:",r," image list:",a," at pages\\wish\\wishshare\\wishshare.vue:2112")),this.startPainting())},tailorImageDraw:function(e,t){var a=1,i=e.width*a/t.originWidth,s=e.height*a/t.originHeight,o=!1;if(i<=1&&s<=1){var n=i>s?i:s,h=e.width*a/n,d=e.height*a/n,_=(t.originWidth-h)/2,c=(t.originHeight-d)/2,g=_+h,l=c+d;e["sx"]=_||0,e["sy"]=c||0,e["ex"]=g||0,e["ey"]=l||0,o=!0}var p=r({},e,{ow:t.originWidth,oh:t.originHeight});return o||delete p.tailor,p},startPainting:function(){for(var t=this,a=this.tempFileList,i=this.paintingData.views,s=0,o=0;s<i.length;s++)if("image"===i[s].type){var n=a[o],h=i[s],d={};h.tailor&&(h=this.tailorImageDraw(h,n)),n&&(h["url"]=n.localPath),d=r({},h),h["url"]&&this.drawImage(d),o++}else"text"===i[s].type?this.drawText(i[s]):"rect"===i[s].type?this.drawRect(i[s]):"round"===i[s].type&&this.drawRound(i[s]);this.ctx.draw(!0,function(){e.setStorageSync("CACHE_KEYS",t.cache),t.saveImageToLocal()})},_drawRadiusRect:function(e){var t=e.top,a=void 0===t?0:t,i=e.left,r=void 0===i?0:i,s=e.width,o=void 0===s?0:s,n=e.height,h=void 0===n?0:n,d=e.radius,_=void 0===d?0:d,c=(e.background,r),g=a,l=o,p=h,w=_;this.ctx.beginPath(),this.ctx.moveTo(c+w,g),this.ctx.lineTo(c+l-w,g),this.ctx.arc(c+l-w,g+w,w,2*Math.PI*.75,2*Math.PI*1),this.ctx.lineTo(c+l,g+p-w),this.ctx.arc(c+l-w,g+p-w,w,0,2*Math.PI*.25),this.ctx.lineTo(c+w,g+p),this.ctx.arc(c+w,g+p-w,w,2*Math.PI*.25,2*Math.PI*.5),this.ctx.lineTo(c,g+w),this.ctx.arc(c+w,g+w,w,2*Math.PI*.5,2*Math.PI*.75)},drawImage:function(t){t.type,t.background;var a=t.top,r=void 0===a?0:a,s=t.left,o=void 0===s?0:s,n=t.width,h=void 0===n?0:n,d=t.height,_=void 0===d?0:d,c=t.radius,g=void 0===c?0:c,l=t.url,p=void 0===l?"":l,w=t.sx,u=void 0===w?0:w,m=t.sy,f=void 0===m?0:m,v=t.ex,y=void 0===v?0:v,x=t.ey,S=void 0===x?0:x;this.ctx.save(),g&&(this.ctx.beginPath(),this._drawRadiusRect(t),this.ctx.fill(),this.ctx.clip()),"tailor"in t?p?this.ctx.drawImage(p,u,f,y,S,o,r,h,_):e.showModal({title:"tailor图片文件不存在",content:"draw url:"+p}):p?(this.ctx.drawImage(p,o,r,h,_),console.log(i("wishshare drawImage url:",p,o,r,h,_," at pages\\wish\\wishshare\\wishshare.vue:2276"))):e.showModal({title:"drawImage 图片文件不存在",content:"draw url:"+p}),this.ctx.restore()},drawText:function(t){var a=this,i=t.MaxLineNumber,s=void 0===i?2:i,o=t.breakWord,n=void 0!==o&&o,h=t.color,d=void 0===h?"black":h,_=t.content,c=void 0===_?"":_,g=t.fontSize,l=void 0===g?16:g,p=t.top,w=void 0===p?0:p,u=t.left,m=void 0===u?0:u,f=t.lineHeight,v=void 0===f?20:f,y=t.textAlign,x=void 0===y?"left":y,S=t.width,b=t.bolder,I=void 0!==b&&b,k=t.textDecoration,T=void 0===k?"none":k;I&&(w-=.3);var P=function(){a.ctx.closePath(),a.ctx.beginPath(),a.ctx.setTextBaseline("top"),a.ctx.setFillStyle(d),a.ctx.setFontSize(l),a.ctx.setTextAlign(x)};if(P(),n){for(var W="",D=w,A=1,L=0,H=0;H<c.length;H++)if(L+=c[H].match(/[^\x00-\xff]/gi)?2:1,W+=[c[H]],(L+3)*e.upx2px(l)>S){if(A===s&&H!==c.length){W=W.substring(0,W.length-1)+"...",this.ctx.fillText(W,m,D),this.drawTextLine(m,D,T,d,l,W),W="";break}this.ctx.fillText(W,m,D),this.drawTextLine(m,D,T,d,l,W),W="",L=0,D+=v,A++}this.ctx.fillText(W,m,D),this.drawTextLine(m,D,T,d,l,W)}else this.ctx.fillText(c,m,w),this.drawTextLine(m,w,T,d,l,c);I&&this.drawText(r({},t,{left:m-.3,top:w,bolder:!1,textDecoration:"none"}))},drawTextLine:function(t,a,i,r,s,o){var n=o.match(/[^\x00-\xff]/gi)?2:1,h=(n+3)*e.upx2px(s);"underline"===i?this.drawRect({background:r,top:a+1.2*s,left:t-1,width:h+2,height:1}):"line-through"===i&&this.drawRect({background:r,top:a+.6*s,left:t-1,width:h+2,height:1})},reset:function(){this.ctx.beginPath(),this.ctx.setFillStyle("#000000"),this.ctx.setStrokeStyle("#000000"),this.ctx.setFontSize(10),this.ctx.setGlobalAlpha(1),this.ctx.setShadow(0,0,0,"rgba(0, 0, 0, 0)"),this.ctx.setLineCap("butt"),this.ctx.setLineJoin("miter"),this.ctx.setLineWidth(1),this.ctx.setMiterLimit(10),this.ctx.draw(),this.ctx.setFillStyle("#000000"),this.ctx.setStrokeStyle("#000000"),this.ctx.setGlobalAlpha(1)},drawRect:function(e){var t=e.background,a=e.top,i=void 0===a?0:a,r=e.left,s=void 0===r?0:r,o=e.width,n=void 0===o?0:o,h=e.height,d=void 0===h?0:h;this.ctx.save(),this.ctx.setFillStyle(t),e.radius?(this._drawRadiusRect(e),this.ctx.fill()):(this.ctx.setFillStyle(t),this.ctx.fillRect(s,i,n,d)),this.ctx.restore()},getImageInfo:function(t){var a=this;return new Promise(function(i,r){if(a.cache[t])i(a.cache[t]);else{var s=new RegExp(/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/);s.test(t)?e.getImageInfo({src:t,complete:function(e){if("getImageInfo:ok"===e.errMsg){var s={url:t,originWidth:e.width,originHeight:e.height,localPath:t};a.cache[t]=s,i(s)}else r(new Error("getImageInfo fail"))}}):(a.cache[t]={url:t,originWidth:0,originHeight:0,localPath:t},i(t))}})},saveImageToLocal:function(){var t=this,a=this.width,i=this.height;e.canvasToTempFilePath({x:0,y:0,width:a,height:i,canvasId:"canvasdrawer",success:function(e){"canvasToTempFilePath:ok"===e.errMsg&&(t.isPainting=!1,t.imageList=[],t.tempFileList=[],t.shareImage=e.tempFilePath,wx.hideLoading())},fail:function(t){wx.hideLoading(),e.showModal({title:"图片保存本地失败",content:"saveImageToLocal"+t})}},this)},setData:function(e){var t,a,i=this,r=[];Object.keys(e).forEach(function(s){r=s.split("."),t=e[s],a=i.$data,r.forEach(function(e,s){s+1==r.length?i.$set(a,e,t):a[e]||i.$set(a,e,{}),a=a[e]})})}}};t.default=x}).call(this,a("6e42")["default"],a("0de9")["default"])},d98d:function(e,t,a){"use strict";a.r(t);var i=a("badd"),r=a.n(i);for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);t["default"]=r.a}},[["5dec","common/runtime","common/vendor"]]]);