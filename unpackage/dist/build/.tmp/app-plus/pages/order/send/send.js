(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/send/send"],{2722:function(e,o,a){},"6ecf":function(e,o,a){"use strict";var t=a("2722"),r=a.n(t);r.a},"71ac":function(e,o,a){"use strict";var t=function(){var e=this,o=e.$createElement;e._self._c},r=[];a.d(o,"a",function(){return t}),a.d(o,"b",function(){return r})},a04e:function(e,o,a){"use strict";a.r(o);var t=a("a946"),r=a.n(t);for(var s in t)"default"!==s&&function(e){a.d(o,e,function(){return t[e]})}(s);o["default"]=r.a},a946:function(e,o,a){"use strict";(function(e,t){function r(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;a("3936"),getApp().globalData.appid,getApp().globalData.secret;var s=getApp().globalData.weburl,n=e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"",d=getApp().globalData.shop_type,i=getApp().globalData.miniprogram_id,g=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[],u=function(){return a.e("common/canvasdrawer/canvasdrawer").then(a.bind(null,"0d30"))},c={data:function(){return{title_name:"礼物送出",title_logo:"/static/images/footer-icon-05.png",gift_logo:s+"/uploads/gift_logo1.png",shop_type:d,miniprogram_id:i,orders:[],orderskus:[],page:1,pagesize:10,status:0,all_rows:0,giftflag:0,scrollTop:0,scrollHeight:0,indicatorDots:!0,vertical:!1,autoplay:!0,interval:3e3,duration:2e3,note_title:"Hi~:",note:"",headimg:n.avatarUrl,nickname:n.nickname,goods_flag:1,send_status:1,navList2:g,is_buymyself:0,formID:"",loadingHidden:!1,order_no:"",order_id:"",goodsshape:"",goodsname:"",username:"",token:"",order_price:"",sku_image:"",sku_share_image:"",shareimage_url:"",windowWidth:"",windowHeight:""}},components:{canvasdrawer:u},props:{},onLoad:function(o){var a=this,r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",d=o.order_no,i=o.receive,g=o.is_buymyself?o.is_buymyself:0,u=a.shop_type,c=(o.share_order_wx_headimg&&o.share_order_wx_headimg,e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"");if(a.setData({order_no:d,is_buymyself:g}),console.log(t("order send 礼品信息 options:",o," at pages\\order\\send\\send.vue:140")),a.get_project_gift_para(),1==i)return console.log(t("礼品接受处理:",o," at pages\\order\\send\\send.vue:144")),void wx.navigateBack();if(!d)return console.log(t("礼品订单号为空:",o," at pages\\order\\send\\send.vue:150")),wx.showToast({title:"礼品订单号为空"+o,icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500);var l=o.orders?JSON.parse(o.orders):a.orders,p=a.orderskus,_=a.note_title,m=c.avatarUrl,f=c.nickname,h=a.note,w=l[0]["shape"],v=l[0]["id"];h=l[0]["rcv_note"],console.log(t("orders:",l," at pages\\order\\send\\send.vue:173"));for(var k=0;k<l.length;k++)for(var y=0;y<l[k]["order_sku"].length;y++)l[k]["order_sku"][y]["goods_name"]=l[k]["order_sku"][y]["goods_name"].substring(0,15),p.push(l[k]["order_sku"][y]),l[k]["order_sku"][y]["sku_image"].indexOf("http")<0&&(l[k]["order_sku"][y]["sku_image"]=s+"/"+l[k]["order_sku"][y]["sku_image"]),5==w&&l[k]["order_sku"][y]["sku_share_image"].indexOf("http")<0&&(l[k]["order_sku"][y]["sku_share_image"]=s+"/"+l[k]["order_sku"][y]["sku_share_image"]);if(console.log(t("order send onload() order sku list:",p," at pages\\order\\send\\send.vue:192")),a.setData({order_no:d,order_id:v,orders:l,orderskus:p,goodsshape:w,goodsname:l[0]["order_sku"][0]["goods_name"],note:h||"",note_title:_,headimg:m,nickname:f,username:r,token:n,send_status:0,goods_flag:l[0]["order_sku"][0]["goods_flag"]?l[0]["order_sku"][0]["goods_flag"]:0,order_price:l[0]["order_price"],sku_image:l[0]["order_sku"][0]["sku_image"]?l[0]["order_sku"][0]["sku_image"]:"",sku_share_image:l[0]["order_sku"][0]["sku_share_image"]?l[0]["order_sku"][0]["sku_share_image"]:""}),5!=l[0]["shape"]&&4!=l[0]["shape"]){var S=a.navList2,x=S.length>0?S[0]["img"]:a.gift_logo;console.log(t("获取带价格的分享图片 "," at pages\\order\\send\\send.vue:219")),wx.request({url:s+"/api/client/get_text_watermark",method:"POST",data:{username:r,access_token:n,order_no:d,text:a.order_price,image:x,shop_type:u},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){var o=e.data.result;o&&a.setData({shareimage_url:o.image}),console.log(t("order send onload() image with watermark:",a.shareimage_url," at pages\\order\\send\\send.vue:244"))}})}1!=g&&5!=w&&4!=w||(console.log(t("自购礼品无需分享到微信 "," at pages\\order\\send\\send.vue:251")),a.returnTapTag()),wx.getSystemInfo({success:function(e){a.setData({windowWidth:e.windowWidth,windowHeight:e.windowHeight})}})},onShow:function(){var o=this,a=getCurrentPages(),t=e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"";o.userInfo=t,a.length>1&&o.setData({title_logo:"../../../images/back.png"})},onShareAppMessage:function(e){var o=this,a=(o.shop_type,o.order_no),r=(o.username,o.goods_flag),s=(o.token,o.goodsshape),n=o.orderskus[0]["sku_share_image"],d=o.orderskus[0]["goods_name"],i=o.navList2,g=5==s?"您收到一份来自"+o.nickname+"的"+d+",点击立即打开。":"您收到一份来自"+o.nickname+"的礼物,点击立即打开。",u=o.shareimage_url,c=i.length>0?i[0]["img"]:o.gift_logo;if(c=u||c,5==s&&(c=n),console.log(t("开始送礼 options:",e,"order_no:",a,"sku_share_image:",n," shareimage_url:",u," imageUrl:",c," navList2:",i," at pages\\order\\send\\send.vue:296")),a){o.setData({send_status:1});var l={title:g,desc:"开启礼物电商时代，200万人都在用的礼物小程序！",path:"/pages/order/receive/receive?page_type=2&order_no="+a+"&receive=1&goods_shape="+s+"&goods_flag="+r,imageUrl:c,success:function(e){console.log(t("更新发送状态:",e," at pages\\order\\send\\send.vue:314")),e.errMsg},fail:function(e){console.log(t("转发失败之后",e," at pages\\order\\send\\send.vue:321")),"shareAppMessage:fail cancel"==e.errMsg?wx.showToast({title:"用户取消转发",icon:"success",duration:1500}):"shareAppMessage:fail"==e.errMsg&&wx.showToast({title:"礼物发送失败",icon:"loading",duration:1500})},complete:function(e){console.log(t("转发结束:",e," at pages\\order\\send\\send.vue:340")),wx.showToast({title:"礼物发送完成",icon:"loading",duration:1500})}};return"button"===e.from&&console.log(t("礼物分享:",l," at pages\\order\\send\\send.vue:351")),l}console.log(t("礼品单号为空 send"," at pages\\order\\send\\send.vue:299"))},methods:{shareToWXminiProgram:function(){var o=this,a=(o.shop_type,o.order_no),r=(wx.getStorageSync("username")&&wx.getStorageSync("username"),wx.getStorageSync("token")&&wx.getStorageSync("token"),o.miniprogram_id),s=e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):"",n=s.nickname?s.nickname:"朋友",d=o.goods_flag,i=o.goodsshape,g=o.orderskus[0]["sku_share_image"],u=o.orderskus[0]["goods_name"],c=o.navList2,l=5==i?"您收到一份来自"+n+"的"+u+",点击立即打开。":"您收到一份来自"+o.nickname+"的礼物,点击立即打开。",p=o.shareimage_url,_=c.length>0?c[0]["img"]:o.gift_logo;_=p||_,5==i&&(_=g),console.log(t("开始送礼 order_no:",a,"sku_share_image:",g," shareimage_url:",p," imageUrl:",_," navList2:",c," at pages\\order\\send\\send.vue:381")),a?(o.setData({send_status:1}),e.share({provider:"weixin",type:5,title:l,imageUrl:p,miniProgram:{id:r,path:"/pages/order/receive/receive?page_type=2&order_no="+a+"&receive=1&goods_shape="+i+"&goods_flag="+d,type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(t(e," at pages\\order\\send\\send.vue:403"))},fail:function(o){console.log(t(o," at pages\\order\\send\\send.vue:412"));var a=o.errMsg;"客户端未安装"==a.share.fail?e.showModal({title:"分享失败",content:"微信客户端未安装"}):e.showModal({title:"分享失败",content:a.share.fail})}})):console.log(t("礼品单号为空 send"," at pages\\order\\send\\send.vue:384"))},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},returnForm:function(e){var o=this,a=e.detail.formId;o.setData({formID:a}),console.log(t("send returnTapTag() fromID:",a," at pages\\order\\send\\send.vue:449")),o.remindMessage(),o.returnTapTag()},returnTapTag:function(){var e,o=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",i=o.goods_flag,g=o.order_no,u=o.order_id,c=o.note,l=o.is_buymyself,p=o.goodsshape,_=o.sku_image,m=o.sku_share_image,f=wx.getStorageSync("wx_headimg_cache");f||o.headimg;wx.request({url:s+"/api/client/update_order_status",method:"POST",data:(e={username:a,shop_type:d},r(e,"shop_type",d),r(e,"access_token",n),r(e,"status_info","send"),r(e,"order_no",g),r(e,"goods_flag",i),r(e,"is_buymyself",l),e),header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(t("礼物发送状态更新完成:",e.data," is_buymyself:",l," at pages\\order\\send\\send.vue:488")),1==l&&5!=p&&4!=p?(console.log(t("order send returnTapTag() 自购礼品 自动接收处理"," at pages\\order\\send\\send.vue:492")),wx.navigateTo({url:"/pages/order/receive/receive?order_no="+g+"&receive=1&is_buymyself="+l})):1!=l||5!=p&&4!=p?(getApp().globalData.has_sent=1,setTimeout(function(){wx.switchTab({url:"../../index/index"})},300)):(console.log(t("order send returnTapTag() 贺卡请柬 互动卡 转分享页面"," at pages\\order\\send\\send.vue:498")),wx.showToast({title:" 加载中",icon:"loading",duration:1e3}),wx.navigateTo({url:"/pages/wish/wishshare/wishshare?share_order_id="+u+"&share_order_shape="+p+"&share_order_note="+c+"&share_order_bg="+_+"&share_order_image="+m}))}})},remindMessage:function(){var e,o=this,a=o.formID,n=wx.getStorageSync("openid")?wx.getStorageSync("openid"):"",d=wx.getStorageSync("username")?wx.getStorageSync("username"):"",i=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",g=wx.getStorageSync("m_id")?wx.getStorageSync("m_id"):0,u=o.order_no,c=o.shop_type,l=1;wx.request((e={url:s+"/api/WXPay/sendMessage2Openid",method:"POST",header:{"content-type":"application/x-www-form-urlencoded",Accept:"application/json"},data:{m_id:g,openid:n,from_username:d,access_token:i,formId:a,order_no:u,appid:getApp().globalData.appid,appsecret:getApp().globalData.secret,shop_type:c,msg_type:l}},r(e,"header",{"content-type":"application/x-www-form-urlencoded"}),r(e,"success",function(e){console.log(t("send remindMessage() 微信通知礼物接收:",e.data," at pages\\order\\send\\send.vue:558"))}),e))},scroll:function(e){this.setData({scrollTop:e.detail.scrollTop})},topLoad:function(e){this.setData({scrollTop:0}),console.log(t("lower"," at pages\\order\\send\\send.vue:576"))},get_project_gift_para:function(){var e=this,o=g,a=e.shop_type;e.page,e.pagesize;console.log(t("send get_project_gift_para navList2:",g,"length:",g.length," at pages\\order\\send\\send.vue:584")),0==g.length&&wx.request({url:s+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){console.log(t("get_project_gift_para:",a.data.result," at pages\\order\\send\\send.vue:601")),o=a.data.result,o&&(e.setData({navList2:o}),console.log(t("send get_project_gift_para navList_new:",o," at pages\\order\\send\\send.vue:617")))}}),setTimeout(function(){e.setData({loadingHidden:!0})},1500)},showGoods:function(e){var o=e.currentTarget.dataset.skuId,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=e.currentTarget.dataset.goodsId,n=e.currentTarget.dataset.goodsName;console.log(t("showGoods"," at pages\\order\\send\\send.vue:635")),console.log(t(n+" "+s," at pages\\order\\send\\send.vue:636")),wx.navigateTo({url:"../../details/details?sku_id="+o+"&goods_name="+n+"&id="+s+"&token="+r+"&username="+a})},setData:function(e){var o,a,t=this,r=[];Object.keys(e).forEach(function(s){r=s.split("."),o=e[s],a=t.$data,r.forEach(function(e,s){s+1==r.length?t.$set(a,e,o):a[e]||t.$set(a,e,{}),a=a[e]})})}}};o.default=c}).call(this,a("6e42")["default"],a("0de9")["default"])},ae8f:function(e,o,a){"use strict";(function(e){a("ee7a"),a("921b");t(a("66fd"));var o=t(a("d500"));function t(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,a("6e42")["createPage"])},d500:function(e,o,a){"use strict";a.r(o);var t=a("71ac"),r=a("a04e");for(var s in r)"default"!==s&&function(e){a.d(o,e,function(){return r[e]})}(s);a("6ecf");var n=a("2877"),d=Object(n["a"])(r["default"],t["a"],t["b"],!1,null,null,null);o["default"]=d.exports}},[["ae8f","common/runtime","common/vendor"]]]);