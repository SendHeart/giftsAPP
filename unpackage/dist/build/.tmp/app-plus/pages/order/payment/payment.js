(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/payment/payment"],{1326:function(e,t,a){"use strict";a.r(t);var o=a("f69e"),n=a.n(o);for(var r in o)"default"!==r&&function(e){a.d(t,e,function(){return o[e]})}(r);t["default"]=n.a},5946:function(e,t,a){"use strict";a.r(t);var o=a("5bb1"),n=a("1326");for(var r in n)"default"!==r&&function(e){a.d(t,e,function(){return n[e]})}(r);a("bb99");var s=a("2877"),d=Object(s["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=d.exports},"5bb1":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},n=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return n})},bb99:function(e,t,a){"use strict";var o=a("e533"),n=a.n(o);n.a},e19d:function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");o(a("66fd"));var t=o(a("5946"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},e533:function(e,t,a){},f69e:function(e,t,a){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a("3936");var n=getApp().globalData.weburl,r=getApp().globalData.shop_type,s=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[],d={data:function(){return{title_name:"送出礼物",title_logo:"../../../images/footer-icon-05.png",orderNo:"",orders:[],totalFee:0,sku_id:"",navList2:s,page:1,pagesize:5,page_num:0,all_rows:0,shop_type:r,is_buymyself:0,startBarHeight:"",navgationHeight:"",loadingHidden:!1,username:"",token:"",received:"",dkheight:"",userInfo:"",send_status:0,goods_flag:"",order_price:"",address_userName:"",address_postalCode:"",address_provinceName:"",address_cityName:"",address_countyName:"",address_detailInfo:"",address_nationalCode:"",address_telNumber:"",receive_status:0}},components:{},props:{},onLoad:function(t){var a=this,o=t.orderNo,r=t.totalFee?t.totalFee:0,s=t.is_buymyself?t.is_buymyself:0,d=t.received?t.received:0,i=wx.getStorageSync("username")?wx.getStorageSync("username"):"",c=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",p=a.shop_type;a.navList2;a.get_project_gift_para(),wx.request({url:n+"/api/client/query_order",method:"POST",data:{username:i,access_token:c,order_no:o,shop_type:p},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("payment onload:",t.data.result," at pages\\order\\payment\\payment.vue:126"));var p=t.data.result,u=a.sku_id;if(p){var l=0;console.log(e("orderObjects:"+p,"totalFee:",r," at pages\\order\\payment\\payment.vue:132"));for(var g=0;g<p.length;g++){p[g]["logo"].indexOf("http")<0&&(p[g]["logo"]=n+p[g]["logo"]);for(var m=0;m<p[g]["order_sku"].length;m++)p[g]["order_sku"][m]["sku_image"].indexOf("http")<0&&(p[g]["order_sku"][m]["sku_image"]=n+p[g]["order_sku"][m]["sku_image"]),u=""!=u?u+","+p[g]["order_sku"][m]["sku_id"]:p[g]["order_sku"][m]["sku_id"];l+=p[g]["order_price"]}r=100*l.toFixed(2),a.setData({orders:p,orderNo:o,username:i,token:c,totalFee:r||l,sku_id:u,is_buymyself:s,received:d}),(0==s&&0==d||0==r)&&a.pay()}else wx.showToast({title:t.data.info,icon:"loading",duration:1500})}}),wx.getSystemInfo({success:function(t){var o=t.windowHeight;console.log(e(o," at pages\\order\\payment\\payment.vue:179")),a.setData({dkheight:o-.05*o-120})}})},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"../../../images/back.png"})},methods:{formSubmit:function(t){var a=this,o=t.detail.formId,n=t.currentTarget.dataset.name;console.log(e("formSubmit() formID：",o," form name:",n," at pages\\order\\payment\\payment.vue:201")),"pay"==n&&a.pay(),o&&a.submintFromId(o)},submintFromId:function(t){var a=this,o=(t=t,a.shop_type),r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:n+"/api/client/save_member_formid",method:"POST",data:{username:r,access_token:s,formId:t,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("submintFromId() update success: ",t.data," at pages\\order\\payment\\payment.vue:230"))}})},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},get_project_gift_para:function(){var t=this,a=t.navList2,o=t.shop_type,r=(t.page,t.pagesize,t.navList2);console.log(e("payment get_project_gift_para navList2:",r,"length:",r.length," at pages\\order\\payment\\payment.vue:254")),0==r.length&&wx.request({url:n+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(e("get_project_gift_para:",o.data.result," at pages\\order\\payment\\payment.vue:271")),a=o.data.result,a&&(t.setData({navList2:a}),console.log(e("payment get_project_gift_para navList_new:",a," at pages\\order\\payment\\payment.vue:287")))}}),setTimeout(function(){t.setData({loadingHidden:!0})},1500)},pay:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=t.totalFee,s=t.orderNo,d=t.orders,i=t.shop_type,c=t.is_buymyself,p=t.received;if(console.log(e("payment username",a," totalFee:",r," is_buymyself:",c," received:",p," at pages\\order\\payment\\payment.vue:309")),r<=0)return t.delete_cart(),void wx.navigateTo({url:"../send/send?order_no="+s+"&orders="+JSON.stringify(d)+"&is_buymyself="+c});1==c||1==p?wx.request({url:n+"/api/WXPay",data:{openid:a,body:"商城",tradeNo:t.orderNo,totalFee:t.totalFee,shop_type:i,user_type:"APP"},method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){a.data.timestamp?wx.requestPayment({provider:"wxpay",timeStamp:JSON.stringify(a.data.timestamp),nonceStr:a.data.noncestr,package:a.data.package,signType:"MD5",paySign:a.data.sign,orderInfo:JSON.stringify({appid:a.data.appid,noncestr:a.data.noncestr,package:a.data.package,partnerid:a.data.partnerid,prepayid:a.data.prepayid,timestamp:a.data.timestamp,sign:a.data.sign}),success:function(a){console.log(e("支付成功:"+a," at pages\\order\\payment\\payment.vue:362")),1==p?wx.navigateTo({url:"/pages/lottery/lottery?lottery_type=0&order_no="+s}):(t.delete_cart(),t.returnTapTag())},fail:function(t){console.log(e(JSON.stringify(t)," at pages\\order\\payment\\payment.vue:386")),o.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1}),console.log(e("fail:"+JSON.stringify(t)," at pages\\order\\payment\\payment.vue:391"))}}):(console.log(e("支付返回:"+a," at pages\\order\\payment\\payment.vue:395")),o.showModal({title:"支付返回错误",content:"response error:"+JSON.stringify(a)}))},fail:function(t){console.log(e("发起支付失败",t," at pages\\order\\payment\\payment.vue:403"))}}):(console.log(e("未支付送礼","orderNo:",t.orderNo," orders:",t.orders," at pages\\order\\payment\\payment.vue:408")),t.delete_cart(),wx.navigateTo({url:"../send/send?order_no="+t.orderNo+"&orders="+JSON.stringify(t.orders)+"&is_buymyself="+c}))},returnTapTag:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=(t.goods_flag,t.orderNo),s=t.is_buymyself,d=t.shop_type;1!=s&&wx.request({url:n+"/api/client/query_order",method:"POST",data:{username:a,access_token:o,order_no:r,order_type:"send",shop_type:d},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(i){console.log(e("order payment returnTapTag()再次确认订单状态:",i.data," at pages\\order\\payment\\payment.vue:441"));var c=i.data.result;return c?c[0]["gift_status"]>0?(console.log(e("order payment returnTapTag() 该订单已送出 orderObjects:",c," at pages\\order\\payment\\payment.vue:456")),wx.showToast({title:"该订单已送出",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500)):(t.setData({send_status:0,orders:c,goods_flag:c[0]["order_sku"][0]["goods_flag"],order_price:c[0]["order_price"]}),void wx.request({url:n+"/api/client/update_order_status",method:"POST",data:{username:a,shop_type:d,access_token:o,status_info:"send",order_no:r,goods_flag:t.goods_flag,is_buymyself:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("order payment returnTapTag() 礼物发送状态更新完成:",t.data," is_buymyself:",s," at pages\\order\\payment\\payment.vue:491")),console.log(e("order payment returnTapTag() 自购礼品 自动接收处理"," at pages\\order\\payment\\payment.vue:493"))}})):(console.log(e("order payment returnTapTag() 没有该订单 orderObjects:",c," at pages\\order\\payment\\payment.vue:444")),wx.showToast({title:"没有该订单",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500))}})},receiveTapTag:function(){var e=this,t=e.is_buymyself,a=1==t?"收货地址":"请确认",o=1==t?"详细地址":"确认接受吗";1==t?e.set_address():wx.showModal({title:a,content:o,success:function(t){t.confirm&&e.set_address()}})},set_address:function(){var t=this,a=t.shop_type,o=t.orderNo,r=t.goods_flag,s=wx.getStorageSync("openid")?wx.getStorageSync("openid"):"",d=(t.userInfo.nickName,t.userInfo.avatarUrl,t.address_userName),i=t.address_postalCode,c=t.address_provinceName,p=t.address_cityName,u=t.address_countyName,l=t.address_detailInfo,g=t.address_nationalCode,m=t.address_telNumber,y=t.is_buymyself;wx.getSetting({success:function(e){e.authSetting["scope.address"]||wx.authorize({scope:"scope.address",success:function(){}})}}),wx.chooseAddress({success:function(_){console.log(e("微信收货地址:"," at pages\\order\\payment\\payment.vue:563")),console.log(e(_," at pages\\order\\payment\\payment.vue:564")),d=_.userName,i=_.postalCode,c=_.provinceName,p=_.cityName,u=_.countyName,l=_.detailInfo,g=_.nationalCode,m=_.telNumber,t.setData({address_userName:d,address_postalCode:i,address_provinceName:c,address_cityName:p,address_countyName:u,address_detailInfo:l,address_nationalCode:g,address_telNumber:m}),console.log(e("收货地址选择 订单号 order receive chooseAddress:"+o+" openid:"+s," at pages\\order\\payment\\payment.vue:583")),wx.request({url:n+"/api/client/update_order_status",method:"POST",data:{username:t.username,shop_type:a,openid:s,nickname:t.nickname,headimg:t.headimg,order_no:o,status_info:"receive",goods_flag:r,address_userName:d,address_postalCode:i,address_provinceName:c,address_cityName:p,address_countyName:u,address_detailInfo:l,address_nationalCode:g,address_telNumber:m},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){console.log(e("order receive set_address()礼物已接收:",a.data," at pages\\order\\payment\\payment.vue:611")),"y"==a.data.status?(wx.showToast({title:"礼物已接收",icon:"success",duration:1500}),t.setData({receive_status:1}),3==r&&setTimeout(function(){wx.navigateTo({url:"/pages/member/task/task"})},200),1==y&&(console.log(e("自购礼物订单抽奖 to lottery order_no:",o," at pages\\order\\payment\\payment.vue:634")),wx.navigateTo({url:"/pages/lottery/lottery?lottery_type=0&order_no="+o}))):(console.log(e("礼物接收失败 order_no:",o," at pages\\order\\payment\\payment.vue:640")),wx.showToast({title:a.data.info?a.data.info:"礼物接收失败",icon:"loading",duration:1500}),t.setData({receive_status:0}))}})}})},delete_cart:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=t.sku_id,s=t.shop_type;console.log(e("payment delete_cart sku_id:",r," at pages\\order\\payment\\payment.vue:661")),wx.request({url:n+"/api/client/delete_cart",method:"POST",data:{username:a,access_token:o,sku_id:r,shop_type:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("payment delete_cart:",t.data.result," at pages\\order\\payment\\payment.vue:677"))}})},setData:function(e){var t,a,o=this,n=[];Object.keys(e).forEach(function(r){n=r.split("."),t=e[r],a=o.$data,n.forEach(function(e,r){r+1==n.length?o.$set(a,e,t):a[e]||o.$set(a,e,{}),a=a[e]})})}}};t.default=d}).call(this,a("0de9")["default"],a("6e42")["default"])}},[["e19d","common/runtime","common/vendor"]]]);