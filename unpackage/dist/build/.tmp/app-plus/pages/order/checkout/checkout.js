(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/checkout/checkout"],{1013:function(e,t,o){},"13b3":function(e,t,o){"use strict";(function(e){o("ee7a"),o("921b");a(o("66fd"));var t=a(o("d8ed"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},"6e77":function(e,t,o){"use strict";o.r(t);var a=o("aa32"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);t["default"]=n.a},"723d":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c},n=[];o.d(t,"a",function(){return a}),o.d(t,"b",function(){return n})},a884:function(e,t,o){"use strict";var a=o("1013"),n=o.n(a);n.a},aa32:function(e,t,o){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("3936"),r=getApp().globalData.weburl,c=getApp().globalData.shop_type,s={data:function(){return{title_name:"送出礼品",title_logo:"/static/images/footer-icon-05.png",amount:0,carts:[],cartIds:null,addressList:[],addressData:[],addressIndex:0,address_id:0,username:null,token:null,page:1,pagesize:5,page_num:0,page_red:1,page_red_num:0,all_rows:0,all_red_rows:0,shop_type:c,showmorehidden:!1,modalHiddenCoupon:!0,couponType:1,selectedAllStatus:!1,selectedRedAllStatus:!1,discountpay:0,payamount:0,order_num:1,dkheight:"",delivery_price:"",order_type:"",order_note:"",order_image:"",is_buymyself:"",order_shape:"",order_voice:"",order_voicetime:"",order_color:"",card_register_info:"",card_name_info:"",card_cele_info:"",card_love_info:"",card_template:"",coupons_list:"",selected_coupon_id:"",selected_coupon_name:"",selected_coupon_content:"",selected_coupon_footer:"",selected_coupon_starttime:"",selected_coupon_endtime:"",selected_coupon_type:"",selected_coupon_amount:"",selected_coupon_index:"",selected_couponimage:"",coupons_quan_list:"",selected_coupon_quan_index:"",selected_coupon_quan_amount:"",coupons_red_list:"",selected_coupon_red_index:"",selected_coupon_red_amount:""}},components:{},props:{},onLoad:function(t){var o=this;o.readCarts(t),wx.getSystemInfo({success:function(t){var a=t.windowHeight;console.log(e(a," at pages\\order\\checkout\\checkout.vue:223")),o.setData({dkheight:a-.05*a-20})}})},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"/static/images/back.png"}),e.loadAddress()},methods:{formSubmit:function(t){var o=this,a=t.detail.formId,n=t.currentTarget.dataset.name;console.log(e("formSubmit() formID：",a," form name:",n," at pages\\order\\checkout\\checkout.vue:247")),"confirmOrder"==n?o.confirmOrder():"getMoreOrders"==n&&o.getMoreOrdersTapTag(),a&&o.submintFromId(a)},submintFromId:function(t){var o=this,a=(t=t,o.shop_type),n=wx.getStorageSync("username")?wx.getStorageSync("username"):"",c=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:r+"/api/client/save_member_formid",method:"POST",data:{username:n,access_token:c,formId:t,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("submintFromId() update success: ",t.data," at pages\\order\\checkout\\checkout.vue:278"))}})},showGoods:function(e){var t=e.currentTarget.dataset.skuId,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=e.currentTarget.dataset.goodsId,r=e.currentTarget.dataset.goodsName,c=e.currentTarget.dataset.goodsPrice,s=e.currentTarget.dataset.goodsSale,d=(e.currentTarget.dataset.goodsInfo,e.currentTarget.dataset.image);wx.navigateTo({url:"../../details/details?sku_id="+t+"&goods_name="+r+"&id="+n+"&goods_price="+c+"&sale="+s+"&goods_info=&image="+d+"&token="+a+"&username="+o})},order_numFun:function(t){var o=this,a=parseInt(t.detail.value?t.detail.value:0),n=o.amount,r=o.discountpay?o.discountpay:0,c=(n*a-r).toFixed(2);console.log(e("order_num amount:",n," discountpay:",r," order_num:",a," payamount:",c," at pages\\order\\checkout\\checkout.vue:302")),o.setData({order_num:a,payamount:c})},goBack:function(){var e=getCurrentPages(),t=null;e.length>1&&(t=e[e.length-2]),t&&t.setData({customerSource:that.source[that.curIndex]}),a.navigateBack()},readCarts:function(t){var o=this;console.log(e("order checkout from hall  readCarts options:",t," at pages\\order\\checkout\\checkout.vue:327"));var a=parseFloat(t.amount),n=o.payamount,r=o.discountpay,c=JSON.parse(t.carts),s=t.cartIds,d=parseFloat(c[0].delivery_price),u=s.split(","),i=t.order_type?t.order_type:"",_=t.order_note?t.order_note:"",l=t.order_image?t.order_image:"",p=t.order_shape?t.order_shape:0,g=t.order_voice?t.order_voice:"",m=t.order_voicetime?t.order_voicetime:0,f=t.order_color?t.order_color:"#333",y=t.is_buymyself?t.is_buymyself:0,h=t.card_register_info?JSON.parse(t.card_register_info):"",v=t.card_name_info?JSON.parse(t.card_name_info):"",S=t.card_cele_info?JSON.parse(t.card_cele_info):"",x=t.card_love_info?JSON.parse(t.card_love_info):"",w=t.card_template?JSON.parse(t.card_template):"";n=(a-r).toFixed(2),this.setData({amount:a,payamount:n,delivery_price:d,carts:c,cartIds:u,order_type:i,order_note:_,order_image:l,username:t.username,token:t.token,is_buymyself:y,order_shape:p,order_voice:g,order_voicetime:m,order_color:f,card_register_info:h,card_name_info:v,card_cele_info:S,card_love_info:x,card_template:w}),console.log(e("checkouts readCarts() order_image:",l,"order_shape:",p,"card_template:",w," card_name_info:",v," card_register_info:",h," card_love_info:",x," at pages\\order\\checkout\\checkout.vue:389"))},confirmOrder:function(){var t=this,o=t.order_num;if(0!=o){var a=t.is_buymyself,n=t.address_id?t.address_id:0,c=(t.carts,t.cartIds),s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",d=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",u=t.selectedAllStatus,i=t.selectedRedAllStatus,_=t.selected_coupon_quan_index?t.selected_coupon_quan_index:0,l=t.selected_coupon_red_index?t.selected_coupon_red_index:0;console.log(e("confirmOrder selected_coupon_quan_index:",t.selected_coupon_quan_index,"selected_coupon_red_index:",t.selected_coupon_red_index," coupons_red_list:",t.coupons_red_list," at pages\\order\\checkout\\checkout.vue:415"));var p=u?t.coupons_quan_list[_]["amount"]:0,g=u?t.coupons_quan_list[_]["id"]:0,m=u?t.coupons_quan_list[_]["type"]:1,f=i?t.coupons_red_list[l]["amount"]:0,y=i?t.coupons_red_list[l]["id"]:0,h=i?t.coupons_red_list[l]["type"]:1,v=t.shop_type,S=(t.amount,1==a?"app":"gift"),x=t.order_image,w=t.order_note,k=t.order_shape,T=t.order_voice,b=t.order_voicetime,D=t.order_color,q=(o=t.order_num,JSON.stringify(t.card_register_info)),O=JSON.stringify(t.card_name_info),A=JSON.stringify(t.card_cele_info),C=JSON.stringify(t.card_love_info),I=JSON.stringify(t.card_template);w||(w="送你一份礼物，愿你喜欢!"),console.log(e("order_image:",x,"order_shape:",k,"card_template:",I," card_cele_info:",A," at pages\\order\\checkout\\checkout.vue:440")),wx.request({url:r+"/api/client/add_order",method:"POST",data:{username:s,access_token:d,shop_type:v,sku_id:c,buy_type:"cart",order_type:S,note:w,order_image:x,order_shape:k,order_voice:T,order_voicetime:b,order_color:D,card_register_info:q,card_name_info:O,card_cele_info:A,card_love_info:C,card_template:I,coupon_id:u?g:0,coupon_type:u?m:0,coupon_amount:u?p:0,coupon_red_id:i?y:0,coupon_red_type:i?h:0,coupon_red_amount:i?f:0,order_num:o||1,is_buymyself:a||0,address_id:n},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(e("提交订单:",o.data.result," at pages\\order\\checkout\\checkout.vue:478"));var n=o.data.result;o.data.info?wx.showToast({title:o.data.info,icon:"none",duration:2e3}):0==n["order_pay"]||0==a?(t.delete_cart(),t.zero_pay(n["order_no"])):wx.navigateTo({url:"../../order/payment/payment?orderNo="+n["order_no"]+"&totalFee="+n["order_pay"]+"&is_buymyself="+a})}})}else wx.showToast({title:"请输入份数",icon:"loading",duration:2e3})},delete_cart:function(){var t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=t.cartIds,c=t.shop_type;console.log(e("payment delete_cart sku_id:",n," at pages\\order\\checkout\\checkout.vue:512")),wx.request({url:r+"/api/client/delete_cart",method:"POST",data:{username:o,access_token:a,sku_id:n,shop_type:c},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("payment delete_cart:",t.data.result," at pages\\order\\checkout\\checkout.vue:528"))}})},zero_pay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=o.is_buymyself;wx.request({url:r+"/api/client/query_order",method:"POST",data:{username:a,access_token:n,order_no:t,shop_type:c},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(e("order checkout zero_pay() 0支付订单查询:",o.data," at pages\\order\\checkout\\checkout.vue:552"));var a=o.data.result;return a?a[0]["gift_status"]>0?(console.log(e("order checkout zero_pay() 该订单已送出 orderObjects:",a," at pages\\order\\checkout\\checkout.vue:568")),wx.showToast({title:"该订单已送出",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500)):void wx.navigateTo({url:"../send/send?order_no="+t+"&orders="+JSON.stringify(a)+"&is_buymyself="+s}):(console.log(e("order checkout zero_pay() 没有该订单 orderObjects:",a," at pages\\order\\checkout\\checkout.vue:556")),wx.showToast({title:"没有该订单",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500))}})},loadAddress:function(){var t=this,o=[],a=t.shop_type,n=[],c=t.address_id?t.address_id:0,s=t.addressIndex?t.addressIndex:0,d=wx.getStorageSync("username")?wx.getStorageSync("username"):"",u=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",i=(t.addressData,t.is_buymyself?t.is_buymyself:0);wx.request({url:r+"/api/client/get_member_address",method:"POST",data:{username:d,token:u,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){if(n=a.data.result?a.data.result:n,0!=n){for(var r=0;r<n.length;r++)1==n[r]["isDefault"]&&t.setData({addressIndex:r}),o[r]=n[r];t.addressList=o,t.addressObjects=n,t.addressData=n[s],t.address_id=n[s]?n[s]["id"]:c,console.log(e("address list:",n,"addressIndex:",s," addressData:",n[s]," at pages\\order\\checkout\\checkout.vue:634"))}else wx.navigateTo({url:"/pages/address/list/list?is_buymyself="+i})}})},bindSelectRedAll:function(){var t=this,o=t.selectedRedAllStatus,a=t.modalHiddenCoupon,n=t.page_red_num;o=!o,a=!a,t.setData({selectedRedAllStatus:o,modalHiddenCoupon:a,couponType:2}),console.log(e("bindSelectRedAll :",o,"page_red_num:",n," at pages\\order\\checkout\\checkout.vue:653")),o&&0==n?t.query_coupon():t.setData({coupons_list:t.coupons_red_list})},bindSelectAll:function(){var t=this,o=t.selectedAllStatus,a=t.modalHiddenCoupon,n=t.page_num;o=!o,a=!a,t.setData({selectedAllStatus:o,modalHiddenCoupon:a,couponType:1}),console.log(e("selectedAllStatus :",o,"page_num:",n," at pages\\order\\checkout\\checkout.vue:678")),o&&0==n?t.query_coupon():t.setData({coupons_list:t.coupons_quan_list})},bindSelectCoupon:function(t){var o=this,a=o.couponType,n=t.currentTarget.dataset.couponindex?t.currentTarget.dataset.couponindex:0,r=t.currentTarget.dataset.couponid?t.currentTarget.dataset.couponid:0,c=t.currentTarget.dataset.couponname?t.currentTarget.dataset.couponname:"",s=t.currentTarget.dataset.couponcontent?t.currentTarget.dataset.couponcontent:"",d=t.currentTarget.dataset.couponfooter?t.currentTarget.dataset.couponfooter:"",u=t.currentTarget.dataset.starttime,i=t.currentTarget.dataset.endtime,_=t.currentTarget.dataset.coupontype?t.currentTarget.dataset.coupontype:1,l=t.currentTarget.dataset.couponamount?t.currentTarget.dataset.couponamount:0,p=t.currentTarget.dataset.couponimage;if(1==a)var g=o.coupons_quan_list;else if(2==a)g=o.coupons_red_list;for(var m=0;m<g.length;m++)m==n?g[n]["selected"]=!g[n]["selected"]:g[m]["selected"]=!1;o.setData({selected_coupon_id:r,selected_coupon_name:c,selected_coupon_content:s,selected_coupon_footer:d,selected_coupon_starttime:u,selected_coupon_endtime:i,selected_coupon_type:_,selected_coupon_amount:l,selected_coupon_index:n,selected_couponimage:p,coupons_list:g}),1==a?o.setData({coupons_quan_list:g,selected_coupon_quan_index:n,selected_coupon_quan_amount:l}):2==a&&o.setData({coupons_red_list:g,selected_coupon_red_index:n,selected_coupon_red_amount:l}),console.log(e("bindSelectCoupon coupon_type:",a," index:",o.selected_coupon_quan_index," red index:",o.selected_coupon_red_index," at pages\\order\\checkout\\checkout.vue:744"))},getMoreOrdersTapTag:function(e){var t=this,o=t.coupon_type?t.coupon_type:1,a=1==o?t.page+1:t.page,n=2==o?t.page_red+1:t.page_red;t.pagesize,t.all_rows;a>t.page_num&&1==o?wx.showToast({title:"没有更多了~",icon:"none",duration:1500}):n>t.page_red_num&&2==o?wx.showToast({title:"没有更多了~",icon:"none",duration:1500}):(t.setData({page:a,page_red:n}),t.query_coupon())},query_coupon:function(){var t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",c=(wx.getStorageSync("openid")&&wx.getStorageSync("openid"),t.page),s=t.page_red,d=t.pagesize,u=(t.all_rows,t.page_num),i=t.page_red_num,_=t.shop_type,l="avaliable",p=t.couponType;console.log(e("query_coupon coupons_type:",p," at pages\\order\\checkout\\checkout.vue:790")),t.setData({coupons_list:{}}),wx.request({url:r+"/api/client/query_coupon",method:"POST",data:{username:o,access_token:a,page:c,pagesize:d,shop_type:_,coupons_status:l,quan_type:p},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(e("查询优惠券:",o.data.result," at pages\\order\\checkout\\checkout.vue:817"));var a=o.data.result,r=o.data.all_rows;if(o.data.result){for(var _=0;_<a.length;_++)a[_]["start_time"]=n.getDateStr(1e3*a[_]["start_time"],0),a[_]["end_time"]=n.getDateStr(1e3*a[_]["end_time"],0),a[_]["selected"]=!1;c>1&&1==p&&a?a=t.coupons_quan_list.concat(a):s>1&&2==p&&a&&(a=t.coupons_red_list.concat(a)),1==p?(u=r/d+.5,t.setData({coupons_list:a,coupons_quan_list:a,page_num:u.toFixed(0),page_red_num:0})):2==p&&(i=r/d+.5,t.setData({coupons_list:a,coupons_red_list:a,page_red_num:i.toFixed(0),page_num:0}))}else wx.showToast({title:o.data.info?o.data.info:"暂无优惠券~",icon:"none",duration:2e3}),1==c&&1==p?t.setData({coupons_quan_list:{},page_num:0}):1==s&&2==p&&t.setData({coupons_red_list:{},page_red_num:0});console.log(e("query_coupon coupons_list:",a,"red:",t.coupons_red_list,"quan:",t.coupons_quan_list," at pages\\order\\checkout\\checkout.vue:872"))}})},coupon_pay:function(t){var o=this,a=o.couponType,n=o.amount,r=o.order_num,c=o.payamount,s=o.selectedAllStatus,d=o.selectedRedAllStatus,u=s?o.selected_coupon_id:0,i=s?o.selected_coupon_type:0,_=s?parseFloat(o.selected_coupon_amount):0,l=(d&&o.selected_coupon_red_id,d&&o.selected_coupon_red_type,d?parseFloat(o.selected_coupon_red_amount):0),p=o.carts,g=o.discountpay?o.discountpay:0;console.log(e("coupon_pay couponSelectedAmount:",_,"discountpay:",g," at pages\\order\\checkout\\checkout.vue:893"));for(var m=0;m<p.length;m++)p[m]["discount"]<100&&p[m]["discount"]>0&&1==i&&u&&(g+=(100-p[m]["discount"])*p[m]["sell_price"]*p[m]["num"]/100,g=g.toFixed(2));2==a&&(g=g+l?l:0,g=g.toFixed(2)),c=(n*r-g).toFixed(2),o.setData({discountpay:g,payamount:c}),g-l==0&&s&&1==a&&(o.modalBindcancelCoupon(),wx.showToast({title:"该商品无法使用优惠券",icon:"none",duration:1e3}))},bindPickerChange:function(e){this.setData({addressIndex:e.detail.value})},bindCreateNew:function(){var e=this.addressList;0==e.length&&wx.navigateTo({url:"../../address/add/add?username="+this.username})},modalBindaconfirmCoupon:function(){var e=this,t=e.couponType,o=(e.selectedAllStatus,e.selected_coupon_index?e.selected_coupon_index:0),a=e.coupons_list,n=a[o]?a[o]["selected"]:0;e.setData({modalHiddenCoupon:!this.modalHiddenCoupon}),1==t?e.setData({selectedAllStatus:!!n}):2==t&&e.setData({selectedRedAllStatus:!!n}),e.coupon_pay()},modalBindcancelCoupon:function(){var e=this,t=e.couponType,o=(e.payamount,e.amount);e.discountpay;e.setData({modalHiddenCoupon:!e.modalHiddenCoupon,payamount:o}),1==t?e.setData({selectedAllStatus:!1}):2==t&&e.setData({selectedRedAllStatus:!1}),e.coupon_pay()},setData:function(e){var t,o,a=this,n=[];Object.keys(e).forEach(function(r){n=r.split("."),t=e[r],o=a.$data,n.forEach(function(e,r){r+1==n.length?a.$set(o,e,t):o[e]||a.$set(o,e,{}),o=o[e]})})}}};t.default=s}).call(this,o("0de9")["default"],o("6e42")["default"])},d8ed:function(e,t,o){"use strict";o.r(t);var a=o("723d"),n=o("6e77");for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);o("a884");var c=o("2877"),s=Object(c["a"])(n["default"],a["a"],a["b"],!1,null,null,null);t["default"]=s.exports}},[["13b3","common/runtime","common/vendor"]]]);