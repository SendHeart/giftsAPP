(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/mylocation/mylocation"],{"23ac":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return n}),a.d(e,"b",function(){return o})},3504:function(t,e,a){"use strict";a.r(e);var n=a("7524"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,function(){return n[t]})}(i);e["default"]=o.a},"41b4":function(t,e,a){},5856:function(t,e,a){"use strict";(function(t){a("ee7a"),a("921b");n(a("66fd"));var e=n(a("be31"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},7524:function(t,e,a){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=c(a("a34a")),i=c(a("80dc"));function c(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,n,o,i,c){try{var s=t[i](c),r=s.value}catch(l){return void a(l)}s.done?e(r):Promise.resolve(r).then(n,o)}function r(t){return function(){var e=this,a=arguments;return new Promise(function(n,o){var i=t.apply(e,a);function c(t){s(i,n,o,c,r,"next",t)}function r(t){s(i,n,o,c,r,"throw",t)}c(void 0)})}}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d,u=a("3936"),g=(u.formatLocation,function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"dcc0"))}),m=a("ef60"),y=getApp().globalData.weburl,p=getApp().globalData.shop_type,v=getApp().globalData.mapkey,f=(wx.getStorageSync("current_activity_info")&&wx.getStorageSync("current_activity_info"),getApp().globalData.shop_id),w=(p=getApp().globalData.shop_type,wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[]),_=(new Date).getTime(),S={data:function(){var t;return t={is_myself:9,qqmapkey:v,addressIndex:[],prov:[],city:[],area:[],town:[],curIndex:0,shop_type:p,page:1,pagesize:10,all_rows:0,page_num:0,shop_id:f},l(t,"shop_type",p),l(t,"navList2",w),l(t,"currenttime",_?parseInt(_/1e3):0),l(t,"modalHidden",!0),l(t,"gotoHidden",!1),l(t,"lat",""),l(t,"lng",""),l(t,"activity_name",""),l(t,"activity_image",""),l(t,"activity_headimg",""),l(t,"activity_id",""),l(t,"addressObjects",""),l(t,"selected_activity_id",""),l(t,"windowHeight",""),l(t,"windowWidth",""),l(t,"dkheight",""),l(t,"address",""),l(t,"latitude",""),l(t,"longitude",""),t},components:{uniPopup:g},props:{},onLoad:function(e){var a=this,n=(wx.getStorageSync("username")&&wx.getStorageSync("username"),wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("m_id")&&wx.getStorageSync("m_id"),wx.getStorageSync("city"),e.username&&e.username,e.activity_id?e.activity_id:""),o=e.activity?e.activity:"";n=n||o,a.setData({activity_id:n}),a.getLocation(),a.loadData(),n>0?wx.showModal({title:"",content:"我要去？",success:function(t){t.confirm?a.setData({is_myself:n?0:1}):a.goBack()}}):a.setData({is_myself:n?0:1}),console.log(t("onload mylocation shared address id:",e.activity_id,"refer username:",e.username," at pages\\member\\mylocation\\mylocation.vue:169"))},onShow:function(){var t=this,e=wx.getStorageSync("username")?wx.getStorageSync("username"):"";wx.getStorageSync("token")&&wx.getStorageSync("token");wx.getSystemInfo({success:function(e){t.setData({windowHeight:e.windowHeight,windowWidth:e.windowWidth,dkheight:e.windowHeight-60})}}),e||wx.switchTab({url:"/pages/my/index"}),t.getLocation()},onShareAppMessage:function(e){var a=this,n=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=(wx.getStorageSync("userInfo")&&wx.getStorageSync("userInfo"),a.activity_name),i=a.activity_image,c=a.activity_id;i||(i=a.addressObjects[0]["img"]),o||(o=a.addressObjects[0]["name"]),c||(c=a.addressObjects[0]["id"]);var s={title:o,desc:"活动位置",path:"/pages/member/mylocation/mylocation?username="+n+"&activity_id="+c,imageUrl:i,success:function(e){console.log(t(e," at pages\\member\\mylocation\\mylocation.vue:227")),e.errMsg},fail:function(e){console.log(t(e," at pages\\member\\mylocation\\mylocation.vue:234")),"shareAppMessage:fail cancel"==e.errMsg||e.errMsg},complete:function(){}};return"button"===e.from&&(console.log(t("活动位置分享:"," at pages\\member\\mylocation\\mylocation.vue:250")),console.log(t(s," at pages\\member\\mylocation\\mylocation.vue:251"))),s},methods:{getLocation:function(){var t=r(o.default.mark(function t(){var e;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.checkPermission();case 2:if(e=t.sent,1===e){t.next=5;break}return t.abrupt("return");case 5:that.location();case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getSetting:function(){return new Promise(function(t,e){n.getSetting({success:function(e){void 0!==e.authSetting["scope.userLocation"]?e.authSetting["scope.userLocation"]?t(1):t(2):t(0)}})})},openSetting:function(){var t=this;this.hideConfirm(),n.openSetting({success:function(e){e.authSetting&&e.authSetting["scope.userLocation"]&&t.doGetLocation()},fail:function(t){}})},checkPermission:function(){var t=r(o.default.mark(function t(){var e;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!i.default.isIOS){t.next=6;break}return t.next=3,i.default.requestIOS("location");case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,i.default.requestAndroid("android.permission.ACCESS_FINE_LOCATION");case 8:t.t0=t.sent;case 9:return e=t.t0,null===e||1===e?e=1:2===e?n.showModal({content:"系统定位已关闭",confirmText:"设置",success:function(t){t.confirm&&i.default.gotoiOSSetting()}}):e.code?n.showModal({content:e.message}):n.showModal({content:"需要定位权限",confirmText:"设置",success:function(t){t.confirm&&i.default.gotoAppSetting()}}),t.abrupt("return",e);case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),clear:function(){this.hasLocation=!1},addActivity:function(){wx.navigateTo({url:"/pages/address/add/add"})},gotoMap:function(e){var a=this,n=(wx.getStorageSync("username")&&wx.getStorageSync("username"),wx.getStorageSync("token")&&wx.getStorageSync("token"),e.currentTarget.dataset.address),o=(e.currentTarget.dataset.addrname,e.currentTarget.dataset.activityindex?e.currentTarget.dataset.activityindex:0),i=a.addressObjects[o]["name"],c=a.addressObjects[o]["id"],s=a.addressObjects[o]["m_id"],r=a.qqmapkey;d=new m({key:r}),d.geocoder({address:n,success:function(e){a.setData({lat:e.result.location.lat,lng:e.result.location.lng}),console.log(t("mylocation gotoMap:",e," at pages\\member\\mylocation\\mylocation.vue:368")),wx.navigateTo({url:"/pages/member/map/map?lat="+a.lat+"&lng="+a.lng+"&title="+i+"&activity_address="+n+"&activity_id="+c+"&activity_omid="+s})},fail:function(e){console.log(t(e," at pages\\member\\mylocation\\mylocation.vue:381"))},complete:function(e){console.log(t(e," at pages\\member\\mylocation\\mylocation.vue:384"))}})},image_save:function(e,a){wx.downloadFile({url:e,success:function(e){if(200===e.statusCode){console.log(t("图片下载成功"+e.tempFilePath," at pages\\member\\mylocation\\mylocation.vue:436"));var n=wx.getFileSystemManager();n.saveFile({tempFilePath:e.tempFilePath,success:function(e){console.log(t("image_save 图片缓存成功",e.savedFilePath," at pages\\member\\mylocation\\mylocation.vue:443")),wx.setStorageSync(a,e.savedFilePath)}})}else console.log(t("image_save 响应失败",e.statusCode," at pages\\member\\mylocation\\mylocation.vue:450"))}})},bindSelectAct:function(e){for(var a=this,n=e.currentTarget.dataset.activityindex?e.currentTarget.dataset.activityindex:0,o=e.currentTarget.dataset.activityid?e.currentTarget.dataset.activityid:0,i=(e.currentTarget.dataset.activityprov&&e.currentTarget.dataset.activityprov,e.currentTarget.dataset.activitycity&&e.currentTarget.dataset.activitycity,e.currentTarget.dataset.activityarea&&e.currentTarget.dataset.activityarea,e.currentTarget.dataset.activitytown&&e.currentTarget.dataset.activitytown,a.addressObjects),c=0;c<i.length;c++)if(c==n){i[n]["selected"]=!i[n]["selected"],wx.setStorageSync("current_activity_info",i[n]);var s=wx.getStorageSync("current_activity_info");a.setData({activity_name:s["name"],activity_image:s["img"],activity_headimg:s["activity_headimg"],activity_id:o})}else i[c]["selected"]=!1;a.setData({addressObjects:i}),console.log(t("bindSelectAct activity_id:",o," at pages\\member\\mylocation\\mylocation.vue:491")),wx.navigateTo({url:"/pages/wish/wishshare/wishshare?activity_id="+a.activity_id+"&activity_image="+a.activity_image+"&activity_name="+a.activity_name+"&activity_headimg="+a.activity_headimg})},bindDeleteAct:function(t){var e=this,a=t.currentTarget.dataset.activityid?t.currentTarget.dataset.activityid:0;e.setData({modalHidden:!e.modalHidden,selected_activity_id:a})},modalBindaconfirm:function(t){var e=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",o=e.selected_activity_id;wx.request({url:y+"/api/client/delete_activity_address",method:"POST",data:{username:a,address_id:o,access_token:n},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){e.loadData(),e.setData({modalHidden:!e.modalHidden})}})},modalBindcancel:function(){var t=this;t.setData({modalHidden:!t.modalHidden})},goBack:function(){var e=getCurrentPages();console.log(t("details goBack pages:",e," at pages\\member\\mylocation\\mylocation.vue:541")),e.length>1?wx.navigateBack({changed:!0}):(getApp().globalData.from_page="/pages/member/mylocation/mylocation",getApp().globalData.hall_gotop=1,wx.switchTab({url:"/pages/hall/hall"}))},getMore:function(t){var e=this,a=e.page+1;e.pagesize,e.all_rows;a>e.page_num?wx.showToast({title:"没有更多记录了",icon:"loading",duration:1e3}):(e.setData({page:a}),e.loadData())},setDefault:function(e){for(var a=this,n=a.username,o=a.token,i=parseInt(e.currentTarget.dataset.index),c=a.addressObjects,s=0;s<c.length;s++)c[s]["is_default"]=s==i?1:0;a.setData({addressObjects:c}),wx.request({url:y+"/api/client/update_activity_address",method:"POST",data:{username:n,id:c[i]["id"],access_token:o,full_name:c[i]["full_name"],prov:c[i]["prov"],city:c[i]["city"],area:c[i]["area"],town:c[i]["town"],address:c[i]["address"],tel:c[i]["tel"],is_default:c[i]["is_default"]},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(t(e.data.result," at pages\\member\\mylocation\\mylocation.vue:618")),wx.showToast({title:"设置成功",icon:"success",duration:2e3})}})},loadData:function(){var e=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",o=e.addressObjects,i=e.activity_id,c=e.is_myself,s=e.page,r=e.pagesize,l=e.page_num,d=e.shop_type;wx.request({url:y+"/api/client/get_activity_address",method:"POST",data:{username:a,token:n,page:s,pagesize:r,shop_type:d,address_id:1==c?0:i},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){console.log(t("get_activity_address:",a.data.result,a.data.all_rows," at pages\\member\\mylocation\\mylocation.vue:657"));var n=a.data.result,i=a.data.all_rows;if(n){for(var c=0;c<n.length;c++)n[c]["selected"]=!1;s>1&&(n=o.concat(n)),l=i/r+.5,e.setData({addressObjects:n,all_rows:i,page_num:l.toFixed(0)})}0==a.data.all_rows&&wx.setStorageSync("city","")}})},location:function(){var t=this;t.get_mylocation()},get_mylocation:function(){var e=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",o=(e.refer_username,e.activity_id),i=e.shop_type,c=wx.getStorageSync("city"),s=(wx.getStorageSync("district"),wx.getStorageSync("province"),e.prov),r=e.city,l=e.area,u=e.qqmapkey;console.log(t("location cur_city:",c," at pages\\member\\mylocation\\mylocation.vue:706")),d=new m({key:u}),wx.getLocation({type:"gcj02",success:function(c){console.log(t("mylocation wx.getLocation:",c," at pages\\member\\mylocation\\mylocation.vue:716"));var u=c.latitude,g=c.longitude,m=c.speed,p=c.accuracy;wx.setStorageSync("latitude",u),wx.setStorageSync("longitude",g),wx.setStorageSync("speed",m),wx.setStorageSync("accuracy",p),d.reverseGeocoder({poi_options:"policy=2",get_poi:1,success:function(c){console.log(t("qqmapsdk:",c," at pages\\member\\mylocation\\mylocation.vue:729")),e.setData({address:c.result.address}),wx.setStorageSync("mylocation",c.result.address),wx.setStorageSync("city",c.result.address_component.city),wx.setStorageSync("district",c.result.address_component.district),wx.setStorageSync("province",c.result.address_component.province),wx.setStorageSync("street",c.result.address_component.street),wx.setStorageSync("street_number",c.result.address_component.street_number),console.log(t("位置获取成功:"+c.result.address," at pages\\member\\mylocation\\mylocation.vue:739")),s.push(c.result.address_component.province),r.push(c.result.address_component.city),l.push(c.result.address_component.district),e.setData({prov:s,city:r,area:l,latitude:u,longitude:g}),e.is_myself||wx.request({url:y+"/api/client/update_activity_addr_member",method:"POST",data:{username:a,access_token:n,activity_id:o,shop_type:i,latitude:u||e.latitude,longitude:g||e.longitude},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(t("mlocation onload update_activity_addr_member:",e," at pages\\member\\mylocation\\mylocation.vue:768"))}})},fail:function(e){console.log(t("mylocation get_mylocation()位置获取失败",e," at pages\\member\\mylocation\\mylocation.vue:774"))},complete:function(e){console.log(t("mylocation get_mylocation()位置获取完成",e," at pages\\member\\mylocation\\mylocation.vue:777"))}})}})},setData:function(t){var e,a,n=this,o=[];Object.keys(t).forEach(function(i){o=i.split("."),e=t[i],a=n.$data,o.forEach(function(t,i){i+1==o.length?n.$set(a,t,e):a[t]||n.$set(a,t,{}),a=a[t]})})}}};e.default=S}).call(this,a("0de9")["default"],a("6e42")["default"])},"8f8e":function(t,e,a){"use strict";var n=a("41b4"),o=a.n(n);o.a},be31:function(t,e,a){"use strict";a.r(e);var n=a("23ac"),o=a("3504");for(var i in o)"default"!==i&&function(t){a.d(e,t,function(){return o[t]})}(i);a("8f8e");var c=a("2877"),s=Object(c["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=s.exports}},[["5856","common/runtime","common/vendor"]]]);