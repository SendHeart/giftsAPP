(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/task/task"],{"2bbc":function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a("3936"),o=getApp().globalData.weburl,r=getApp().globalData.miniprogram_id,i=getApp().globalData.shop_type,g=(new Date).getTime(),c=1,l=e.getStorageSync("username")?e.getStorageSync("username"):"",u=e.getStorageSync("token")?e.getStorageSync("token"):"1",d=(e.getStorageSync("openid")&&e.getStorageSync("openid"),e.getStorageSync("userInfo")?e.getStorageSync("userInfo"):""),m=[{id:"activity_banner",title:"感恩节活动",value:"",img:"/uploads/activity_info/activity_banner.gif"},{id:"activity_footer",title:"活动说明",value:"",img:"/uploads/activity_info/activity_footer.png"}],p=(m=e.getStorageSync("navList2")?e.getStorageSync("navList2"):[{}],g=(new Date).getTime(),{data:function(){return{currenttime:g?parseInt(g):0,new_task_image:o+"/uploads/new_task_share.png",miniprogram_id:r,hidden:!0,windowWidth:0,windowHeight:0,winHeight:300,nickname:d.nickname,avatarUrl:d.avatarUrl,shop_type:i,navList2:m,page:1,pagesize:10,status:0,all_rows:0,page_num:0,message:{},messageHidden:!0,refer_list:"",hall_banner:m?m[8]:"",gifts_list:"",loadingHidden:!1,qr_type:"",startX:"",itemLefts:[],task_list:"",msg_id:"",coupons_info:"",goods_id:"",act_id:"",page_type:"",order_no:"",coupons:"",receive:"",task:"",task_image:"",userInfo:"",dkheight:"",username:"",scrollTop:"",title_logo:"",send_status:0,indicatorDots:!0,vertical:!1,autoplay:!0,interval:3e3,duration:1e3,circular:!0}},components:{},props:{},onLoad:function(t){var a=this,s=(e.getStorageSync("token")&&e.getStorageSync("token"),e.getStorageSync("username")),o=(s=e.getStorageSync("username"),t.page_type?t.page_type:""),r=t.order_no?t.order_no:"",i=t.act_id?t.act_id:"",g=t.coupons?t.coupons:"",c=t.receive?t.receive:"",l=t.task?t.task:0,u=t.msg_id?t.msg_id:0,d=t.image?t.image:"";decodeURIComponent(t.scene);a.get_project_gift_para(),a.setData({act_id:i,page_type:o,order_no:r,coupons:g,receive:c,task:l,msg_id:u,task_image:d||a.new_task_image}),console.log(n("activity page_type:",o," order_no:",r," receive:",c," act_id:",i," hall_banner:",a.hall_banner," at pages\\member\\task\\task.vue:188")),s?2==o&&1==c&&wx.navigateTo({url:"../order/receive/receive?order_no="+r+"&receive=1"}):wx.switchTab({url:"/pages/my/index"}),a.get_member_messages(),e.getSystemInfo({success:function(e){var t=e.windowHeight;console.log(n("getSystemInfo:",t," at pages\\member\\task\\task.vue:213")),a.setData({dkheight:t})}})},onShow:function(){var t=this,a=(e.getStorageSync("token")&&e.getStorageSync("token"),e.getStorageSync("username"),getCurrentPages());a.length>1&&t.setData({title_logo:"../../images/back.png"})},methods:{shareAction:function(){var t=this;e.showActionSheet({itemList:["微信朋友圈","微信小程序"],success:function(e){switch(console.log(n(e.tapIndex," at pages\\member\\task\\task.vue:239")),e.tapIndex){case 0:t.shareToWXSenceTimeline();break;case 1:t.shareToWXminiProgram();break;default:break}}})},shareToWXSenceTimeline:function(){var t=this,a=t.nickname,s=(t.msg_id,0==t.navList2.length?t.new_task_image:t.navList2[9]["img"]),o="好友"+a+"邀请你一起参与送心礼物任务~";t.currenttime;e.share({provider:"weixin",type:2,title:o,scene:"WXSenceTimeline",imageUrl:s,success:function(e){console.log(n(e," at pages\\member\\task\\task.vue:271"))},fail:function(t){console.log(n(t," at pages\\member\\task\\task.vue:280"));var a=t.errMsg;"客户端未安装"==a.share.fail?e.showModal({title:"分享失败",content:"微信客户端未安装"}):e.showModal({title:"分享失败",content:a.share.fail})}})},shareToWXminiProgram:function(){var t=this,a=(t.share_goods_name&&t.share_goods_name,t.share_goods_image&&t.share_goods_image,t.share_goods_id&&t.share_goods_id,wx.getStorageSync("username")?wx.getStorageSync("username"):""),s=t.miniprogram_id,o=t.currenttime,r=t.nickname,i=1,g=t.msg_id,c=0==t.navList2.length?t.new_task_image:t.navList2[9]["img"],l="/pages/hall/hall?task="+i+"&msg_id="+g+"&refername="+a+"&sharetime="+o,u="好友"+r+"邀请你一起参与送心礼物任务~";e.share({provider:"weixin",type:5,title:u,imageUrl:c,miniProgram:{id:s,path:l,type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(n(e," at pages\\member\\task\\task.vue:323"))},fail:function(t){console.log(n(t," at pages\\member\\task\\task.vue:332")),e.showModal({title:"分享失败",content:"error:"+JSON.stringify(t)})}})},onShareApp:function(t){var a=this,s=(e.getStorageSync("username")&&e.getStorageSync("username"),e.getStorageSync("token")&&e.getStorageSync("token"),e.getStorageSync("userInfo")&&e.getStorageSync("userInfo"),a.nickname,1),o=a.msg_id;a.currenttime,0==a.navList2.length?a.new_task_image:a.navList2[9]["img"];console.log(n("开始分享送礼任务",t," task:",s," msg_id",o," at pages\\member\\task\\task.vue:353"))},messageConfirm:function(){var e=this,t=e.messageHidden;e.setData({messageHidden:!t})},refer_detail:function(e){var t=this,a=t.messageHidden,o=e.currentTarget.dataset.referList;if(console.log(n("refer_detail refer list:",o," at pages\\member\\task\\task.vue:404")),o){for(var r=0;r<o.length;r++)o[r]["time"]=s.getDateStr(1e3*o[r]["time"],0);t.setData({refer_list:o,messageHidden:!a}),console.log(n("refer_detail message:",t.refer_list," at pages\\member\\task\\task.vue:415"))}},goBack:function(){var e=getCurrentPages();e.length,wx.switchTab({url:"/pages/hall/hall"})},get_project_gift_para:function(){var t=this,a=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[{}],s=t.shop_type,r=t.hall_banner,i=[];console.log(n("task get_project_gift_para navList2:",a," at pages\\member\\task\\task.vue:437")),0==a.length?wx.request({url:o+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(s){a=s.data.result,console.log(n("get_project_gift_para navList_new:",a," at pages\\member\\task\\task.vue:455")),a&&(e.setStorageSync("navList2",a),t.setData({navList2:a,hall_banner:a[8]?a[8]:r,gifts_list:a[9]?t.gifts_list.push(a[9]):""}))}}):(i.push(a[9]),t.navList2=a,t.hall_banner=a[8]?a[8]:r,t.gifts_list=i),console.log(n("task get_project_gift_para gifts_list:",t.gifts_list," hall_banner:",t.hall_banner," at pages\\member\\task\\task.vue:477")),setTimeout(function(){t.loadingHidden=!0},1500)},bannerTapTag:function(e){var t=e.link,a=t.split("/");if(console.log(n("bannerTapTag:",a," at pages\\member\\task\\task.vue:486")),"hall"==a[2]||"wish"==a[2]||"index"==a[2]||"my"==a[2]){for(var s=getCurrentPages(),o=s.length,r=0,i=0;i<o;i++)s[i].route.indexOf("hall/hall")>=0&&(r=1,i);1==r?wx.navigateBack({delta:o-i-1}):wx.switchTab({url:"/pages/hall/hall"})}else wx.navigateTo({url:t+"&username="+l+"&token="+u})},qrcodeTapTag:function(e){var t=this,a="activityshare",n=t.act_id,s=t.act_title?t.act_title:"送心活动";t.setData({qr_type:a}),wx.navigateTo({url:"../share/share?qr_type="+a+"&act_id="+n+"&act_title="+s})},showGoods:function(e){var t=e.currentTarget.dataset.objectId,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=e.currentTarget.dataset.goodsId,o=(e.currentTarget.dataset.goodsName,e.currentTarget.dataset.goodsPrice),r=e.currentTarget.dataset.goodsInfo,i=e.currentTarget.dataset.sale;wx.navigateTo({url:"../../details/details?sku_id="+t+"&id="+s+"&goods_info="+r+"&goods_price="+o+"&sale="+i+"&token="+n+"&username="+a})},touchStart:function(e){var t=e.touches[0].clientX;this.setData({startX:t,itemLefts:[]})},touchMove:function(e){var t=e.currentTarget.dataset.index,a=e.touches[0].clientX,n=this.startX-a,s=this.itemLefts;s[t]=-n,this.setData({itemLefts:s})},touchEnd:function(e){var t=e.currentTarget.dataset.index,a=e.changedTouches[0].clientX,n=this.startX-a,s=60;n=n<=0?0:n>=s?s:n>=s/2?s:0;var o=this.itemLefts;o[t]=-n,this.setData({itemLefts:o})},onGotUserInfo:function(e){console.log(n(e.detail.errMsg," at pages\\member\\task\\task.vue:591")),console.log(n(e.detail.userInfo," at pages\\member\\task\\task.vue:592")),console.log(n(e.detail.rawData," at pages\\member\\task\\task.vue:593"))},get_member_messages:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=e.shop_type;e.page,e.pagesize;wx.request({url:o+"/api/client/get_member_messages",method:"POST",data:{username:t,access_token:a,shop_type:s,message_type:6},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){var a=t.data,s=a["result"];console.log(n("task get_member_messages:",a,"messages:",s," at pages\\member\\task\\task.vue:620")),"y"==a["status"]?(e.setData({task_list:s,msg_id:s?s[1]["msg_id"]:0}),console.log(n("获取消息:",e.task_list," at pages\\member\\task\\task.vue:688"))):wx.showToast({title:"暂无消息",icon:"none",duration:1e3})}})},task_action:function(e){var t=this,a=0,n=0;t.new_task_image;0==n&&0==a&&wx.navigateTo({url:"/pages/details/details?id=7482"})},query_pubcoupon:function(e){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",i=wx.getStorageSync("openid")?wx.getStorageSync("openid"):"",g=t.shop_type,c=e.currentTarget.dataset.couponId,l=e.currentTarget.dataset.msgId;wx.request({url:o+"/api/client/query_pubcoupon",method:"POST",data:{username:a||i,access_token:r,coupons_id:c,shop_type:g},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){var a=e.data.result;if(console.log(n("task query_pubcoupon:",e.data," at pages\\member\\task\\task.vue:734")),"n"==e.data.status)wx.showToast({title:e.data.info?e.data.info:"已过期",icon:"none",duration:2e3});else{for(var o=0;o<a.length;o++)a[o]["start_time"]=s.getDateStr(1e3*a[o]["start_time"],0),a[o]["end_time"]=s.getDateStr(1e3*a[o]["end_time"],0);var r=a[0]["object_goods"].split(",");t.setData({coupons_info:a,goods_id:r[0]?r[0]:"7362",msg_id:l}),console.log(n("任务 查询红包信息 query_pubcoupon coupons_info:",a,"coupons_info.length:",a.length," at pages\\member\\task\\task.vue:755")),t.band_coupon()}}})},band_coupon:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=wx.getStorageSync("openid")?wx.getStorageSync("openid"):"",r=e.coupons_info,i=JSON.stringify(r),g=e.msg_id,c=e.goods_id;console.log(n("领取红包 band_coupon coupons_info:",r," at pages\\member\\task\\task.vue:770")),wx.request({url:o+"/api/client/band_coupon",method:"POST",data:{username:t||s,access_token:a,coupons:i,coupon_type:"receive",msg_id:g},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log(n("领取红包返回:",e.data," at pages\\member\\task\\task.vue:786"));e.data.result;e.data.result?wx.showToast({title:"领取成功",icon:"success",duration:1500}):wx.showToast({title:e.data.info?e.data.info:"已被领取",icon:"none",duration:1500}),c?wx.navigateTo({url:"/pages/details/details?id="+c}):wx.switchTab({url:"/pages/hall/hall"})}})},getMoreOrdersTapTag:function(e){var t=this,a=t.page+1;t.pagesize,t.all_rows;a>t.page_num?wx.showToast({title:"没有更多记录了",icon:"none",duration:1e3}):(t.setData({page:a}),t.get_member_messages())},bindDownLoad:function(){var e=this;e.setData({page:c++}),console.log(n("lower"," at pages\\member\\task\\task.vue:843"))},scroll:function(e){this.setData({scrollTop:e.detail.scrollTop})},topLoad:function(e){this.setData({scrollTop:0}),console.log(n("lower"," at pages\\member\\task\\task.vue:859"))},setData:function(e){var t,a,n=this,s=[];Object.keys(e).forEach(function(o){s=o.split("."),t=e[o],a=n.$data,s.forEach(function(e,o){o+1==s.length?n.$set(a,e,t):a[e]||n.$set(a,e,{}),a=a[e]})})}}});t.default=p}).call(this,a("6e42")["default"],a("0de9")["default"])},"488b":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");n(a("66fd"));var t=n(a("ddb4"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},"83a8":function(e,t,a){"use strict";a.r(t);var n=a("2bbc"),s=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);t["default"]=s.a},8683:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},s=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s})},"92a3":function(e,t,a){},b3c4:function(e,t,a){"use strict";var n=a("92a3"),s=a.n(n);s.a},ddb4:function(e,t,a){"use strict";a.r(t);var n=a("8683"),s=a("83a8");for(var o in s)"default"!==o&&function(e){a.d(t,e,function(){return s[e]})}(o);a("b3c4");var r=a("2877"),i=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=i.exports}},[["488b","common/runtime","common/vendor"]]]);