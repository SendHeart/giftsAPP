(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/couponmy/couponmy"],{"0c93":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=getApp().globalData.weburl,n=getApp().globalData.shop_type,r=a("3936"),s=(new Date).getTime(),c=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[],u=[{id:"avaliable",title:"未使用"},{id:"used",title:"已使用"},{id:"overdue",title:"已过期"}],i={data:function(){return{title_name:"收到优惠券",title_logo:"../../../images/footer-icon-05.png",coupon_img:o+"/uploads/coupon_bg.png",coupon_footer:"",coupon_content:"",shop_type:n,navList_order:u,tab2:"avaliable",activeIndex2:0,TabCur:0,scrollLeft:0,orders:[],orderskus:[],openid:null,userInfo:{},page:1,pagesize:10,status:0,all_rows:0,page_num:0,giftflag:0,scrollTop:0,scrollHeight:0,indicatorDots:!0,vertical:!1,autoplay:!0,interval:3e3,duration:2e3,note_title:"Hi~:",note:"",headimg:"",nickname:"",receive_status:0,receive:0,order_no:"",currenttime:s?parseInt(s/1e3):0,startBarHeight:"",navgationHeight:"",coupons_list:[],navList2:"",loadingHidden:!1,coupons_type:0}},components:{},props:{},onLoad:function(t){var a=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=(wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("openid")&&wx.getStorageSync("openid"),t.red?t.red:0);console.log(e("查询我的优惠券 username:",o," at pages\\member\\couponmy\\couponmy.vue:121")),o?(n>0&&(wx.setNavigationBarTitle({title:"送心红包"}),a.setData({coupons_type:2})),a.query_coupon()):wx.navigateTo({url:"/pages/login/login?frompage=/pages/member/couponmy/couponmy"})},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"../../../images/back.png"})},onShareAppMessage:function(t){var a,o=this,n=(o.order_no,o.username,o.token,o.coupons_type);console.log(e("开始分享优惠券"," at pages\\member\\couponmy\\couponmy.vue:176")),console.log(e(t," at pages\\member\\couponmy\\couponmy.vue:177"));var r={title:1==n?"送心优惠券":"送心红包",path:"/pages/hall/hall",imgUrl:"",success:function(t){console.log(e(t," at pages\\member\\couponmy\\couponmy.vue:186")),t.errMsg},fail:function(){console.log(e(a," at pages\\member\\couponmy\\couponmy.vue:192")),"shareAppMessage:fail cancel"==a.errMsg||a.errMsg},complete:function(){}};return t.from,r},methods:{tabSelect:function(e){this.TabCur=e.currentTarget.dataset.id,this.scrollLeft=60*(e.currentTarget.dataset.id-1)},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},onOrderTapTag:function(t){this.TabCur=t.currentTarget.dataset.id,this.scrollLeft=60*(t.currentTarget.dataset.id-1);var a=t.currentTarget.dataset.tab,o=this,n=(a=t.currentTarget.dataset.id,t.currentTarget.dataset.index),r=o.giftflag;o.coupons_list;"avaliable"==a?r=0:"used"==a?r=1:"overdue"==a&&(r=2),o.setData({activeIndex2:n,tab2:a,page:1,page_num:1,giftflag:r,coupons_list:[]}),console.log(e("tab:"+a," giftflag:",r," at pages\\member\\couponmy\\couponmy.vue:256")),o.query_coupon()},returnTapTag:function(e){wx.switchTab({url:"../../hall/hall"})},couponTapTag:function(e){wx.navigateTo({url:"../../list/list"})},scroll:function(e){this.setData({scrollTop:e.detail.scrollTop})},topLoad:function(t){this.setData({scrollTop:0}),console.log(e("lower"," at pages\\member\\couponmy\\couponmy.vue:283"))},getMoreOrdersTapTag:function(e){var t=this,a=t.page+1;t.pagesize,t.all_rows;a>t.page_num?wx.showToast({title:"没有更多记录了",icon:"none",duration:1e3}):(t.setData({page:a}),t.query_coupon())},get_project_gift_para:function(){var t=this,a=t.navList2,n=t.shop_type;t.page,t.pagesize;console.log(e("couponmy get_project_gift_para navList2:",c," at pages\\member\\couponmy\\couponmy.vue:311")),a||wx.request({url:o+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:n},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("get_project_gift_para:",t.data.result," at pages\\member\\couponmy\\couponmy.vue:328")),a=t.data.result}}),t.setData({navList2:a}),setTimeout(function(){t.setData({loadingHidden:!0})},1500)},query_coupon:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=(wx.getStorageSync("openid")&&wx.getStorageSync("openid"),t.tab2),c=t.page,u=t.pagesize,i=t.all_rows,l=t.page_num,p=t.shop_type,g=t.coupons_type?t.coupons_type:1;wx.request({url:o+"/api/client/query_coupon",method:"POST",data:{username:a,access_token:n,page:c,pagesize:u,shop_type:p,coupons_status:s,quan_type:g},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){console.log(e("查询优惠券:",a.data.result," at pages\\member\\couponmy\\couponmy.vue:385"));var o=a.data.result;if(a.data.result){i=a.data.all_rows;for(var n=0;n<o.length;n++)o[n]["start_time"]=r.getDateStr(1e3*o[n]["start_time"],0),o[n]["end_time"]=r.getDateStr(1e3*o[n]["end_time"],0);c>1&&o&&(o=t.coupons_list.concat(o)),l=i/u+.5,t.setData({coupons_list:o,page_num:l.toFixed(0)})}else wx.showToast({title:a.data.info?a.data.info:1==g?"暂无优惠券":"暂无红包",icon:"none",duration:1500}),1==c&&t.setData({coupons_list:{},all_rows:0,page_num:0})}})},setData:function(e){var t,a,o=this,n=[];Object.keys(e).forEach(function(r){n=r.split("."),t=e[r],a=o.$data,n.forEach(function(e,r){r+1==n.length?o.$set(a,e,t):a[e]||o.$set(a,e,{}),a=a[e]})})}}};t.default=i}).call(this,a("0de9")["default"])},"19c4":function(e,t,a){"use strict";a.r(t);var o=a("0c93"),n=a.n(o);for(var r in o)"default"!==r&&function(e){a.d(t,e,function(){return o[e]})}(r);t["default"]=n.a},"3a05":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},n=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return n})},"50eb":function(e,t,a){"use strict";a.r(t);var o=a("3a05"),n=a("19c4");for(var r in n)"default"!==r&&function(e){a.d(t,e,function(){return n[e]})}(r);a("d7db");var s=a("2877"),c=Object(s["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=c.exports},"524a":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");o(a("66fd"));var t=o(a("50eb"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},"78b5":function(e,t,a){},d7db:function(e,t,a){"use strict";var o=a("78b5"),n=a.n(o);n.a}},[["524a","common/runtime","common/vendor"]]]);