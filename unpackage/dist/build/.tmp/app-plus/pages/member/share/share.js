(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/share/share"],{1301:function(e,t,a){},2787:function(e,t,a){"use strict";a.r(t);var o=a("c0a5"),n=a.n(o);for(var s in o)"default"!==s&&function(e){a.d(t,e,function(){return o[e]})}(s);t["default"]=n.a},"428b":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");o(a("66fd"));var t=o(a("b132"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},"98e5":function(e,t,a){"use strict";var o=a("1301"),n=a.n(o);n.a},b132:function(e,t,a){"use strict";a.r(t);var o=a("f96f"),n=a("2787");for(var s in n)"default"!==s&&function(e){a.d(t,e,function(){return n[e]})}(s);a("98e5");var r=a("2877"),i=Object(r["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=i.exports},c0a5:function(e,t,a){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a("3936");var n=getApp().globalData.weburl,s=getApp().globalData.shop_type,r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",i=(wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("openid")?wx.getStorageSync("openid"):""),c=(wx.getStorageSync("userInfo")&&wx.getStorageSync("userInfo"),getApp().globalData.appid),p=getApp().globalData.secret,u=(wx.getStorageSync("userInfo")&&wx.getStorageSync("userInfo"),wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[]),h=function(){return a.e("common/canvasdrawer/canvasdrawer").then(a.bind(null,"0d30"))},d={data:function(){return{title_name:"二维码",title_logo:"/static/images/footer-icon-05.png",weburl:n,appid:c,secret:p,openid:i,shop_type:s,hiddenqrcode:!0,coupon_img:n+"/uploads/coupon_bg.jpg",wechat_share:"",navList2:u,qr_type:"",share_qrcode:"",painting:{},share_qrcode_image:"",username:"",act_id:"",act_title:"",coupons:"",coupons_json:"",coupons_name:"",coupons_id:"",coupons_type:"",coupons_flag:"",share_activity_qrcode_cache:"",share_coupon_qrcode_cache:"",share_member_qrcode_cache:"",windowHeight:"",windowWidth:"",dkheight:"",loadingHidden:!1}},components:{canvasdrawer:h},props:{},onLoad:function(t){var a=this;console.log(e("share options:",t," at pages\\member\\share\\share.vue:92"));var o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=(wx.getStorageSync("m_id")&&wx.getStorageSync("m_id"),a.hiddenqrcode,a.appid),i=a.secret,c=t.qr_type?t.qr_type:"",p=t.act_id?t.act_id:"",u=t.act_title?t.act_title:"",h=t.coupons?t.coupons:"";console.log(e("share coupons_json:",h," at pages\\member\\share\\share.vue:102"));var d=h?JSON.parse(h):[{}],g=h?d["name"]:"",l=h?d["id"]:0,_=h?d["type"]:1,m=h?d["flag"]:0,w=n+"/api/WXPay/getQRCode?username="+o+"&appid="+r+"&secret="+i+"&shop_type="+s+"&qr_type="+c+"&coupons_flag="+m+"&coupons_type="+_+"&coupons_id="+l+"&coupons="+h,f=n+"/api/WXPay/getQRCode?username="+o+"&appid="+r+"&secret="+i+"&shop_type="+s+"&qr_type="+c+"&act_id="+p;a.setData({username:o,appid:r,secret:i,qr_type:c,act_id:p,act_title:u,coupons:d,coupons_json:h,hiddenqrcode:!0,coupons_name:g,coupons_id:l,coupons_type:_,coupons_flag:m,share_activity_qrcode_cache:f,share_coupon_qrcode_cache:w,share_member_qrcode_cache:f,isSaveImageToPhotosAlbum:!1}),wx.getSystemInfo({success:function(e){"iPhone X"==e.model&&(startBarHeight=44),a.setData({windowHeight:e.windowHeight,windowWidth:e.windowWidth,dkheight:e.windowHeight-10})}}),a.get_project_gift_para(),wx.showLoading({title:"开始生成分享码"}),setTimeout(function(){a.setData({loadingHidden:!0}),a.eventDraw()},2e3)},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"../../../images/back.png"})},methods:{shareToWeixin:function(t){this.isSaveImageToPhotosAlbum||this.eventSave(),o.chooseImage({count:1,sizeType:["compressed"],sourceType:["album"],success:function(a){o.share({provider:"weixin",type:2,title:"送心礼物分享",scene:t,imageUrl:a.tempFilePaths[0],success:function(t){console.log(e(t," at pages\\member\\share\\share.vue:192")),o.showToast({title:"分享成功！"})},fail:function(t){console.log(e(t," at pages\\member\\share\\share.vue:204")),o.showModal({title:"分享失败",content:"error:"+JSON.stringify(t)})}})}})},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},returnTapTag:function(e){wx.switchTab({url:"../../my/index"})},image_save:function(t,a){console.log(e("membershare imge save image url:",t,"image_cache_name:",a," at pages\\member\\share\\share.vue:235")),wx.downloadFile({url:t,success:function(t){if(200===t.statusCode)t.tempFilePath;else console.log(e("membershare image_save 响应失败",t.statusCode," at pages\\member\\share\\share.vue:243"))}})},get_project_gift_para:function(){var t=this,a=(t.page,t.pagesize,t.navList2),o=t.shop_type;console.log(e("share get_project_gift_para navList2:",u," at pages\\member\\share\\share.vue:254")),a||wx.request({url:n+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("get_project_gift_para:",t.data.result," at pages\\member\\share\\share.vue:271")),a=t.data.result}}),t.setData({navList2:a})},eventDraw:function(){for(var t=30,a=this,s=200,i=230,u=100,h=120,d=60,g=(a.wechat_share,a.shop_type),l=a.qr_type?a.qr_type:"couponshare",_=a.act_id?a.act_id:"",m=a.act_title?a.act_title:"开启礼物电商时代，200万人都在用的礼物小程序",w=a.coupons,f=a.coupons_json,v=a.coupons_id,y=a.coupons_type,b=a.coupons_flag,S=(a.coupons_name,a.share_activity_qrcode_cache?a.share_activity_qrcode_cache:n+"/api/WXPay/getQRCode?username="+r+"&appid="+c+"&secret="+p+"&shop_type="+g+"&qr_type="+l+"&coupons_flag="+b+"&coupons_type="+y+"&coupons_id="+v+"&coupons="+f+"&act_id="+_),x=a.share_coupon_qrcode_cache?a.share_coupon_qrcode_cache:n+"/api/WXPay/getQRCode?username="+r+"&appid="+c+"&secret="+p+"&shop_type="+g+"&qr_type="+l+"&coupons_flag="+b+"&coupons_type="+y+"&coupons_id="+v+"&coupons="+f,q=a.share_member_qrcode_cache?a.share_member_qrcode_cache:n+"/api/WXPay/getQRCode?username="+r+"&appid="+c+"&secret="+p+"&shop_type="+g+"&qr_type="+l,W="",P=m.length,D=0,T=0,j=0;j<P;j++)T+=m[j].match(/[^\x00-\xff]/gi)?2:1;D=T*o.upx2px(t)>a.windowWidth?a.windowWidth:T*o.upx2px(t),h=(a.windowWidth-D)/2,_?W=S:v?(W=x,h=h,s=230,i=230,u=85,d=90):"membershare"==l&&(W=q,h=h,s=230,i=230,u=85,d=90),console.log(e("member share eventDraw() title len:",m," len:",T,h,a.windowWidth," at pages\\member\\share\\share.vue:354")),a.setData({qr_type:l,share_qrcode:W}),console.log(e("扫码图片信息:",w,"qr_type:",l,"windowWidth:",a.windowWidth," windowHeight",a.windowHeight," at pages\\member\\share\\share.vue:366")),a.setData({painting:{width:400,height:350,windowHeight:a.windowHeight?a.windowHeight:400,windowWidth:a.windowWidth?a.windowWidth:200,clear:!0,background:"white",views:[{type:"text",content:m,fontSize:t,color:"#333",textAlign:"left",top:20,left:h,lineHeight:30,MaxLineNumber:2,breakWord:!0,width:a.windowWidth},{type:"image",url:W,top:d,left:u,width:s,height:i}]}}),console.log(e("二维码 paint:",a.painting," at pages\\member\\share\\share.vue:397"))},eventSave:function(){wx.saveImageToPhotosAlbum({filePath:this.share_qrcode_image,success:function(e){wx.showToast({title:"图片已保存到相册，赶紧晒一下吧~",icon:"none",duration:1500})}})},eventGetImage:function(t){console.log(e("member share eventGetImage:",t," at pages\\member\\share\\share.vue:413"));var a=t.tempFilePath,o=t.errMsg;"canvasdrawer:ok"===o&&(this.setData({share_qrcode_image:a}),wx.hideLoading())},saveImg:function(e){var t=this;wx.showModal({title:"请确认",content:"保存相册",success:function(e){e.confirm&&t.eventSave()}})},setData:function(e){var t,a,o=this,n=[];Object.keys(e).forEach(function(s){n=s.split("."),t=e[s],a=o.$data,n.forEach(function(e,s){s+1==n.length?o.$set(a,e,t):a[e]||o.$set(a,e,{}),a=a[e]})})}}};t.default=d}).call(this,a("0de9")["default"],a("6e42")["default"])},f96f:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},n=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return n})}},[["428b","common/runtime","common/vendor"]]]);