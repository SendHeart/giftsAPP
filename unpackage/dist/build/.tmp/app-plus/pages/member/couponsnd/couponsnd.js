(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/couponsnd/couponsnd"],{1500:function(e,o,n){"use strict";n.r(o);var t=n("8ca1"),a=n.n(t);for(var c in t)"default"!==c&&function(e){n.d(o,e,function(){return t[e]})}(c);o["default"]=a.a},"38ea":function(e,o,n){"use strict";(function(e){n("ee7a"),n("921b");t(n("66fd"));var o=t(n("72a0"));function t(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,n("6e42")["createPage"])},"575c":function(e,o,n){},"72a0":function(e,o,n){"use strict";n.r(o);var t=n("e2d2"),a=n("1500");for(var c in a)"default"!==c&&function(e){n.d(o,e,function(){return a[e]})}(c);n("7974");var s=n("2877"),u=Object(s["a"])(a["default"],t["a"],t["b"],!1,null,null,null);o["default"]=u.exports},7974:function(e,o,n){"use strict";var t=n("575c"),a=n.n(t);a.a},"8ca1":function(e,o,n){"use strict";(function(e,t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=n("3936"),c=getApp().globalData.weburl,s=getApp().globalData.miniprogram_id,u=getApp().globalData.shop_type,i=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=(wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("openid")&&wx.getStorageSync("openid"),wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):""),p=getApp().globalData.appid,g=getApp().globalData.secret,d=(r=wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):"",wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[]),l=function(){return n.e("common/canvasdrawer/canvasdrawer").then(n.bind(null,"0d30"))},m={data:function(){return{title_name:"优惠券送出",title_logo:"/static/images/footer-icon-05.png",coupon_img:c+"/uploads/coupon_bg.png",coupon_content:"",coupon_footer:"",wechat_share:"",shop_type:u,weburl:c,page:1,pagesize:10,status:0,all_rows:0,scrollTop:0,scrollHeight:0,indicatorDots:!0,vertical:!1,autoplay:!0,interval:3e3,duration:2e3,note_title:"Hi~:",miniprogram_id:s,headimg:r.avatarUrl,nickname:r.nickName,send_status:0,navList2:d,hiddenmodalput:!1,amount:0,nums:0,start_time:a.getDateStr(new Date,0),end_time:a.getDateStr(new Date,3),name:"",hiddenqrcode:!0,coupons_flag:"999999999999",index:0,coupon_type:"",coupon_id:"",coupon_amount:"",coupon_flag:"",coupon_share_img:"",coupons:"",share_coupon_qrcode:"",coupons_json:"",qr_type:"",loadingHidden:!1,coupons_info:"",dkheight:500,current:-1}},components:{canvasdrawer:l},props:{},onLoad:function(e){wx.getStorageSync("username")&&wx.getStorageSync("username"),wx.getStorageSync("token")&&wx.getStorageSync("token")},onShow:function(){var o=this;e.getSystemInfo({success:function(e){o.winHeight=e.windowHeight,o.windowWidth=e.windowWidth,o.dkheight=o.windowWidth-.05*o.windowWidth-120}}),o.query_pubcoupon()},methods:{shareToWXminiProgram:function(){var o=this,n=o.miniprogram_id,a=o.coupons_info,c=(wx.getStorageSync("username")&&wx.getStorageSync("username"),o.nickname&&o.nickname,1==o.coupon_type?"收到一张"+o.name+"~":"收到一个"+o.name+"~"),s=o.coupon_share_img,u=o.coupon_type?o.coupon_type:1,i=o.coupon_id?o.coupon_id:0,r=o.coupon_flag?o.coupon_flag:9;a?e.share({provider:"weixin",type:5,title:c,imageUrl:s||"",miniProgram:{id:n,path:"/pages/member/couponrcv/couponrcv?coupons_flag="+r+"&coupons_id="+i+"&coupons_type="+u+"&receive=1",type:0,webUrl:"http://uniapp.dcloud.io"},success:function(e){console.log(t(e," at pages\\member\\couponsnd\\couponsnd.vue:203"))},fail:function(o){console.log(t(o," at pages\\member\\couponsnd\\couponsnd.vue:212")),e.showModal({title:"分享失败",content:"error:"+JSON.stringify(o)})}}):console.log(t("优惠券为空"," at pages\\member\\couponsnd\\couponsnd.vue:187"))},image_save:function(e,o){var n=this;console.log(t("couponsnd imge save image url:",e,"image_cache_name:",o," at pages\\member\\couponsnd\\couponsnd.vue:223")),wx.downloadFile({url:e,success:function(e){if(200===e.statusCode){var a=e.tempFilePath,c=wx.getFileSystemManager();c.saveFile({tempFilePath:e.tempFilePath,success:function(e){console.log(t("couponsnd image_save 优惠券分享图片缓存成功",o,e.savedFilePath," at pages\\member\\couponsnd\\couponsnd.vue:236")),wx.setStorageSync(o,e.savedFilePath)},fail:function(e){console.log(t(" couponsnd image_save 优惠券图片缓存失败",o,e," at pages\\member\\couponsnd\\couponsnd.vue:241"));var s=wx.getStorageSync("wx_headimg_cache");wx.getStorageSync("coupon_qrcode_cache_"+n.coupon_id);c.getSavedFileList({success:function(e){console.log(t("couponsnd getSavedFileList 缓存文件列表",e," at pages\\member\\couponsnd\\couponsnd.vue:246"));for(var n=0;n<e.fileList.length;n++)e.fileList[n]["filePath"]!=s&&e.fileList[n]["filePath"]!=activity_qrcode_cache&&c.removeSavedFile({filePath:e.fileList[n]["filePath"],success:function(e){console.log(t("couponsnd image_save 缓存清除成功",e," at pages\\member\\couponsnd\\couponsnd.vue:254"))},fail:function(e){console.log(t("couponsnd image_save 缓存清除失败",e," at pages\\member\\couponsnd\\couponsnd.vue:258"))}});c.saveFile({tempFilePath:a,success:function(e){wx.setStorageSync(o,e.savedFilePath)}})},fail:function(e){console.log(t("couponsnd getSavedFileList 缓存文件列表查询失败",e," at pages\\member\\couponsnd\\couponsnd.vue:277"))}})}})}else console.log(t("couponsnd image_save 响应失败",e.statusCode," at pages\\member\\couponsnd\\couponsnd.vue:285"))}})},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},modalinput:function(){var e=this;e.setData({hiddenmodalput:!e.hiddenmodalput})},cancel:function(){setTimeout(function(){wx.navigateBack()},500)},confirm:function(e){for(var o=this,n=e.detail.value,a=o.coupons_info,s=o.current,r=0;r<a.length;r++)if(a[r].id===n){s=r;break}var d=a[s]["name"],l=a[s]["content"],m=a[s]["id"],_=a[s]["flag"],f=a[s]["type"],h=a[s]["amount"],v=a[s]["image"],w=a[s]["footer"],S=a[s]["start_time"],y=a[s]["end_time"],b=a[s]["share_image"],x=a[s],k=o.qr_type,T=JSON.stringify(x),D=c+"/api/WXPay/getQRCode?username="+i+"&appid="+p+"&secret="+g+"&shop_type="+u+"&qr_type="+k+"&coupons_flag="+_+"&coupons_type="+f+"&coupons_id="+m+"&coupons="+T;o.hiddenmodalput=!0,o.current=s,o.name=d,o.coupon_content=l,o.coupon_type=f,o.coupon_id=m,o.coupon_amount=h,o.coupon_flag=_,o.coupon_img=v,o.coupon_footer=w,o.start_time=S,o.end_time=y,o.coupon_share_img=b,o.coupons=x,o.share_coupon_qrcode=D,console.log(t("coupons_info:",a,"current:",s," coupons:",x," at pages\\member\\couponsnd\\couponsnd.vue:361"))},bindChangeNums:function(e){var o=this,n=e.detail.value;o.setData({nums:n}),console.log(t("nums:"+o.nums," at pages\\member\\couponsnd\\couponsnd.vue:371"))},bindChangeStartTime:function(e){var o=this,n=e.detail.value;o.setData({start_time:n}),console.log(t("start_time:"+o.start_time," at pages\\member\\couponsnd\\couponsnd.vue:379"))},bindChangeEndTime:function(e){var o=this,n=e.detail.value;o.setData({end_time:n}),console.log(t("end_time:"+o.end_time," at pages\\member\\couponsnd\\couponsnd.vue:387"))},bindChangeName:function(e){var o=this,n=e.detail.value;o.setData({name:n}),console.log(t("name:"+o.name," at pages\\member\\couponsnd\\couponsnd.vue:395"))},qrcodeTapTag:function(e){var o=this,n="couponshare",a=o.name,c=o.hiddenqrcode,s=(o.hiddenmodalput,JSON.stringify(o.coupons)),u=o.share_coupon_qrcode;console.log(t("qrcodeTapTag coupons_json:",s," share_coupon_qrcode",u," at pages\\member\\couponsnd\\couponsnd.vue:408")),o.setData({hiddenqrcode:!c,coupons_json:s,qr_type:n}),wx.navigateTo({url:"../share/share?coupons="+s+"&act_title="+a})},returnTapTag:function(e){wx.switchTab({url:"../../my/index"})},scroll:function(e){this.setData({scrollTop:e.detail.scrollTop})},topLoad:function(e){this.setData({scrollTop:0}),console.log(t("lower"," at pages\\member\\couponsnd\\couponsnd.vue:440"))},get_project_gift_para:function(){var e=this,o=e.shop_type,n=wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):"",a=(e.page,e.pagesize,e.coupon_type),s=e.coupon_img;console.log(t("couponsnd get_project_gift_para navList2:",d,"coupon_type:",a," at pages\\member\\couponsnd\\couponsnd.vue:450")),n||wx.request({url:c+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(t("get_project_gift_para:",o.data.result," at pages\\member\\couponsnd\\couponsnd.vue:467")),n=o.data.result,n&&(1==a?s=n[8]["img"]:2==a?s=n[9]["img"]:3==a&&(s=n[10]["img"]),e.setData({navList2:n,wechat_share:n[5]["img"],coupon_img:s}))}}),1==a?s=n[8]["img"]:2==a?s=n[9]["img"]:3==a&&(s=n[10]["img"]),e.setData({navList2:n,wechat_share:n[5]["img"],coupon_img:s}),setTimeout(function(){e.setData({loadingHidden:!0})},1500)},query_pubcoupon:function(){var e=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",s=(wx.getStorageSync("openid")&&wx.getStorageSync("openid"),e.coupons_flag);wx.request({url:c+"/api/client/query_pubcoupon",method:"POST",data:{username:o,access_token:n,coupons_flag:s,coupons_type:999,shop_type:u},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){var n=o.data.result;if(o.data.result){if(n.length>0){for(var c=0;c<n.length;c++)n[c]["start_time"]=a.getDateStr(1e3*n[c]["start_time"],0),n[c]["end_time"]=a.getDateStr(1e3*n[c]["end_time"],0);e.setData({coupons_info:n}),console.log(t("查询优惠券发行信息 coupons_info:",n," coupons_info.length:",n.length," at pages\\member\\couponsnd\\couponsnd.vue:563"))}}else wx.showToast({title:o.data.info?o.data.info:"暂无该批次券",icon:"none",duration:1500})}})},bindPickerChange:function(e){var o=this,n=e.detail.value,a=o.coupons_info[n]["name"],c=o.coupons_info[n]["content"],s=o.coupons_info[n]["type"],u=o.coupons_info[n]["footer"],i=o.coupons_info[n]["start_time"],r=o.coupons_info[n]["end_time"],p=o.coupons_info[n]["share_image"];console.log(t("picker发送选择改变，携带值为",e.detail.value,"coupon_type:",s," at pages\\member\\couponsnd\\couponsnd.vue:579")),o.setData({index:n,name:a,coupon_content:c,coupon_type:s,coupon_footer:u,start_time:i,end_time:r,coupon_share_img:p,coupons:o.coupons_info[n]}),console.log(t("自定义值:",o.coupons_info[n]["name"]," at pages\\member\\couponsnd\\couponsnd.vue:591"))},get_coupon:function(){var e=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",a=e.shop_type,s=e.amount,u=e.name,i=e.nums,r=e.start_time,p=e.end_time,g=e.coupon_type?e.coupon_type:1,d=e.coupon_img,l=e.coupon_footer,m=e.coupon_content;if(console.log(t("优惠券信息"," at pages\\member\\couponsnd\\couponsnd.vue:614")),r>p)return wx.showToast({title:"有效期错误!",icon:"loading",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500);wx.request({url:c+"/api/client/get_coupon",method:"POST",data:{username:o,access_token:n,name:u,amount:s,nums:i,start_time:r,end_time:p,quan_type:g,shop_type:a,image:d,footer:l,content:m},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){console.log(t("生成优惠券:",o.data.result," at pages\\member\\couponsnd\\couponsnd.vue:650"));var n=o.data.result;if(!n)return wx.showToast({title:o.data.info?o.data.info:"无法生成优惠券",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500);var a=n;e.setData({coupons:a})}})},reloadData:function(){},showGoods:function(e){var o=e.currentTarget.dataset.skuId,n=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",c=e.currentTarget.dataset.goodsId,s=e.currentTarget.dataset.goodsName;console.log(t("showGoods"," at pages\\member\\couponsnd\\couponsnd.vue:821")),console.log(t(s+" "+c," at pages\\member\\couponsnd\\couponsnd.vue:822")),wx.navigateTo({url:"../../details/details?sku_id="+o+"&goods_name="+s+"&id="+c+"&token="+a+"&username="+n})},onShareAppMessage:function(e){var o=this,n=o.coupons_info,a=(wx.getStorageSync("username")&&wx.getStorageSync("username"),o.token,o.nickname,1==o.coupon_type?"收到一张"+o.name+"~":"收到一个"+o.name+"~"),c=o.coupon_share_img,s=o.coupon_type?o.coupon_type:1,u=o.coupon_id?o.coupon_id:0,i=o.coupon_flag?o.coupon_flag:9,r="";if(1==s?r="一张优惠券":2==s?r="一个红包":3==s&&(r="一个积分奖励"),console.log(t("开始送优惠券",e," at pages\\member\\couponsnd\\couponsnd.vue:850")),n){var p={title:a,desc:r,path:"/pages/member/couponrcv/couponrcv?coupons_flag="+i+"&coupons_id="+u+"&coupons_type="+s+"&receive=1",imageUrl:c,success:function(e){console.log(t(e," at pages\\member\\couponsnd\\couponsnd.vue:867")),"shareAppMessage:ok"==e.errMsg&&o.setData({send_status:1})},fail:function(e){console.log(t(e," at pages\\member\\couponsnd\\couponsnd.vue:877")),"shareAppMessage:fail cancel"==e.errMsg||e.errMsg},complete:function(){}};return"button"===e.from&&console.log(t("优惠券分享",p," at pages\\member\\couponsnd\\couponsnd.vue:893")),p}console.log(t("优惠券为空"," at pages\\member\\couponsnd\\couponsnd.vue:853"))},setData:function(e){var o,n,t=this,a=[];Object.keys(e).forEach(function(c){a=c.split("."),o=e[c],n=t.$data,a.forEach(function(e,c){c+1==a.length?t.$set(n,e,o):n[e]||t.$set(n,e,{}),n=n[e]})})}}};o.default=m}).call(this,n("6e42")["default"],n("0de9")["default"])},e2d2:function(e,o,n){"use strict";var t=function(){var e=this,o=e.$createElement;e._self._c},a=[];n.d(o,"a",function(){return t}),n.d(o,"b",function(){return a})}},[["38ea","common/runtime","common/vendor"]]]);