(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/message/message"],{"21fe":function(e,t,a){"use strict";a.r(t);var s=a("3f77"),r=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);t["default"]=r.a},"37f5":function(e,t,a){"use strict";var s=a("c900"),r=a.n(s);r.a},"3f77":function(e,t,a){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(a("a34a")),n=o(a("80dc"));function o(e){return e&&e.__esModule?e:{default:e}}function g(e,t,a,s,r,n,o){try{var g=e[n](o),i=g.value}catch(l){return void a(l)}g.done?t(i):Promise.resolve(i).then(s,r)}function i(e){return function(){var t=this,a=arguments;return new Promise(function(s,r){var n=e.apply(t,a);function o(e){g(n,s,r,o,i,"next",e)}function i(e){g(n,s,r,o,i,"throw",e)}o(void 0)})}}var l=function(){return a.e("components/uni-icons/uni-icons").then(a.bind(null,"f9e2"))},u=function(){return a.e("components/uni-nav-bar/uni-nav-bar").then(a.bind(null,"daa9"))},c=a("3936"),d=getApp().globalData.weburl,m=getApp().globalData.shop_type,p=getApp().globalData.messageflag,f=wx.getStorageSync("username")?wx.getStorageSync("username"):"",_=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",h=(wx.getStorageSync("openid")&&wx.getStorageSync("openid"),wx.getStorageSync("userInfo")?wx.getStorageSync("userInfo"):""),v=[{id:"AI",title:"智能选礼"},{id:"task",title:"任务"},{id:"message",title:"消息"}],w=(new Date).getTime(),T={data:function(){return{new_task_image:d+"/uploads/gift_logo.png",loading_img:d+"/uploads/loading.gif",shop_type:m,user:null,userInfo:{},nickname:h.nickName,avatarUrl:h.avatarUrl,username:null,indicatorDots:!1,vertical:!1,autoplay:!0,page:1,pagesize:10,all_rows:0,page_num:0,hiddenmodalput:!0,withdrawNum:null,withdrawWx:null,withdraw_selected:1,message_list:[],task_list:[],messageHidden:!0,dkheight:300,message:{},messageflag:p,noselected:0,selected_num:0,selected_all:!1,selected_start:!0,rules_length:5,task_num:0,message_num:0,navList_order:v,tab2:"task",activeIndex2:0,TabCur:0,scrollLeft:0,currenttime:w?parseInt(w):0,message_type:0,goods_id:"",orderObjects:"",rule_list:"",rule_selected_info:"",isLoadingTrue:!1,rule_goods_list:"",select_goods_list:"",select_goods_1:"",select_goods_2:"",commodityAttr:"",sku_id:"",attrValueList:""}},components:{uniIcons:l,uniNavBar:u},props:{},onLoad:function(t){var a=this;wx.getSystemInfo({success:function(t){var s=t.windowHeight;console.log(e("getSystemInfo:",s," at pages\\member\\message\\message.vue:301")),a.setData({dkheight:s})}}),a.getPermission()},onShow:function(){var t=this,a=0,s=t.TabCur;s=0==getApp().globalData.messageflag?1:1==getApp().globalData.messageflag?2:0,console.log(e("message onShow messageflag:",getApp().globalData.messageflag,"activeIndex2:",a," at pages\\member\\message\\message.vue:322")),t.setData({TabCur:s,messageflag:getApp().globalData.messageflag}),0==s?t.get_ai_rules():t.get_member_messages()},onPullDownRefresh:function(){},methods:{getPermission:function(){var e=i(r.default.mark(function e(){return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.checkPermission();case 2:e.sent;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),checkPermission:function(){var e=i(r.default.mark(function e(t){var a,o,g,i;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!n.default.isIOS){e.next=6;break}return e.next=3,n.default.requestIOS("push");case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=1;case 7:if(a=e.t0,null===a||1===a?a=1:s.showModal({content:"需要推送权限",confirmText:"设置",success:function(e){e.confirm&&n.default.gotoAppSetting()}}),!n.default.isIOS){e.next=13;break}e.t1=1,e.next=16;break;case 13:return e.next=15,n.default.requestAndroid("android.permission.WRITE_EXTERNAL_STORAGE");case 15:e.t1=e.sent;case 16:if(o=e.t1,null===o||1===o?o=1:s.showModal({content:"需要写数据权限",confirmText:"设置",success:function(e){e.confirm&&n.default.gotoAppSetting()}}),!n.default.isIOS){e.next=22;break}e.t2=1,e.next=25;break;case 22:return e.next=24,n.default.requestAndroid("android.permission.READ_EXTERNAL_STORAGE");case 24:e.t2=e.sent;case 25:return g=e.t2,null===g||1===g?g=1:s.showModal({content:"需要读数据权限",confirmText:"设置",success:function(e){e.confirm&&n.default.gotoAppSetting()}}),i=a&&o&&g?1:0,e.abrupt("return",i);case 29:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),tabSelect:function(e){this.TabCur=e.currentTarget.dataset.id,this.scrollLeft=60*(e.currentTarget.dataset.id-1)},formSubmit:function(t){var a=this,s=t.detail.formId,r=t.currentTarget.dataset.name;if(console.log(e("formSubmit() formID：",s," form name:",r," at pages\\member\\message\\message.vue:401")),"selectBtn"==r)a.selectBtnTap();else if("addCart"==r){var n=t.currentTarget.dataset.goodsId;a.setData({goods_id:n}),a.addCart()}else if("selectBtn_next"==r){var o=a.selected_num+1,g=a.rules_length-1;this.setData({selected_num:o<=g?o:g,selected_all:o==g,selected_start:0==o})}else if("selectBtn_last"==r){o=a.selected_num-1,g=a.rules_length-1;this.setData({selected_num:o<=0?0:o,selected_all:o==g,selected_start:0==o})}},showGoods:function(e){var t=this,a=e.currentTarget.dataset.objectId,s=wx.getStorageSync("username")?wx.getStorageSync("username"):"",r=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=e.currentTarget.dataset.goodsId,o=e.currentTarget.dataset.goodsName,g=e.currentTarget.dataset.goodsPrice,i=e.currentTarget.dataset.goodsInfo,l=e.currentTarget.dataset.sale,u=e.currentTarget.dataset.image,c=t.rule_selected_info;if(!c){var d=t.rule_list;c="";for(var m=0;m<d.length;m++){var p=d[m]["selected"];c=c+'"'+d[m]["id"]+'":"'+d[m]["item_name"][p]+'"'}c="{"+c+"}"}wx.navigateTo({url:"/pages/details/details?sku_id="+a+"&id="+n+"&goods_info="+i+"&goods_price="+g+"&sale="+l+"&name="+o+"&image="+u+"&rule_selected_info="+c+"&token="+r+"&username="+s})},onOrderTapTag:function(t){var a=this;this.TabCur=t.currentTarget.dataset.id,this.scrollLeft=60*(t.currentTarget.dataset.id-1);var s=t.currentTarget.dataset.tab,r=t.currentTarget.dataset.index,n=a.messageflag,o=a.message_type;"task"==s?(n=0,getApp().globalData.messageflag=n,o=0):"AI"==s?(n=2,getApp().globalData.messageflag=n):(n=1,getApp().globalData.messageflag=n,o=5),a.setData({activeIndex2:r,tab2:s,page:1,messageflag:n,message_type:o,message_list:[]}),console.log(e("tab:"+s," messageflag:",n,"activeIndex2:",a.activeIndex2," at pages\\member\\message\\message.vue:493")),0==a.TabCur?a.get_ai_rules():a.get_member_messages()},bindChangeNum:function(t){var a=this,s=t.detail.value;a.setData({withdrawNum:s}),console.log(e("withdrawNum:"+a.withdrawNum," at pages\\member\\message\\message.vue:507"))},bindChangeWx:function(t){var a=this,s=t.detail.value;a.setData({withdrawWx:s}),console.log(e("withdrawWx:"+a.withdrawWx," at pages\\member\\message\\message.vue:515"))},imgYu:function(t){var a=this,s=a.shop_type,r=t.currentTarget.dataset.src,n=t.currentTarget.dataset.orderNo,o=(t.currentTarget.dataset.messageType,[]);o.push(t.currentTarget.dataset.list),n?wx.request({url:d+"/api/client/query_order",method:"POST",data:{username:f,access_token:_,order_no:n,shop_type:s},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("message gift info:",t.data.result," at pages\\member\\message\\message.vue:546"));var s=t.data.result,r=a.sku_id;if(t.data.info)wx.showToast({title:t.data.info,icon:"loading",duration:1500});else{for(var n=0;n<s.length;n++){t.data.result[n]["logo"].indexOf("http")<0&&(s[n]["logo"]=d+s[n]["logo"]);for(var o=0;o<s[n]["order_sku"].length;o++)t.data.result[n]["order_sku"][o]["sku_image"].indexOf("http")<0&&(s[n]["order_sku"][o]["sku_image"]=d+s[n]["order_sku"][o]["sku_image"]),r=""!=r?r+","+s[n]["order_sku"][o]["sku_id"]:s[n]["order_sku"][o]["sku_id"]}a.setData({orderObjects:s[0]}),wx.navigateTo({url:"/pages/order/orderdetail/orderdetail?order_object="+JSON.stringify(a.orderObjects)+"&order_id="+s["id"]})}}}):wx.previewImage({current:r,urls:o})},message_action:function(e){var t=e.currentTarget.dataset.msgId,a=e.currentTarget.dataset.msgType,s=e.currentTarget.dataset.couponId,r=e.currentTarget.dataset.amountType;4==a?(r=1==r?2:2==r?3:1,wx.navigateTo({url:"/pages/member/couponrcv/couponrcv?receive=1&coupons_flag=9&coupons_type="+r+"&coupons_id="+s+"&msg_id="+t})):6==a&&wx.switchTab({url:"/pages/member/task/task"})},task_action:function(e){var t=e.currentTarget.dataset.msgId,a=(e.currentTarget.dataset.taskStatus&&e.currentTarget.dataset.taskStatus,e.currentTarget.dataset.image);wx.navigateTo({url:"/pages/member/task/task?task=1&image="+a+"&msg_id="+t})},rule_select:function(t){for(var a=this,s=a.rule_list,r=t.currentTarget.dataset.goodsItemId,n=t.currentTarget.dataset.goodsItemIndex,o="",g=0;g<s.length;g++){s[g]["id"]==r&&(s[g]["selected"]=n);var i=s[g]["selected"];o=o+'"'+s[g]["id"]+'":"'+s[g]["item_name"][i]+'"'}o="{"+o+"}",a.setData({rule_list:s,rule_selected_info:o}),console.log(e("rule_selected_info:",o," at pages\\member\\message\\message.vue:659"))},messageConfirm:function(){var e=this,t=e.messageHidden;e.setData({messageHidden:!t})},message_detail:function(t){var a=this,s=t.currentTarget.dataset.message,r=t.currentTarget.dataset.messageType,n=t.currentTarget.dataset.amount,o=t.currentTarget.dataset.amountType,g=t.currentTarget.dataset.footer,i=t.currentTarget.dataset.content,l=(t.currentTarget.dataset.acceptTime,t.currentTarget.dataset.startTime),u=t.currentTarget.dataset.endTime,d=t.currentTarget.dataset.image,m=a.messageHidden,p=a.message;l=c.getDateStr(1e3*l,0),u=c.getDateStr(1e3*u,0),r>3||(p={message:s,message_type:r,amount:n,amount_type:o,footer:g,content:i,start_time:l,end_time:u,image:d},a.setData({message:p,messageHidden:!m}),console.log(e("message_detail message:",a.message," at pages\\member\\message\\message.vue:701")))},tryagain:function(){var e=this;e.setData({messageflag:getApp().globalData.messageflag})},get_member_messages:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=t.shop_type,n=t.page,o=t.pagesize,g=t.message_type;wx.request({url:d+"/api/client/get_member_messages",method:"POST",data:{username:a,access_token:s,shop_type:r,message_type:g,page:n,pagesize:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){var s=a.data,r=a.data.all_rows;if("y"==s["status"]){for(var n=s["result"],g=[],i=[],l=0;l<n.length;l++)6==n[l].type?(console.log(e("message get_member_messages messages[i]:",l,n[l]," at pages\\member\\message\\message.vue:747")),n[l]["task_info"]["task_status"],0==g.length&&g.push(n[l])):i.push(n[l]);var u=t.page_num;u=r/o+.5,u>1&&i&&(i=t.message_list.concat(i)),t.setData({message_list:i,task_list:g,page_num:u.toFixed(0)}),console.log(e("获取消息:",t.message_list,t.task_list," at pages\\member\\message\\message.vue:795"))}else wx.showToast({title:"暂无消息",icon:"none",duration:1e3})}})},get_ai_rules:function(){var t=this,a=s.getStorageSync("username")?s.getStorageSync("username"):"",r=s.getStorageSync("token")?s.getStorageSync("token"):"1",n=t.shop_type;console.log(e("get_ai_rules"," at pages\\member\\message\\message.vue:812")),s.request({url:d+"/api/client/get_ai_rules",method:"POST",data:{username:a,access_token:r,shop_type:n,type:2},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){var s=a.data;if(console.log(e("get_ai_rules info:",s," at pages\\member\\message\\message.vue:828")),"y"==s["status"]){for(var r=s["result"],n=0;n<r.length;n++)r[n]["item_name"].length>0&&(r[n]["selected"]=0);t.rule_list=r,t.rules_length=r.length,t.selected_num=t.selected_num,t.selected_all=t.selected_all,t.selected_start=t.selected_start,console.log(e("获取智能选品规则:",t.rule_list," at pages\\member\\message\\message.vue:844"))}else wx.showToast({title:"暂无选品规则",icon:"none",duration:1e3})}})},selectBtnTap:function(){var t=this,a=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",r=t.shop_type,n=t.rule_list,o=[];t.setData({isLoadingTrue:!0}),setTimeout(function(){t.setData({isLoadingTrue:!1})},3e3),wx.pageScrollTo?wx.pageScrollTo({scrollTop:0}):wx.showModal({title:"提示",content:"当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。"});for(var g=0;g<n.length;g++){var i={};i["id"]=n[g]["id"],i["selected"]=n[g]["selected"],o.push(i)}console.log(e("selectBtnTap selected rule:",o," at pages\\member\\message\\message.vue:891")),wx.request({url:d+"/api/client/get_ai_goods_list",method:"POST",data:{username:a,access_token:s,shop_type:r,rule_select:JSON.stringify(o)},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(a){var s=a.data;if(console.log(e("get_ai_rules 智能选品列表 goods info:",s," at pages\\member\\message\\message.vue:907")),"y"==s["status"]){for(var r=s["result"],n=r.length,o=0;o<n;o++)r[o]["image"]=""==r[o]["activity_image"]?r[o]["image"]:r[o]["activity_image"];t.setData({rule_goods_list:r,select_goods_list:r[0],select_goods_1:r[1]?r[1]:"",select_goods_2:r[2]?r[2]:"",messageflag:3}),getApp().globalData.messageflag=t.messageflag,console.log(e("get_ai_rules 智能选品列表:",t.rule_goods_list," at pages\\member\\message\\message.vue:926"))}else t.setData({messageflag:9}),console.log(e("get_ai_rules 暂无推荐的商品:",t.noselected," at pages\\member\\message\\message.vue:931"))}})},addCart:function(){var t=this,a=s.getStorageSync("username")?s.getStorageSync("username"):"",r=s.getStorageSync("token")?s.getStorageSync("token"):"1",n=t.goods_id,o=t.page;a?wx.request({url:d+"/api/client/get_goodssku_list",method:"POST",data:{username:a,access_token:r,goods_id:n,shop_type:m,page:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(s){console.log(e("goods_sku:",s.data.result," at pages\\member\\message\\message.vue:965"));var r=s.data.result.spec_select_list?s.data.result.spec_select_list:"",n=s.data.result.sku_list?s.data.result.sku_list:"{}";if(n){for(var o=0;o<n.length;o++)n[o].attrValueStatus?n[o].attrValueStatus=!0:n[o].attrValueStatus=!1;if(t.setData({commodityAttr:n,sku_id:n[0]["id"]}),console.log(e("goods sku id:",t.sku_id," at pages\\member\\message\\message.vue:990")),t.insertCart(t.sku_id,a,0),r){for(o=0;o<r.length;o++)r[o].attrValueStatus||(r[o].attrValueStatus=!0);t.setData({attrValueList:r})}}else wx.showToast({title:"该产品已下架",icon:"loading",duration:1500})}}):wx.navigateTo({url:"/pages/login/login?frompage=member/message/message"})},insertCart:function(t,a,s){var r=this,n=r.shop_type,o=r.rule_selected_info;if(!o){var g=r.rule_list;o="";for(var i=0;i<g.length;i++){var l=g[i]["selected"];o=o+'"'+g[i]["id"]+'":"'+g[i]["item_name"][l]+'"'}o="{"+o+"}"}wx.request({url:d+"/api/client/add_cart",method:"POST",data:{username:a,access_token:"1",sku_id:t,wishflag:s,shop_type:n,rule_selected_info:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log(e("details insertCart res data:",t.data," wishflag：",s," at pages\\member\\message\\message.vue:1040"));var a=1==s?"已加入心愿单":"已加入礼物袋";wx.showToast({title:a,duration:2e3}),getApp().globalData.from_page="/pages/details/details",1==s?wx.navigateTo({url:"/pages/wish/wish"}):(console.log(e("details insertCart wishflag:",s," at pages\\member\\message\\message.vue:1058")),getApp().globalData.hall_gotop=1,wx.switchTab({url:"/pages/hall/hall"}))}})},getMoreAccountTapTag:function(e){var t=this,a=t.page+1;t.pagesize,t.all_rows;a>t.page_num?wx.showToast({title:"没有更多了",icon:"loading",duration:1e3}):(t.setData({page:a}),t.get_member_messages())},goBack:function(){var e=getCurrentPages();e.length>1?(wx.navigateBack({changed:!0}),返回上一页):wx.navigateTo({url:"/pages/list/list"})},move:function(){},setData:function(e){var t,a,s=this,r=[];Object.keys(e).forEach(function(n){r=n.split("."),t=e[n],a=s.$data,r.forEach(function(e,n){n+1==r.length?s.$set(a,e,t):a[e]||s.$set(a,e,{}),a=a[e]})})}}};t.default=T}).call(this,a("0de9")["default"],a("6e42")["default"])},"3fac":function(e,t,a){"use strict";(function(e){a("ee7a"),a("921b");s(a("66fd"));var t=s(a("f8ab"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},c0fb:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},r=[];a.d(t,"a",function(){return s}),a.d(t,"b",function(){return r})},c900:function(e,t,a){},f8ab:function(e,t,a){"use strict";a.r(t);var s=a("c0fb"),r=a("21fe");for(var n in r)"default"!==n&&function(e){a.d(t,e,function(){return r[e]})}(n);a("37f5");var o=a("2877"),g=Object(o["a"])(r["default"],s["a"],s["b"],!1,null,null,null);t["default"]=g.exports}},[["3fac","common/runtime","common/vendor"]]]);