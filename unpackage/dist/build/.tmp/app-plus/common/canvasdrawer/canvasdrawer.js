(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/canvasdrawer/canvasdrawer"],{"0d30":function(t,e,a){"use strict";a.r(e);var i=a("96f8"),n=a("4698");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("a392");var s=a("2877"),c=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},4698:function(t,e,a){"use strict";a.r(e);var i=a("a7d3"),n=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=n.a},"7f90":function(t,e,a){},"96f8":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},a392:function(t,e,a){"use strict";var i=a("7f90"),n=a.n(i);n.a},a7d3:function(t,e,a){"use strict";(function(t,a){function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},i=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),i.forEach(function(e){n(t,e,a[e])})}return t}function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={data:function(){return{showCanvas:!1,width:100,height:100,index:0,imageList:[],tempFileList:[],isPainting:!1,cache:{},ctx:null,windowHeight:"",windowWidth:"",ratio:"",background:""}},components:{},props:{painting:{type:Object,value:{views:[]}}},watch:{painting:function(t,e){wx.removeStorageSync("canvasdrawer_pic_cache"),this.cache=wx.getStorageSync("canvasdrawer_pic_cache")||{},this.ctx=wx.createCanvasContext("canvasdrawer",this),this.isPainting||(JSON.stringify(t)!==JSON.stringify(e)?t&&t.width&&t.height&&(this.setData({showCanvas:!0,isPainting:!0}),this.readyPigment()):(this.setData({showCanvas:!0,isPainting:!0}),this.readyPigment(),t&&"same"!==t.mode&&this.$emit("getImage",{errMsg:"canvasdrawer:samme params"})))}},mounted:function(){},methods:{readyPigment:function(){var e=this,a=this.painting,i=a.width,n=a.height,r=a.windowHeight,s=a.windowWidth,c=a.background;a.views;this.setData({width:i,height:n,windowHeight:r,windowWidth:s,ratio:750/s,background:c}),console.log(t("canvasdrawer readyPigment background:",c,i,n," at common\\canvasdrawer\\canvasdrawer.vue:99"));var o=setInterval(function(){e.ctx&&(clearInterval(o),e.ctx.clearActions(),e.reset(),e.ctx.save(),e.drawRect({background:c,top:0,left:0,width:i,height:n}),e.startPainting())},200)},reset:function(){this.ctx.beginPath(),this.ctx.setFillStyle("#000000"),this.ctx.setStrokeStyle("#000000"),this.ctx.setFontSize(10),this.ctx.setGlobalAlpha(1),this.ctx.setShadow(0,0,0,"rgba(0, 0, 0, 0)"),this.ctx.setLineCap("butt"),this.ctx.setLineJoin("miter"),this.ctx.setLineWidth(1),this.ctx.setMiterLimit(10),this.ctx.draw()},getImageList:function(t){for(var e=[],a=0;a<t.length;a++)"image"===t[a].type&&e.push(t[a].url);this.setData({imageList:e}),this.downLoadImages(0)},downLoadImages:function(e){var a=this,i=this.imageList,n=this.tempFileList;e<i.length?this.getImageInfo(i[e]).then(function(i){n.push(i),a.setData({tempFileList:n}),a.downLoadImages(e+1),console.log(t("canvasdrawer downLoadImages index:",e," tempFileList:",a.tempFileList," at common\\canvasdrawer\\canvasdrawer.vue:168"))}).catch(function(a){console.log(t("canvasdrawer downLoadImages fail:",i[e],"index:",e," at common\\canvasdrawer\\canvasdrawer.vue:170"))}):this.startPainting()},startPainting:function(){var e=this,a=this.painting,n=a.width,r=a.height,s=a.views;a.background,a.radius;this.width=n,this.height=r;for(var c=0;c<s.length;c++)if(console.log(t("canvasdrawer onload views.length:",s.length," i:",c," at common\\canvasdrawer\\canvasdrawer.vue:183")),"image"===s[c].type){var o=s[c],h={};h=i({},o),console.log(t("canvasdrawer onload image drawData:",h," i:",c," at common\\canvasdrawer\\canvasdrawer.vue:192")),this.drawImage(h)}else"text"===s[c].type?this.drawText(s[c]):"rect"===s[c].type?this.drawRect(s[c]):"round"===s[c].type&&this.drawRound(s[c]);this.ctx.draw(!1,function(){console.log(t("canvasdrawer this.ctx.draw canvasdrawer_pic_cache:",e.cache," at common\\canvasdrawer\\canvasdrawer.vue:206")),wx.removeStorageSync("canvasdrawer_pic_cache"),wx.setStorageSync("canvasdrawer_pic_cache",e.cache),e.saveImageToLocal()})},drawImage:function(e){this.ctx.save();var a=e.url,i=e.top,n=void 0===i?0:i,r=e.left,s=void 0===r?0:r,c=e.width,o=void 0===c?0:c,h=e.height,d=void 0===h?0:h,l=e.borderRadius,w=void 0===l?0:l,g=e.roundedRect,v=void 0===g?0:g;if(w)this.ctx.beginPath(),this.ctx.arc(s+w,n+w,w,0,2*Math.PI),this.ctx.fill(),this.ctx.clip(),this.ctx.drawImage(a,s,n,o,d),console.log(t("canvasdrawer drwImge borderRadius:",w," at common\\canvasdrawer\\canvasdrawer.vue:231"));else if(v){var u=v;o<2*u&&(u=o/2),d<2*u&&(u=d/2),this.ctx.beginPath(),this.ctx.moveTo(s+u,n),this.ctx.arcTo(s+o,n,s+o,n+d,u),this.ctx.arcTo(s+o,n+d,s,n+d,u),this.ctx.arcTo(s,n+d,s,n,u),this.ctx.arcTo(s,n,s+o,n,u),this.ctx.fill(),this.ctx.clip(),this.ctx.drawImage(a,s,n,o,d),console.log(t("canvasdrawer drwImge roundedRect:",u," at common\\canvasdrawer\\canvasdrawer.vue:246"))}else this.ctx.drawImage(a,s,n,o,d);this.ctx.restore()},drawText:function(e){this.ctx.save();var n=e.MaxLineNumber,r=void 0===n?2:n,s=e.breakWord,c=void 0!==s&&s,o=e.color,h=void 0===o?"black":o,d=e.content,l=void 0===d?"":d,w=e.fontSize,g=void 0===w?16:w,v=e.top,u=void 0===v?0:v,f=e.left,x=void 0===f?0:f,m=e.lineHeight,p=void 0===m?20:m,b=e.textAlign,I=void 0===b?"left":b,T=e.width,y=e.bolder,L=void 0!==y&&y,P=e.textDecoration,k=void 0===P?"none":P;if(this.ctx.beginPath(),this.ctx.setTextBaseline("top"),this.ctx.setTextAlign(I),this.ctx.setFillStyle(h),this.ctx.setFontSize(1.2*g),c){for(var S="",F=u,_=1,O=0,R=0;R<l.length;R++)if(S+=[l[R]],O+=l[R].match(/[^\x00-\xff]/gi)?2:1,this.ctx.measureText(S).width>T||(O+3)*a.upx2px(g)>T){if(_===r&&R!==l.length){S=S.substring(0,S.length-1)+"...",this.ctx.fillText(S,x,F),this.drawTextLine(x,F,k,h,g,S),S="";break}this.ctx.fillText(S,x,F),this.drawTextLine(x,F,k,h,g,S),S="",O=0,F+=p,_++}else 10==l.charCodeAt(R)&&(this.ctx.fillText(S,x,F),this.drawTextLine(x,F,k,h,g,S),S="",F+=p,_++);this.ctx.fillText(S,x,F),this.drawTextLine(x,F,k,h,g,S)}else if("center"==I){var C=parseInt((x+T-this.ctx.measureText(l).width)/2);this.ctx.fillText(l,C,u),this.drawTextLine(C,u,k,h,g,l)}else if("right"==I){var D=parseInt(x+T-this.ctx.measureText(l).width);this.ctx.fillText(l,D,u),this.drawTextLine(D,u,k,h,g,l),console.log(t("drawText() !breakWord content:",l,"Width:",this.width," width:",T," content len:",this.ctx.measureText(l).width,"textAlign:",I,"text_left:",D," left",x,"textDecoration:",k," at common\\canvasdrawer\\canvasdrawer.vue:284"))}else this.ctx.fillText(l,x,u),this.drawTextLine(x,u,k,h,g,l);this.ctx.restore(),L&&this.drawText(i({},e,{left:x+.3,top:u+.3,bolder:!1,textDecoration:"none"}))},getContent:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=0,n=0,r=[],s=0;i<t.length;s++)if(r[n]||(r[n]=""),r[n]+=t[s],t.charCodeAt(s)>127||t.charCodeAt(s)>=48&&t.charCodeAt(s)<=57?i+=2:i++,(i>=e||a-n==1&&i>=e-2)&&(i=0,n++),n===a)break;return r},drawTextLine:function(t,e,a,i,n,r){"underline"===a?this.drawRect({background:i,top:e+1.2*n,left:t-1,width:this.ctx.measureText(r).width+3,height:1}):"line-through"===a&&this.drawRect({background:i,top:e+.6*n,left:t-1,width:this.ctx.measureText(r).width+3,height:1})},drawRect:function(t){this.ctx.save();var e=t.background,a=t.top,i=void 0===a?0:a,n=t.left,r=void 0===n?0:n,s=t.width,c=void 0===s?0:s,o=t.height,h=void 0===o?0:o;this.ctx.setFillStyle(e),this.ctx.fillRect(r,i,c,h),this.ctx.restore()},getImageInfo:function(e){var i=this;return new Promise(function(n,r){if(i.cache[e])console.log(t(" canvasdrawer getImageInfo() cache[url]:",i.cache[e],"url:",e," at common\\canvasdrawer\\canvasdrawer.vue:405")),n(i.cache[e]);else{var s=new RegExp(/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/),c=new RegExp(/^http:\/\/store\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/),o=new RegExp(/^wxfile:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/);a.getImageInfo({src:e,complete:function(a){"getImageInfo:ok"===a.errMsg?(i.cache[e]=a.path,n(a.path)):(console.log(t("getImageInfo complete error url:",e,"res:",a," at common\\canvasdrawer\\canvasdrawer.vue:426")),i.$emit("getImage",{errMsg:"canvasdrawer:download fail"}))},fail:function(a){console.log(t(" canvasdrawer wx.getImageInfo 接口调用失败",a,e," at common\\canvasdrawer\\canvasdrawer.vue:433")),i.$emit("getImage",{errMsg:"canvasdrawer:getImageInfo 接口调用失败"})}}),s.test(e)||c.test(e)||o.test(e)||console.log(t("canvasdrawer getImageInfo cache url already:",e," at common\\canvasdrawer\\canvasdrawer.vue:441"))}})},saveImageToLocal:function(){var t=this,e=this.width,a=this.height;wx.canvasToTempFilePath({x:0,y:0,width:e,height:a,canvasId:"canvasdrawer",complete:function(e){"canvasToTempFilePath:ok"===e.errMsg?(t.setData({showCanvas:!1,isPainting:!1,imageList:[],tempFileList:[]}),t.$emit("getImage",{tempFilePath:e.tempFilePath,errMsg:"canvasdrawer:ok"})):t.$emit("getImage",{errMsg:"canvasdrawer:fail"})}},this)},setData:function(t){var e,a,i=this,n=[];Object.keys(t).forEach(function(r){n=r.split("."),e=t[r],a=i.$data,n.forEach(function(t,r){r+1==n.length?i.$set(a,t,e):a[t]||i.$set(a,t,{}),a=a[t]})})}}};e.default=r}).call(this,a("0de9")["default"],a("6e42")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'common/canvasdrawer/canvasdrawer-create-component',
    {
        'common/canvasdrawer/canvasdrawer-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('6e42')['createComponent'](__webpack_require__("0d30"))
        })
    },
    [['common/canvasdrawer/canvasdrawer-create-component']]
]);
