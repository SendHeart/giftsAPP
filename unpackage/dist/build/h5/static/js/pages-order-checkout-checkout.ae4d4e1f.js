(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-checkout-checkout"],{"014d":function(e,t,o){var n=o("3f63");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=o("4f06").default;a("18c94fb6",n,!0,{sourceMap:!1,shadowMode:!1})},"080f":function(e,t,o){"use strict";var n=o("014d"),a=o.n(n);a.a},3936:function(e,t,o){"use strict";var n=o("288e");o("3b2b");var a=n(o("768b")),i=n(o("795b"));o("28a5"),o("a481");var r=n(o("e814"));function s(e){var t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),r=e.getSeconds();return[t,o,n].map(d).join("-")+" "+[a,i,r].map(d).join(":")}function c(e,t){var o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o=e?new Date(e):new Date,o.setDate(o.getDate()+t);var a=o.getFullYear(),i=o.getMonth()+1,r=o.getDate(),s=o.getHours(),c=o.getMinutes(),d=o.getSeconds();return i<10&&(i="0"+i),r<10&&(r="0"+r),s<10&&(s="0"+s),c<10&&(c="0"+c),d<10&&(d="0"+d),0==n?a+"-"+i+"-"+r:1==n?s+":"+c:2==n?s+":"+c+":"+d:a+"-"+i+"-"+r}function d(e){return e=e.toString(),e[1]?e:"0"+e}function l(e){var t,o=6e4,n=60*o,a=24*n,i=30*a,s=365*a,c=(new Date).getTime(),d=c-e;if(d<0)return"数据出错";var l=d/s,u=d/i,_=d/(7*a),p=d/a,f=d/n,m=d/o;return t=l>=1?(0,r.default)(l)+"年以前":u>=1?(0,r.default)(u)+"个月前":_>=1?(0,r.default)(_)+"星期前":p>=1?(0,r.default)(p)+"天前":f>=1?(0,r.default)(f)+"小时前":m>=5?(0,r.default)(m)+"分钟前":"刚刚发表",t}function u(e){if("string"==typeof e)return e=e.replace(/\ +/g,""),e=e.replace(/[\r\n]/g,""),e;console.log("去除回车换行空格失败！参数不是字符串类型")}function _(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new Date(e.replace(/-/g,"/")),a=new Date(t.replace(/-/g,"/")),i=a.getTime()-n.getTime(),s=(0,r.default)(i/864e5);return 0==o?i:1==o?s:void 0}function p(e){var t=e.replace(/[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF][\u200D|\uFE0F]|[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF]|[0-9|*|#]\uFE0F\u20E3|[0-9|#]\u20E3|[\u203C-\u3299]\uFE0F\u200D|[\u203C-\u3299]\uFE0F|[\u2122-\u2B55]|\u303D|[\A9|\AE]\u3030|\uA9|\uAE|\u3030/gi,"");return t}function f(e,t){e=e.split("."),t=t.split(".");var o=Math.max(e.length,t.length);while(e.length<o)e.push("0");while(t.length<o)t.push("0");for(var n=0;n<o;n++){var a=(0,r.default)(e[n]),i=(0,r.default)(t[n]);if(a>i)return 1;if(a<i)return-1}return 0}function m(e){var t="tmp_base64src";return new i.default(function(o,n){if(wx.getFileSystemManager){var i=wx.getFileSystemManager(),r=/data:image\/(\w+);base64,(.*)/.exec(e)||[],s=(0,a.default)(r,3),c=s[1],d=s[2];c||n(new Error("ERROR_BASE64SRC_PARSE"));var l="".concat(wx.env.USER_DATA_PATH,"/").concat(t,".").concat(c),u=wx.base64ToArrayBuffer(d);i.writeFile({filePath:l,data:u,encoding:"binary",success:function(){o(l)},fail:function(){n(new Error("ERROR_BASE64SRC_WRITE"))}})}else n(new Error("微信版本过低"))})}function b(){var e="ios";try{var t=wx.getSystemInfoSync();e=t.platform}catch(o){}return e}function g(e,t){return Math.round(e/(e+t)*1e4)/100+"%"}function x(e){return RegExp(/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/).test(e)}function w(e){return RegExp(/^1[34578]\d{9}$/).test(e)}o("6b54"),o("87b3"),e.exports={formatTime:s,getDateDiff:l,getDateStr:c,formatString:u,calDateDiff:_,compareVersion:f,filterEmoji:p,checkPhoneNumber:w,base64src:m,getPlatform:b,percentage:g,checkEmail:x}},"3f63":function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,'uni-page-body[data-v-bb331f44]{background:#f2f2f2;overflow-x:hidden;width:100%}[data-v-bb331f44]::-webkit-scrollbar{width:0;height:0;color:rgba(0,0,0,0)}.startBar[data-v-bb331f44]{height:%?75?%;background:#333;width:100%;position:fixed;top:0;padding:%?5?%;border-bottom:0 solid #f2f2f2;z-index:99}.top-title[data-v-bb331f44]{height:%?75?%;background:#333;width:100%;position:fixed;top:0;padding:%?5?%;border-bottom:0 solid #f2f2f2;z-index:99}.top-title-item[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;color:#fff;text-align:center;line-height:%?75?%;font-size:%?48?%;padding:%?10?%}.top-title-item .title-image[data-v-bb331f44]{width:%?70?%;height:%?70?%;margin-right:%?1?%;margin-top:%?0?%;margin-left:%?20?%}.amount[data-v-bb331f44]{color:red;font-size:%?24?%}.amount[data-v-bb331f44]:before{content:"\\FFE5"}.submit[data-v-bb331f44]{margin:8px}\r\n/*单元格*/.cell[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:left;-webkit-align-items:left;-ms-flex-align:left;align-items:left;border-top:%?1?% solid #eee;border-bottom:%?1?% solid #eee;line-height:1.5;width:100%;background:#fff;font-size:%?26?%;padding:%?15?% %?30?%}.cell[data-v-bb331f44]:last-child{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background:#fff;font-size:%?28?%;padding:%?15?% %?30?%}\r\n/*label显示字符*/.cell uni-text[data-v-bb331f44]:first-child{width:80px}.carts-more[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;border-top:%?1?% solid #eee;border-bottom:%?1?% solid #eee;line-height:1.5;width:100%;background:#fff;font-size:%?28?%;padding:%?15?% %?30?%}\r\n/*请先填写地址*/.area_select[data-v-bb331f44]{width:100%}\r\n/*选择器*/uni-picker[data-v-bb331f44]{width:60%}.gifts-item[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;text-align:center;\r\n  /*width属性解决标题文字太短而缩略图偏移*/width:100%;margin-bottom:%?10?%}.gifts-image[data-v-bb331f44]{margin:%?10?%;width:%?450?%;height:%?270?%}.morebtn[data-v-bb331f44]{margin:%?20?% auto;background:#fff;color:#e34c55;font-size:%?28?%;width:70%}\r\n/*外部容器*/.container[data-v-bb331f44]{width:100%;height:500px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:1}\r\n/*整体列表*/.container .carts-list[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}\r\n/*item与button的容器*/.carts-container[data-v-bb331f44]{position:relative;width:100%;height:%?300?%}\r\n/*每行单元格*/.carts-item[data-v-bb331f44]{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;height:%?250?%;\r\n  /*width属性解决标题文字太短而缩略图偏移*/border-bottom:1px solid #f2f2f2;padding:%?20?% 0;margin-right:%?20?%;position:relative;\r\n  /*\r\n  top: 0;\r\n  left: 0;\r\n  */background:#fff;z-index:1}\r\n/*左部图片*/.carts-image[data-v-bb331f44]{width:%?120?%;height:%?120?%;margin:%?40?% %?20?%}\r\n/*右部描述*/.carts-text[data-v-bb331f44]{width:80%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around}\r\n/*右上部分标题*/.carts-title[data-v-bb331f44]{font-size:%?26?%;color:#444;line-height:%?32?%}\r\n/*右下部分价格与数量*/.carts-subtitle[data-v-bb331f44]{font-size:%?25?%;color:#999;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;height:%?60?%}.carts-sku[data-v-bb331f44]{font-size:%?24?%;color:#999;height:%?110?%}.carts-sku uni-text[data-v-bb331f44]{font-size:%?24?%;color:#999;height:%?40?%;line-height:%?20?%}\r\n/*价格*/.carts-price[data-v-bb331f44]{padding:%?8?%;height:%?30?%;line-height:%?30?%}.carts-gov-price[data-v-bb331f44]{color:#999;font-size:%?24?%;line-height:1;width:%?150?%;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}.carts-en-price[data-v-bb331f44]{color:#e34c55;font-size:12px;line-height:18px;width:%?150?%;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}.order-item[data-v-bb331f44]{width:100%;position:relative;\r\n  /*\r\n  top: 301rpx;\r\n  left: 0;\r\n  */background:#fff;z-index:1}.subtitle2[data-v-bb331f44]{background:#fff;width:100%;height:%?6?%;border-radius:0 0 %?10?% %?10?%}\r\n/*人民币符号*/.carts-price[data-v-bb331f44]:before,.select-and-amount uni-text[data-v-bb331f44]:last-child:before{content:""}.select-and-amount[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;font-size:%?28?%;background:#fff;padding:%?15?% %?20?%}.select-and-amount-mark[data-v-bb331f44]{position:absolute;top:%?10?%;left:%?20?%;font-size:%?28?%}.coupons-list[data-v-bb331f44]{position:relative;top:0;left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.coupon-item-banner[data-v-bb331f44]{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;text-align:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center}.counpons-item[data-v-bb331f44]{background-size:%?552?% %?246?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;width:%?552?%;padding:%?55?% 0 %?20?% 0}.counpons[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;text-align:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;background:#fff;margin:%?10?% auto;width:100%}.coupon-name[data-v-bb331f44]{font-size:%?32?%;color:#ebdddd;line-height:%?26?%;width:100%}.coupon-content[data-v-bb331f44]{font-size:%?36?%;color:#ebdddd;line-height:2;width:100%}.coupon-dueday[data-v-bb331f44]{font-size:%?22?%;color:#ebdddd;line-height:1.5;width:100%}.coupon-footer[data-v-bb331f44]{font-size:%?22?%;color:#ebdddd;line-height:1.5;width:100%}.order-num[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:left;-webkit-justify-content:left;-ms-flex-pack:left;justify-content:left;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;text-align:left;width:100%;margin-bottom:%?10?%;border-top:%?1?% solid #f2f2f2;background:#fff;font-size:%?28?%;padding:%?15?% %?30?%}.confirmbtn[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:100%;position:relative;margin-top:%?100?%}.confirmbtn uni-form[data-v-bb331f44]{width:100%;text-align:center}.address-section[data-v-bb331f44]{padding:%?30?% 0;background:#fff;position:relative}.order-content[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.icon-shouhuodizhi[data-v-bb331f44]{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:%?90?%;color:#888;font-size:%?44?%}.cen[data-v-bb331f44]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-size:%?28?%;color:#666}.name[data-v-bb331f44]{font-size:%?34?%;margin-right:%?24?%}.address[data-v-bb331f44]{margin-top:%?16?%;margin-right:%?20?%;color:$font-color-light}.icon-you[data-v-bb331f44]{font-size:%?32?%;color:$font-color-light;margin-right:%?30?%}.a-bg[data-v-bb331f44]{position:absolute;left:0;bottom:0;display:block;width:100%;height:%?5?%}body.?%PAGE?%[data-v-bb331f44]{background:#f2f2f2}',""])},4096:function(e,t,o){"use strict";var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("a4bb"));o("ac6a");var i=n(o("f499"));o("28a5");var r=n(o("59ad")),s=n(o("e814"));o("7f7f");var c=o("3936"),d=getApp().globalData.weburl,l=getApp().globalData.shop_type,u={data:function(){return{title_name:"送出礼品",title_logo:"/static/images/footer-icon-05.png",amount:0,carts:[],cartIds:null,addressList:[],addressData:[],addressIndex:0,address_id:0,username:null,token:null,page:1,pagesize:5,page_num:0,page_red:1,page_red_num:0,all_rows:0,all_red_rows:0,shop_type:l,showmorehidden:!1,modalHiddenCoupon:!0,couponType:1,selectedAllStatus:!1,selectedRedAllStatus:!1,discountpay:0,payamount:0,order_num:1,dkheight:"",delivery_price:"",order_type:"",order_note:"",order_image:"",is_buymyself:"",order_shape:"",order_voice:"",order_voicetime:"",order_color:"",card_register_info:"",card_name_info:"",card_cele_info:"",card_love_info:"",card_template:"",coupons_list:"",selected_coupon_id:"",selected_coupon_name:"",selected_coupon_content:"",selected_coupon_footer:"",selected_coupon_starttime:"",selected_coupon_endtime:"",selected_coupon_type:"",selected_coupon_amount:"",selected_coupon_index:"",selected_couponimage:"",coupons_quan_list:"",selected_coupon_quan_index:"",selected_coupon_quan_amount:"",coupons_red_list:"",selected_coupon_red_index:"",selected_coupon_red_amount:""}},components:{},props:{},onLoad:function(e){var t=this;t.readCarts(e),wx.getSystemInfo({success:function(e){var o=e.windowHeight;console.log(o),t.setData({dkheight:o-.05*o-20})}})},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"/static/images/back.png"}),e.loadAddress()},methods:{formSubmit:function(e){var t=this,o=e.detail.formId,n=e.currentTarget.dataset.name;console.log("formSubmit() formID：",o," form name:",n),"confirmOrder"==n?t.confirmOrder():"getMoreOrders"==n&&t.getMoreOrdersTapTag(),o&&t.submintFromId(o)},submintFromId:function(e){var t=this,o=(e=e,t.shop_type),n=wx.getStorageSync("username")?wx.getStorageSync("username"):"",a=wx.getStorageSync("token")?wx.getStorageSync("token"):"1";wx.request({url:d+"/api/client/save_member_formid",method:"POST",data:{username:n,access_token:a,formId:e,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log("submintFromId() update success: ",e.data)}})},showGoods:function(e){var t=e.currentTarget.dataset.skuId,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",a=e.currentTarget.dataset.goodsId,i=e.currentTarget.dataset.goodsName,r=e.currentTarget.dataset.goodsPrice,s=e.currentTarget.dataset.goodsSale,c=(e.currentTarget.dataset.goodsInfo,e.currentTarget.dataset.image);wx.navigateTo({url:"../../details/details?sku_id="+t+"&goods_name="+i+"&id="+a+"&goods_price="+r+"&sale="+s+"&goods_info=&image="+c+"&token="+n+"&username="+o})},order_numFun:function(e){var t=this,o=(0,s.default)(e.detail.value?e.detail.value:0),n=t.amount,a=t.discountpay?t.discountpay:0,i=(n*o-a).toFixed(2);console.log("order_num amount:",n," discountpay:",a," order_num:",o," payamount:",i),t.setData({order_num:o,payamount:i})},goBack:function(){var e=getCurrentPages(),t=null;e.length>1&&(t=e[e.length-2]),t&&(t.customerSource=that.source[that.curIndex]),uni.navigateBack()},readCarts:function(e){var t=this,o=(0,r.default)(e.amount),n=t.payamount,a=t.discountpay,i=JSON.parse(e.carts),s=e.cartIds,c=(0,r.default)(i[0].delivery_price),d=s.split(","),l=e.order_type?e.order_type:"",u=e.order_note?e.order_note:"",_=e.order_image?e.order_image:"",p=e.order_shape?e.order_shape:0,f=e.order_voice?e.order_voice:"",m=e.order_voicetime?e.order_voicetime:0,b=e.order_color?e.order_color:"#333",g=e.is_buymyself?e.is_buymyself:0,x=e.card_register_info?JSON.parse(e.card_register_info):"",w=e.card_name_info?JSON.parse(e.card_name_info):"",v=e.card_cele_info?JSON.parse(e.card_cele_info):"",y=e.card_love_info?JSON.parse(e.card_love_info):"",h=e.card_template?JSON.parse(e.card_template):"";n=(o-a).toFixed(2),this.setData({amount:o,payamount:n,delivery_price:c,carts:i,cartIds:d,order_type:l,order_note:u,order_image:_,username:e.username,token:e.token,is_buymyself:g,order_shape:p,order_voice:f,order_voicetime:m,order_color:b,card_register_info:x,card_name_info:w,card_cele_info:v,card_love_info:y,card_template:h}),console.log("checkouts readCarts() order_image:",_,"order_shape:",p,"card_template:",h," card_name_info:",w," card_register_info:",x," card_love_info:",y)},confirmOrder:function(){var e=this,t=e.order_num;if(0!=t){var o=e.is_buymyself,n=e.address_id?e.address_id:0,a=(e.carts,e.cartIds),r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",c=e.selectedAllStatus,l=e.selectedRedAllStatus,u=e.selected_coupon_quan_index?e.selected_coupon_quan_index:0,_=e.selected_coupon_red_index?e.selected_coupon_red_index:0;console.log("confirmOrder selected_coupon_quan_index:",e.selected_coupon_quan_index,"selected_coupon_red_index:",e.selected_coupon_red_index," coupons_red_list:",e.coupons_red_list);var p=c?e.coupons_quan_list[u]["amount"]:0,f=c?e.coupons_quan_list[u]["id"]:0,m=c?e.coupons_quan_list[u]["type"]:1,b=l?e.coupons_red_list[_]["amount"]:0,g=l?e.coupons_red_list[_]["id"]:0,x=l?e.coupons_red_list[_]["type"]:1,w=e.shop_type,v=(e.amount,1==o?"app":"gift"),y=e.order_image,h=e.order_note,k=e.order_shape,S=e.order_voice,C=e.order_voicetime,T=e.order_color,D=(t=e.order_num,(0,i.default)(e.card_register_info)),z=(0,i.default)(e.card_name_info),A=(0,i.default)(e.card_cele_info),j=(0,i.default)(e.card_love_info),E=(0,i.default)(e.card_template);h||(h="送你一份礼物，愿你喜欢!"),console.log("order_image:",y,"order_shape:",k,"card_template:",E," card_cele_info:",A),wx.request({url:d+"/api/client/add_order",method:"POST",data:{username:r,access_token:s,shop_type:w,sku_id:a,buy_type:"cart",order_type:v,note:h,order_image:y,order_shape:k,order_voice:S,order_voicetime:C,order_color:T,card_register_info:D,card_name_info:z,card_cele_info:A,card_love_info:j,card_template:E,coupon_id:c?f:0,coupon_type:c?m:0,coupon_amount:c?p:0,coupon_red_id:l?g:0,coupon_red_type:l?x:0,coupon_red_amount:l?b:0,order_num:t||1,is_buymyself:o||0,address_id:n},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log("提交订单:",t.data.result);var n=t.data.result;t.data.info?wx.showToast({title:t.data.info,icon:"none",duration:2e3}):0==n["order_pay"]?(e.delete_cart(),e.zero_pay(n["order_no"])):wx.navigateTo({url:"../../order/payment/payment?orderNo="+n["order_no"]+"&totalFee="+n["order_pay"]+"&is_buymyself="+o})}})}else wx.showToast({title:"请输入份数",icon:"loading",duration:2e3})},delete_cart:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=e.cartIds,a=e.shop_type;console.log("payment delete_cart sku_id:",n),wx.request({url:d+"/api/client/delete_cart",method:"POST",data:{username:t,access_token:o,sku_id:n,shop_type:a},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log("payment delete_cart:",e.data.result)}})},zero_pay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this,o=wx.getStorageSync("username")?wx.getStorageSync("username"):"",n=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",a=t.is_buymyself;wx.request({url:d+"/api/client/query_order",method:"POST",data:{username:o,access_token:n,order_no:e,shop_type:l},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log("order checkout zero_pay() 0支付订单查询:",t.data);var o=t.data.result;return o?o[0]["gift_status"]>0?(console.log("order checkout zero_pay() 该订单已送出 orderObjects:",o),wx.showToast({title:"该订单已送出",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500)):void wx.navigateTo({url:"../send/send?order_no="+e+"&orders="+(0,i.default)(o)+"&is_buymyself="+a}):(console.log("order checkout zero_pay() 没有该订单 orderObjects:",o),wx.showToast({title:"没有该订单",icon:"none",duration:1500}),void setTimeout(function(){wx.navigateBack()},1500))}})},loadAddress:function(){var e=this,t=[],o=e.shop_type,n=[],a=e.address_id?e.address_id:0,i=e.addressIndex?e.addressIndex:0,r=wx.getStorageSync("username")?wx.getStorageSync("username"):"",s=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",c=(e.addressData,e.is_buymyself?e.is_buymyself:0);wx.request({url:d+"/api/client/get_member_address",method:"POST",data:{username:r,token:s,shop_type:o},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(o){if(n=o.data.result?o.data.result:n,0!=n){for(var r=0;r<n.length;r++)1==n[r]["isDefault"]&&e.setData({addressIndex:r}),t[r]=n[r];e.addressList=t,e.addressObjects=n,e.addressData=n[i],e.address_id=n[i]?n[i]["id"]:a,console.log("address list:",n,"addressIndex:",i," addressData:",n[i])}else wx.navigateTo({url:"/pages/address/list/list?is_buymyself="+c})}})},bindSelectRedAll:function(){var e=this,t=e.selectedRedAllStatus,o=e.modalHiddenCoupon,n=e.page_red_num;t=!t,o=!o,e.setData({selectedRedAllStatus:t,modalHiddenCoupon:o,couponType:2}),console.log("bindSelectRedAll :",t,"page_red_num:",n),t&&0==n?e.query_coupon():e.setData({coupons_list:e.coupons_red_list})},bindSelectAll:function(){var e=this,t=e.selectedAllStatus,o=e.modalHiddenCoupon,n=e.page_num;t=!t,o=!o,e.setData({selectedAllStatus:t,modalHiddenCoupon:o,couponType:1}),console.log("selectedAllStatus :",t,"page_num:",n),t&&0==n?e.query_coupon():e.setData({coupons_list:e.coupons_quan_list})},bindSelectCoupon:function(e){var t=this,o=t.couponType,n=e.currentTarget.dataset.couponindex?e.currentTarget.dataset.couponindex:0,a=e.currentTarget.dataset.couponid?e.currentTarget.dataset.couponid:0,i=e.currentTarget.dataset.couponname?e.currentTarget.dataset.couponname:"",r=e.currentTarget.dataset.couponcontent?e.currentTarget.dataset.couponcontent:"",s=e.currentTarget.dataset.couponfooter?e.currentTarget.dataset.couponfooter:"",c=e.currentTarget.dataset.starttime,d=e.currentTarget.dataset.endtime,l=e.currentTarget.dataset.coupontype?e.currentTarget.dataset.coupontype:1,u=e.currentTarget.dataset.couponamount?e.currentTarget.dataset.couponamount:0,_=e.currentTarget.dataset.couponimage;if(1==o)var p=t.coupons_quan_list;else if(2==o)p=t.coupons_red_list;for(var f=0;f<p.length;f++)f==n?p[n]["selected"]=!p[n]["selected"]:p[f]["selected"]=!1;t.setData({selected_coupon_id:a,selected_coupon_name:i,selected_coupon_content:r,selected_coupon_footer:s,selected_coupon_starttime:c,selected_coupon_endtime:d,selected_coupon_type:l,selected_coupon_amount:u,selected_coupon_index:n,selected_couponimage:_,coupons_list:p}),1==o?t.setData({coupons_quan_list:p,selected_coupon_quan_index:n,selected_coupon_quan_amount:u}):2==o&&t.setData({coupons_red_list:p,selected_coupon_red_index:n,selected_coupon_red_amount:u}),console.log("bindSelectCoupon coupon_type:",o," index:",t.selected_coupon_quan_index," red index:",t.selected_coupon_red_index)},getMoreOrdersTapTag:function(e){var t=this,o=t.coupon_type?t.coupon_type:1,n=1==o?t.page+1:t.page,a=2==o?t.page_red+1:t.page_red;t.pagesize,t.all_rows;n>t.page_num&&1==o?wx.showToast({title:"没有更多了~",icon:"none",duration:1500}):a>t.page_red_num&&2==o?wx.showToast({title:"没有更多了~",icon:"none",duration:1500}):(t.setData({page:n,page_red:a}),t.query_coupon())},query_coupon:function(){var e=this,t=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=wx.getStorageSync("token")?wx.getStorageSync("token"):"1",n=(wx.getStorageSync("openid")&&wx.getStorageSync("openid"),e.page),a=e.page_red,i=e.pagesize,r=(e.all_rows,e.page_num),s=e.page_red_num,l=e.shop_type,u="avaliable",_=e.couponType;console.log("query_coupon coupons_type:",_),e.setData({coupons_list:{}}),wx.request({url:d+"/api/client/query_coupon",method:"POST",data:{username:t,access_token:o,page:n,pagesize:i,shop_type:l,coupons_status:u,quan_type:_},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(t){console.log("查询优惠券:",t.data.result);var o=t.data.result,d=t.data.all_rows;if(t.data.result){for(var l=0;l<o.length;l++)o[l]["start_time"]=c.getDateStr(1e3*o[l]["start_time"],0),o[l]["end_time"]=c.getDateStr(1e3*o[l]["end_time"],0),o[l]["selected"]=!1;n>1&&1==_&&o?o=e.coupons_quan_list.concat(o):a>1&&2==_&&o&&(o=e.coupons_red_list.concat(o)),1==_?(r=d/i+.5,e.setData({coupons_list:o,coupons_quan_list:o,page_num:r.toFixed(0),page_red_num:0})):2==_&&(s=d/i+.5,e.setData({coupons_list:o,coupons_red_list:o,page_red_num:s.toFixed(0),page_num:0}))}else wx.showToast({title:t.data.info?t.data.info:"暂无优惠券~",icon:"none",duration:2e3}),1==n&&1==_?e.setData({coupons_quan_list:{},page_num:0}):1==a&&2==_&&e.setData({coupons_red_list:{},page_red_num:0});console.log("query_coupon coupons_list:",o,"red:",e.coupons_red_list,"quan:",e.coupons_quan_list)}})},coupon_pay:function(e){var t=this,o=t.couponType,n=t.amount,a=t.order_num,i=t.payamount,s=t.selectedAllStatus,c=t.selectedRedAllStatus,d=s?t.selected_coupon_id:0,l=s?t.selected_coupon_type:0,u=s?(0,r.default)(t.selected_coupon_amount):0,_=(c&&t.selected_coupon_red_id,c&&t.selected_coupon_red_type,c?(0,r.default)(t.selected_coupon_red_amount):0),p=t.carts,f=t.discountpay?t.discountpay:0;console.log("coupon_pay couponSelectedAmount:",u,"discountpay:",f);for(var m=0;m<p.length;m++)p[m]["discount"]<100&&p[m]["discount"]>0&&1==l&&d&&(f+=(100-p[m]["discount"])*p[m]["sell_price"]*p[m]["num"]/100,f=f.toFixed(2));2==o&&(f=f+_?_:0,f=f.toFixed(2)),i=(n*a-f).toFixed(2),t.setData({discountpay:f,payamount:i}),f-_==0&&s&&1==o&&(t.modalBindcancelCoupon(),wx.showToast({title:"该商品无法使用优惠券",icon:"none",duration:1e3}))},bindPickerChange:function(e){this.setData({addressIndex:e.detail.value})},bindCreateNew:function(){var e=this.addressList;0==e.length&&wx.navigateTo({url:"../../address/add/add?username="+this.username})},modalBindaconfirmCoupon:function(){var e=this,t=e.couponType,o=(e.selectedAllStatus,e.selected_coupon_index?e.selected_coupon_index:0),n=e.coupons_list,a=n[o]?n[o]["selected"]:0;e.setData({modalHiddenCoupon:!this.modalHiddenCoupon}),1==t?e.setData({selectedAllStatus:!!a}):2==t&&e.setData({selectedRedAllStatus:!!a}),e.coupon_pay()},modalBindcancelCoupon:function(){var e=this,t=e.couponType,o=(e.payamount,e.amount);e.discountpay;e.setData({modalHiddenCoupon:!e.modalHiddenCoupon,payamount:o}),1==t?e.setData({selectedAllStatus:!1}):2==t&&e.setData({selectedRedAllStatus:!1}),e.coupon_pay()},setData:function(e){var t,o,n=this,i=[];(0,a.default)(e).forEach(function(a){i=a.split("."),t=e[a],o=n.$data,i.forEach(function(e,a){a+1==i.length?n.$set(o,e,t):o[e]||n.$set(o,e,{}),o=o[e]})})}}};t.default=u},"6e77":function(e,t,o){"use strict";o.r(t);var n=o("4096"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=a.a},"768b":function(e,t,o){"use strict";o.r(t);var n=o("a745"),a=o.n(n);function i(e){if(a()(e))return e}var r=o("5d73"),s=o.n(r);function c(e,t){var o=[],n=!0,a=!1,i=void 0;try{for(var r,c=s()(e);!(n=(r=c.next()).done);n=!0)if(o.push(r.value),t&&o.length===t)break}catch(d){a=!0,i=d}finally{try{n||null==c["return"]||c["return"]()}finally{if(a)throw i}}return o}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function l(e,t){return i(e)||c(e,t)||d()}o.d(t,"default",function(){return l})},d21e:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-scroll-view",{staticClass:"container carts-list",style:(e.modalHiddenCoupon?"position:fixed;":"")+"height:"+e.dkheight+"px;",attrs:{"scroll-y":""}},[1==e.is_buymyself?o("v-uni-navigator",{staticClass:"address-section",attrs:{url:"/pages/address/list/list"}},[o("v-uni-view",{staticClass:"order-content"},[o("v-uni-image",{staticStyle:{width:"50rpx",height:"50rpx"},attrs:{src:"/static/images/icon_address.png"}}),o("v-uni-view",{staticClass:"cen"},[o("v-uni-view",[o("v-uni-text",{staticClass:"name"},[e._v(e._s(e.addressData.full_name))]),o("v-uni-text",{staticClass:"mobile"},[e._v(e._s(e.addressData.tel))])],1),o("v-uni-text",{staticClass:"address"},[e._v(e._s(e.addressData.address))])],1),o("v-uni-image",{staticStyle:{width:"15rpx",height:"30rpx","margin-right":"20rpx"},attrs:{src:"/static/images/right-arrow.png"}})],1)],1):e._e(),e._l(e.carts,function(t,n){return o("v-uni-view",{key:n,staticClass:"carts-container",attrs:{"data-object-id":t.id,"data-goods-id":t.goods_id,"data-goods-name":t.name,"data-goods-info":t.act_info,"data-goods-price":t.sell_price,"data-sale":t.sale,"data-image":t.activity_image?t.activity_image:t.image},on:{click:function(t){t=e.$handleEvent(t),e.showGoods(t)}}},[o("v-uni-view",{staticClass:"carts-item",attrs:{"data-index":n}},[o("v-uni-image",{staticClass:"carts-image",attrs:{src:t.activity_image?t.activity_image:t.image,mode:"aspectFill"}}),o("v-uni-view",{staticClass:"carts-text"},[o("v-uni-text",{staticClass:"carts-title"},[e._v(e._s(t.name))]),o("v-uni-view",{staticClass:"carts-sku"},[e._l(t["value"],function(t,n){return 5!=e.order_shape&&4!=e.order_shape?o("v-uni-view",{key:n},[o("v-uni-text",[e._v(e._s(t?t["name"]+":":"")+e._s(2==t["type"]?t["note"]+" ":t["value"]+" "))])],1):e._e()}),4==e.order_shape&&e.card_name_info?o("v-uni-view",[o("v-uni-text",[e._v(e._s(e.card_name_info.card_name_name?"姓名:"+e.card_name_info.card_name_name:"")+e._s(e.card_name_info.card_name_title?"("+e.card_name_info.card_name_title+")":"")+e._s(e.card_name_info.card_name_phone?" 手机: "+e.card_name_info.card_name_phone:""))]),o("v-uni-text",[e._v(e._s(e.card_name_info.card_name_email?"电子邮箱: "+e.card_name_info.card_name_email:""))]),o("v-uni-text",[e._v(e._s(e.card_name_info.card_name_addr?"地址: "+e.card_name_info.card_name_addr:""))])],1):e._e(),4==e.order_shape&&e.card_register_info?o("v-uni-view",[o("v-uni-text",[e._v(e._s(e.card_register_info.card_register_title?"名称:"+e.card_register_info.card_register_title:""))]),o("v-uni-text",[e._v(e._s(e.card_register_info.card_register_ownername?"发起人: "+e.card_register_info.card_register_ownername:""))])],1):e._e(),5==e.order_shape&&e.card_cele_info?o("v-uni-view",[o("v-uni-text",[e._v(e._s(e.card_cele_info.card_cele_title?e.card_cele_info.card_cele_title:""))])],1):e._e(),4==e.order_shape&&e.card_love_info?o("v-uni-view",[o("v-uni-text",[e._v(e._s(e.card_love_info.card_love_title?e.card_love_info.card_love_title:""))]),o("v-uni-text",[e._v(e._s(e.card_love_info.card_love_related?"联系人:"+e.card_love_info.card_love_related:"")+e._s(e.card_love_info.card_love_phone?" 手机:"+e.card_love_info.card_love_phone:""))])],1):e._e()],2),4!=e.order_shape&&5!=e.order_shape?o("v-uni-view",{staticClass:"carts-subtitle"},[o("v-uni-view",{staticClass:"carts-price"},[o("v-uni-view",[e._v(e._s(t.sell_price>0?"￥"+t.sell_price:"")+" "+e._s(t.num>0?"x"+t.num+" ":""))])],1)],1):e._e()],1)],1)],1)}),o("v-uni-view",{staticClass:"order-item"},[5!=e.order_shape?o("v-uni-view",{staticClass:"order-num"},[o("v-uni-text",[e._v("份数:")]),o("v-uni-input",{attrs:{type:"number",value:e.order_num},on:{input:function(t){t=e.$handleEvent(t),e.order_numFun(t)}}})],1):e._e(),o("v-uni-view",{staticClass:"cell"},[o("v-uni-view",{staticStyle:{width:"18%"}},[e._v("商品金额:")]),o("v-uni-view",{staticClass:"amount",staticStyle:{width:"32%"}},[e._v(e._s(e.payamount)),e.delivery_price>0?o("v-uni-text",[e._v(e._s(e.delivery_price>0?"+"+e.delivery_price:"")+"(运费)")]):e._e()],1),o("v-uni-view",{staticStyle:{width:"18%"}},[e._v("优惠金额:")]),o("v-uni-view",{staticClass:"amount",staticStyle:{width:"30%"}},[e._v(e._s(e.discountpay>0?"-"+e.discountpay:"0"))])],1),o("v-uni-view",{staticClass:"carts-more",attrs:{hidden:e.showmorehidden}},[o("v-uni-view",{staticClass:"select-and-amount",on:{click:function(t){t=e.$handleEvent(t),e.bindSelectRedAll(t)}}},[o("v-uni-icon",{staticStyle:{margin:"10rpx"},attrs:{type:e.selectedRedAllStatus?"success":"circle",size:"18",color:"#e34c55"}}),o("v-uni-text",{staticStyle:{"margin-left":"10rpx"}},[e._v("使用红包")])],1),o("v-uni-view",{staticClass:"select-and-amount",on:{click:function(t){t=e.$handleEvent(t),e.bindSelectAll(t)}}},[o("v-uni-icon",{staticStyle:{margin:"10rpx"},attrs:{type:e.selectedAllStatus?"success":"circle",size:"18",color:"#e34c55"}}),o("v-uni-text",{staticStyle:{"margin-left":"10rpx"}},[e._v("使用优惠券")])],1)],1),o("v-uni-view",{staticClass:"confirmbtn"},[o("v-uni-form",{attrs:{"data-name":"confirmOrder","report-submit":"true"},on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[o("v-uni-button",{staticClass:"submit",staticStyle:{width:"96%"},attrs:{type:"warn",formType:"submit"}},[e._v("提交订单")])],1)],1)],1)],2),o("v-uni-view",{staticStyle:{width:"100%"},attrs:{hidden:e.modalHiddenCoupon}},[o("v-uni-view",{staticClass:"counpons",attrs:{title:"请选择","confirm-text":"确定","cancel-text":"取消","no-cancel":""},on:{confirm:function(t){t=e.$handleEvent(t),e.modalBindaconfirmCoupon(t)},cancel:function(t){t=e.$handleEvent(t),e.modalBindcancelCoupon(t)}}},[o("v-uni-view",{staticClass:"counpon-item-banner",style:"height:"+e.dkheight-34+"px"},[e._l(e.coupons_list,function(t,n){return o("v-uni-view",{key:n,staticClass:"gifts-item"},[o("v-uni-view",{staticClass:"coupons-list",attrs:{"data-couponindex":n,"data-couponid":t.id,"data-starttime":t.start_time,"data-endtime":t.end_time,"data-couponname":t.name,"data-couponcontent":t.content,"data-couponamount":t.amount,"data-couponfooter":t.footer,"data-coupontype":t.type,"data-couponimage":t.image},on:{click:function(t){t=e.$handleEvent(t),e.bindSelectCoupon(t)}}},[o("v-uni-view",{staticClass:"select-and-amount-mark"},[o("v-uni-icon",{attrs:{type:t.selected?"success_circle":"circle",size:"18",color:"rgb(255,255,255)"}})],1),o("v-uni-view",{staticClass:"counpons-item",style:"background-image:url("+t.image+");background-repeat:no-repeat; background-size:100% 100%;-moz-background-size:100% 100%; text-align: center;align-items: center;"},[o("v-uni-text",{staticClass:"coupon-name"},[e._v(e._s(t.name))]),o("v-uni-text",{staticClass:"coupon-content"},[e._v(e._s(t.content))]),2==e.couponType?o("v-uni-text",{staticClass:"coupon-content"},[e._v(e._s(t.amount>0?"现金￥"+t.amount+"元":""))]):e._e(),o("v-uni-text",{staticClass:"coupon-footer"},[e._v(e._s(t.footer))]),o("v-uni-text",{staticClass:"coupon-dueday"},[e._v(e._s(t.start_time?"(有效期:"+t.start_time+"至":"")+e._s(t.end_time?t.end_time+")":""))])],1)],1)],1)}),o("v-uni-form",{attrs:{"data-name":"getMoreOrders","report-submit":"true"},on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[e.page_num>1?o("v-uni-button",{staticClass:"morebtn",staticStyle:{width:"200rpx"},attrs:{type:"default",size:"default","hover-class":"none",formType:"submit"}},[e._v("更多")]):e._e()],1)],2)],1)],1)],1)},a=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a})},d8ed:function(e,t,o){"use strict";o.r(t);var n=o("d21e"),a=o("6e77");for(var i in a)"default"!==i&&function(e){o.d(t,e,function(){return a[e]})}(i);o("080f");var r=o("2877"),s=Object(r["a"])(a["default"],n["a"],n["b"],!1,null,"bb331f44",null);t["default"]=s.exports}}]);