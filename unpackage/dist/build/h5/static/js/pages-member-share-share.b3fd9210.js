(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-member-share-share"],{2787:function(e,t,i){"use strict";i.r(t);var o=i("d819"),a=i.n(o);for(var n in o)"default"!==n&&function(e){i.d(t,e,function(){return o[e]})}(n);t["default"]=a.a},2975:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[i("v-uni-view",{staticClass:"gifts-item",attrs:{hidden:!e.hiddenqrcode}},[i("v-uni-image",{staticClass:"share-image",attrs:{src:e.share_qrcode_image,mode:"widthFix"},on:{longpress:function(t){t=e.$handleEvent(t),e.saveImg(t)}}}),i("canvasdrawer",{staticClass:"canvasdrawer",attrs:{painting:e.painting},on:{getImage:function(t){t=e.$handleEvent(t),e.eventGetImage(t)}}})],1),i("v-uni-view",{staticClass:"sentbtn"},[i("v-uni-button",{on:{click:function(t){t=e.$handleEvent(t),e.shareToWeixin(t)}}},[e._v("分享")]),i("v-uni-button",{on:{click:function(t){t=e.$handleEvent(t),e.eventSave(t)}}},[e._v("保存")])],1)],1)},a=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return a})},6989:function(e,t,i){"use strict";var o=i("d570"),a=i.n(o);a.a},"7d24":function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,"uni-page-body[data-v-72085479]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}[data-v-72085479]::-webkit-scrollbar{width:0;height:0;color:rgba(0,0,0,0)}.startBar[data-v-72085479]{height:%?75?%;background:#333;width:100%;position:fixed;top:0;padding:%?5?%;border-bottom:0 solid #f2f2f2;z-index:99}.top-title[data-v-72085479]{height:%?75?%;background:#333;width:100%;position:fixed;top:0;padding:%?5?%;border-bottom:0 solid #f2f2f2;z-index:99}.top-title-item[data-v-72085479]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;color:#fff;text-align:center;line-height:%?75?%;font-size:%?48?%;padding:%?10?%}.top-title-item .title-image[data-v-72085479]{width:%?70?%;height:%?70?%;margin-right:%?1?%;margin-top:%?0?%;margin-left:%?20?%}.desc[data-v-72085479]{line-height:40px;color:#333;text-align:center;display:block;padding:0 20px;font-size:%?28?%}uni-image[data-v-72085479]{width:70%;margin:0 auto}.order-item-banner[data-v-72085479]{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;text-align:center;-webkit-align-content:left;-ms-flex-line-pack:left;align-content:left;padding:%?40?%}.order-item[data-v-72085479]{width:85%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;text-align:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;background:#fff;margin:%?20?% auto;border-radius:%?20?%}.gifts-item[data-v-72085479]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;text-align:center;\r\n  /*width属性解决标题文字太短而缩略图偏移*/width:100%;padding:%?20?% %?10?%}.gifts-image[data-v-72085479]{margin:%?20?%;width:%?350?%;height:%?250?%;border:%?4?% solid #ddd}.share-image[data-v-72085479]{width:100%;height:%?1220?%}.canvasdrawer[data-v-72085479]{position:absolute}.sentbtn[data-v-72085479]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;margin:%?40?% auto %?20?% auto;width:100%;height:%?200?%}.sentbtn uni-button[data-v-72085479]{line-height:%?100?%;width:60%;height:%?100?%;\r\n  /*background: linear-gradient(to bottom, #e34c55 0%,#e30715 100%);*/background:#e34c55;color:#fff;font-size:%?34?%;border-radius:%?20?%;-webkit-box-shadow:0 %?4?% 0 #db1f05;-moz-box-shadow:0 %?4?% 0 #db1f05;box-shadow:0 %?4?% 0 #b31602;margin:%?20?%}.sentbtn uni-text[data-v-72085479]{font-size:%?24?%;color:#999}.savebtn[data-v-72085479]{font-size:%?28?%;padding-top:%?1?%;height:%?80?%;margin-top:10px}.container[data-v-72085479]{width:100%;height:100%}.share-image[data-v-72085479]{width:100%;height:%?1220?%}.canvasdrawer[data-v-72085479]{position:absolute}",""])},b132:function(e,t,i){"use strict";i.r(t);var o=i("2975"),a=i("2787");for(var n in a)"default"!==n&&function(e){i.d(t,e,function(){return a[e]})}(n);i("6989");var r=i("2877"),s=Object(r["a"])(a["default"],o["a"],o["b"],!1,null,"72085479",null);t["default"]=s.exports},d570:function(e,t,i){var o=i("7d24");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=i("4f06").default;a("6e04d41e",o,!0,{sourceMap:!1,shadowMode:!1})},d819:function(e,t,i){"use strict";var o=i("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("28a5");var a=o(i("a4bb"));i("ac6a"),i("4917");var n=o(i("f499"));i("7f7f");var r=o(i("0d30")),s=(i("3936"),getApp().globalData.weburl),c=getApp().globalData.shop_type,d=wx.getStorageSync("username")?wx.getStorageSync("username"):"",l=(wx.getStorageSync("token")&&wx.getStorageSync("token"),wx.getStorageSync("openid")?wx.getStorageSync("openid"):""),p=(wx.getStorageSync("userInfo")&&wx.getStorageSync("userInfo"),getApp().globalData.appid),g=getApp().globalData.secret,u=(wx.getStorageSync("userInfo")&&wx.getStorageSync("userInfo"),wx.getStorageSync("navList2")?wx.getStorageSync("navList2"):[]),h={data:function(){return{title_name:"二维码",title_logo:"/static/images/footer-icon-05.png",weburl:s,appid:p,secret:g,openid:l,shop_type:c,hiddenqrcode:!0,coupon_img:s+"/uploads/coupon_bg.jpg",wechat_share:"",navList2:u,qr_type:"",share_qrcode:"",painting:{},share_qrcode_image:"",username:"",act_id:"",act_title:"",coupons:"",coupons_json:"",coupons_name:"",coupons_id:"",coupons_type:"",coupons_flag:"",share_activity_qrcode_cache:"",share_coupon_qrcode_cache:"",share_member_qrcode_cache:"",windowHeight:"",windowWidth:"",dkheight:"",loadingHidden:!1}},components:{canvasdrawer:r.default},props:{},onLoad:function(e){var t=this;console.log("share options:",e);var i=wx.getStorageSync("username")?wx.getStorageSync("username"):"",o=(wx.getStorageSync("m_id")&&wx.getStorageSync("m_id"),t.hiddenqrcode,t.appid),a=t.secret,n=e.qr_type?e.qr_type:"",r=e.act_id?e.act_id:"",d=e.act_title?e.act_title:"",l=e.coupons?e.coupons:"",p=l?JSON.parse(l):[{}],g=l?p["name"]:"",u=l?p["id"]:0,h=l?p["type"]:1,w=l?p["flag"]:0,f=s+"/api/WXPay/getQRCode?username="+i+"&appid="+o+"&secret="+a+"&shop_type="+c+"&qr_type="+n+"&coupons_flag="+w+"&coupons_type="+h+"&coupons_id="+u+"&coupons="+l,m=s+"/api/WXPay/getQRCode?username="+i+"&appid="+o+"&secret="+a+"&shop_type="+c+"&qr_type="+n+"&act_id="+r;t.setData({username:i,appid:o,secret:a,qr_type:n,act_id:r,act_title:d,coupons:p,coupons_json:l,hiddenqrcode:!0,coupons_name:g,coupons_id:u,coupons_type:h,coupons_flag:w,share_activity_qrcode_cache:m,share_coupon_qrcode_cache:f,share_member_qrcode_cache:m,isSaveImageToPhotosAlbum:!1}),wx.getSystemInfo({success:function(e){console.log(e.model),"iPhone X"==e.model&&(startBarHeight=44),t.setData({windowHeight:e.windowHeight,windowWidth:e.windowWidth,dkheight:e.windowHeight-10})}}),t.get_project_gift_para(),wx.showLoading({title:"开始生成分享码"}),setTimeout(function(){t.setData({loadingHidden:!0}),t.eventDraw()},2e3)},onShow:function(){var e=this,t=getCurrentPages();t.length>1&&e.setData({title_logo:"../../../images/back.png"})},methods:{shareToWeixin:function(e){this.isSaveImageToPhotosAlbum||this.eventSave(),uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album"],success:function(t){uni.share({provider:"weixin",type:2,title:"送心礼物分享",scene:e,imageUrl:t.tempFilePaths[0],success:function(e){console.log(e),uni.showToast({title:"分享成功！"})},fail:function(e){console.log(e),uni.showModal({title:"分享失败",content:"error:"+(0,n.default)(e)})}})}})},goBack:function(){var e=getCurrentPages();e.length>1?wx.navigateBack({changed:!0}):wx.switchTab({url:"../../hall/hall"})},returnTapTag:function(e){wx.switchTab({url:"../../my/index"})},image_save:function(e,t){console.log("membershare imge save image url:",e,"image_cache_name:",t),wx.downloadFile({url:e,success:function(e){if(200===e.statusCode)e.tempFilePath;else console.log("membershare image_save 响应失败",e.statusCode)}})},get_project_gift_para:function(){var e=this,t=(e.page,e.pagesize,e.navList2),i=e.shop_type;console.log("share get_project_gift_para navList2:",u),t||wx.request({url:s+"/api/client/get_project_gift_para",method:"POST",data:{type:2,shop_type:i},header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},success:function(e){console.log("get_project_gift_para:",e.data.result),t=e.data.result}}),e.setData({navList2:t})},eventDraw:function(){for(var e=this,t=200,i=230,o=100,a=120,n=60,r=(e.wechat_share,e.shop_type),c=e.qr_type?e.qr_type:"couponshare",l=e.act_id?e.act_id:"",u=e.act_title?e.act_title:"开启礼物电商时代，200万人都在用的礼物小程序",h=e.coupons,w=e.coupons_json,f=e.coupons_id,m=e.coupons_type,_=e.coupons_flag,b=(e.coupons_name,e.share_activity_qrcode_cache?e.share_activity_qrcode_cache:s+"/api/WXPay/getQRCode?username="+d+"&appid="+p+"&secret="+g+"&shop_type="+r+"&qr_type="+c+"&coupons_flag="+_+"&coupons_type="+m+"&coupons_id="+f+"&coupons="+w+"&act_id="+l),x=e.share_coupon_qrcode_cache?e.share_coupon_qrcode_cache:s+"/api/WXPay/getQRCode?username="+d+"&appid="+p+"&secret="+g+"&shop_type="+r+"&qr_type="+c+"&coupons_flag="+_+"&coupons_type="+m+"&coupons_id="+f+"&coupons="+w,v=e.share_member_qrcode_cache?e.share_member_qrcode_cache:s+"/api/WXPay/getQRCode?username="+d+"&appid="+p+"&secret="+g+"&shop_type="+r+"&qr_type="+c,y="",k=u.length,S=0,q=0,P=0;P<k.length;P++)S+=k[P].match(/[^\x00-\xff]/gi)?2:1;S=q*uni.upx2px(28),a=(400-S)/2,l?y=b:f?y=x:"membershare"==c&&(y=v,a=60,t=230,i=230,o=85,n=90),console.log("member share eventDraw() title len:",u.length),e.setData({qr_type:c,share_qrcode:y}),console.log("扫码图片信息:",h,"qr_type:",c,"windowWidth:",e.windowWidth," windowHeight",e.windowHeight),e.setData({painting:{width:400,height:350,windowHeight:e.windowHeight?e.windowHeight:400,windowWidth:e.windowWidth?e.windowWidth:200,clear:!0,background:"white",views:[{type:"text",content:u,fontSize:28,color:"#333",textAlign:"left",top:20,left:a,lineHeight:30,MaxLineNumber:1,breakWord:!1,width:t},{type:"image",url:y,top:n,left:o,width:t,height:i}]}}),console.log("二维码 paint:",e.painting)},eventSave:function(){wx.saveImageToPhotosAlbum({filePath:this.share_qrcode_image,success:function(e){wx.showToast({title:"图片已保存到相册，赶紧晒一下吧~",icon:"none",duration:1500})}})},eventGetImage:function(e){console.log("member share eventGetImage:",e);var t=e.tempFilePath,i=e.errMsg;"canvasdrawer:ok"===i&&(this.setData({share_qrcode_image:t}),wx.hideLoading())},saveImg:function(e){var t=this;wx.showModal({title:"请确认",content:"保存相册",success:function(e){e.confirm&&t.eventSave()}})},setData:function(e){var t,i,o=this,n=[];(0,a.default)(e).forEach(function(a){n=a.split("."),t=e[a],i=o.$data,n.forEach(function(e,a){a+1==n.length?o.$set(i,e,t):i[e]||o.$set(i,e,{}),i=i[e]})})}}};t.default=h}}]);